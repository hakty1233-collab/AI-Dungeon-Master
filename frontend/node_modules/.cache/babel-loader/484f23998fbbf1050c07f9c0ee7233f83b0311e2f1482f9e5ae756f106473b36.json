{"ast":null,"code":"// frontend/src/utils/narrativeParser.js\n\n/**\n * Parse narrative text to detect dialogue and assign appropriate voices\n */\n\n// Voice descriptors mapped to ElevenLabs voice IDs\nconst VOICE_MAP = {\n  // Character traits\n  'gravelly': 'gruff',\n  'gruff': 'gruff',\n  'rough': 'gruff',\n  'deep': 'gruff',\n  'raspy': 'gruff',\n  'harsh': 'gruff',\n  'old': 'old_wise',\n  'ancient': 'old_wise',\n  'wise': 'old_wise',\n  'elderly': 'old_wise',\n  'aged': 'old_wise',\n  'young': 'young',\n  'youthful': 'young',\n  'child': 'young',\n  'cheerful': 'young',\n  'dark': 'dark',\n  'sinister': 'dark',\n  'menacing': 'dark',\n  'ominous': 'dark',\n  'evil': 'dark',\n  'female': 'female',\n  'woman': 'female',\n  'lady': 'female',\n  'male': 'male',\n  'man': 'male',\n  'epic': 'epic',\n  'booming': 'epic',\n  'powerful': 'epic',\n  'commanding': 'epic'\n};\n\n/**\n * Detect voice characteristics from descriptive text\n */\nfunction detectVoiceFromDescription(text) {\n  const lowerText = text.toLowerCase();\n  for (const [keyword, voice] of Object.entries(VOICE_MAP)) {\n    if (lowerText.includes(keyword)) {\n      return voice;\n    }\n  }\n  return 'narrator';\n}\n\n/**\n * Parse narrative text into segments with appropriate voices\n * Format: Narrator leads up to quote, then character voice speaks the quote\n */\nexport function parseNarrative(text) {\n  const segments = [];\n\n  // Enhanced regex to capture dialogue with context\n  // Matches: \"...description, 'dialogue'\" or \"...description: 'dialogue'\"\n  const dialoguePattern = /([^'\"]*?[,:])\\s*['\"'\"](.*?)['\"'\"]/g;\n  let lastIndex = 0;\n  let match;\n  while ((match = dialoguePattern.exec(text)) !== null) {\n    const beforeDialogue = match[1].trim(); // Everything before the quote\n    const dialogue = match[2].trim(); // The actual quote\n    const fullMatchStart = match.index;\n    const fullMatchEnd = dialoguePattern.lastIndex;\n\n    // Add any pure narration before this match\n    if (fullMatchStart > lastIndex) {\n      const pureNarration = text.slice(lastIndex, fullMatchStart).trim();\n      if (pureNarration) {\n        segments.push({\n          text: pureNarration,\n          voice: 'narrator',\n          type: 'narration'\n        });\n      }\n    }\n\n    // Add the setup narration (the part leading to the dialogue)\n    if (beforeDialogue) {\n      segments.push({\n        text: beforeDialogue + ',',\n        voice: 'narrator',\n        type: 'narration'\n      });\n    }\n\n    // Add the dialogue with detected voice\n    const voice = detectVoiceFromDescription(beforeDialogue);\n    segments.push({\n      text: dialogue,\n      voice: voice,\n      type: 'dialogue',\n      description: beforeDialogue\n    });\n    lastIndex = fullMatchEnd;\n  }\n\n  // Add any remaining narration after the last dialogue\n  if (lastIndex < text.length) {\n    const remainingText = text.slice(lastIndex).trim();\n    if (remainingText) {\n      segments.push({\n        text: remainingText,\n        voice: 'narrator',\n        type: 'narration'\n      });\n    }\n  }\n\n  // If no dialogue was detected, return entire text as narration\n  if (segments.length === 0) {\n    segments.push({\n      text: text,\n      voice: 'narrator',\n      type: 'narration'\n    });\n  }\n  return segments;\n}\n\n/**\n * Example usage and test\n */\nexport function testParser() {\n  const examples = [\"A raspy voice calls out from the doorway of the local tavern, 'Welcome to the Crimson Griffin, where the ale is warm and the company is... questionable.' As you enter, the warm glow of the fire pit and the murmur of hushed conversations envelop you.\", \"The figure's voice remains low and gravelly as it speaks, 'I am called Malakai, and I have been waiting for you, adventurer.'\", \"The old wizard says, 'You must find the crystal before nightfall.' He turns away with a sigh.\", \"The tavernkeeper, a gruff old man with a thick beard, eyes you from behind the bar, 'What can I get for you, stranger?'\"];\n  console.log(\"=== Narrative Parser Tests ===\");\n  examples.forEach((example, i) => {\n    console.log(`\\nðŸ“– Example ${i + 1}:`);\n    console.log(`Input: \"${example}\"`);\n    const segments = parseNarrative(example);\n    console.log(`\\nParsed into ${segments.length} segments:`);\n    segments.forEach((seg, j) => {\n      console.log(`  ${j + 1}. [${seg.type}] (${seg.voice}): \"${seg.text}\"`);\n    });\n  });\n}","map":{"version":3,"names":["VOICE_MAP","detectVoiceFromDescription","text","lowerText","toLowerCase","keyword","voice","Object","entries","includes","parseNarrative","segments","dialoguePattern","lastIndex","match","exec","beforeDialogue","trim","dialogue","fullMatchStart","index","fullMatchEnd","pureNarration","slice","push","type","description","length","remainingText","testParser","examples","console","log","forEach","example","i","seg","j"],"sources":["C:/Users/Hakty/Desktop/AI-Dungeon-Master/frontend/src/utils/narrativeParser.js"],"sourcesContent":["// frontend/src/utils/narrativeParser.js\n\n/**\n * Parse narrative text to detect dialogue and assign appropriate voices\n */\n\n// Voice descriptors mapped to ElevenLabs voice IDs\nconst VOICE_MAP = {\n  // Character traits\n  'gravelly': 'gruff',\n  'gruff': 'gruff',\n  'rough': 'gruff',\n  'deep': 'gruff',\n  'raspy': 'gruff',\n  'harsh': 'gruff',\n  \n  'old': 'old_wise',\n  'ancient': 'old_wise',\n  'wise': 'old_wise',\n  'elderly': 'old_wise',\n  'aged': 'old_wise',\n  \n  'young': 'young',\n  'youthful': 'young',\n  'child': 'young',\n  'cheerful': 'young',\n  \n  'dark': 'dark',\n  'sinister': 'dark',\n  'menacing': 'dark',\n  'ominous': 'dark',\n  'evil': 'dark',\n  \n  'female': 'female',\n  'woman': 'female',\n  'lady': 'female',\n  \n  'male': 'male',\n  'man': 'male',\n  \n  'epic': 'epic',\n  'booming': 'epic',\n  'powerful': 'epic',\n  'commanding': 'epic',\n};\n\n/**\n * Detect voice characteristics from descriptive text\n */\nfunction detectVoiceFromDescription(text) {\n  const lowerText = text.toLowerCase();\n  \n  for (const [keyword, voice] of Object.entries(VOICE_MAP)) {\n    if (lowerText.includes(keyword)) {\n      return voice;\n    }\n  }\n  \n  return 'narrator';\n}\n\n/**\n * Parse narrative text into segments with appropriate voices\n * Format: Narrator leads up to quote, then character voice speaks the quote\n */\nexport function parseNarrative(text) {\n  const segments = [];\n  \n  // Enhanced regex to capture dialogue with context\n  // Matches: \"...description, 'dialogue'\" or \"...description: 'dialogue'\"\n  const dialoguePattern = /([^'\"]*?[,:])\\s*['\"'\"](.*?)['\"'\"]/g;\n  \n  let lastIndex = 0;\n  let match;\n  \n  while ((match = dialoguePattern.exec(text)) !== null) {\n    const beforeDialogue = match[1].trim(); // Everything before the quote\n    const dialogue = match[2].trim(); // The actual quote\n    const fullMatchStart = match.index;\n    const fullMatchEnd = dialoguePattern.lastIndex;\n    \n    // Add any pure narration before this match\n    if (fullMatchStart > lastIndex) {\n      const pureNarration = text.slice(lastIndex, fullMatchStart).trim();\n      if (pureNarration) {\n        segments.push({\n          text: pureNarration,\n          voice: 'narrator',\n          type: 'narration',\n        });\n      }\n    }\n    \n    // Add the setup narration (the part leading to the dialogue)\n    if (beforeDialogue) {\n      segments.push({\n        text: beforeDialogue + ',',\n        voice: 'narrator',\n        type: 'narration',\n      });\n    }\n    \n    // Add the dialogue with detected voice\n    const voice = detectVoiceFromDescription(beforeDialogue);\n    segments.push({\n      text: dialogue,\n      voice: voice,\n      type: 'dialogue',\n      description: beforeDialogue,\n    });\n    \n    lastIndex = fullMatchEnd;\n  }\n  \n  // Add any remaining narration after the last dialogue\n  if (lastIndex < text.length) {\n    const remainingText = text.slice(lastIndex).trim();\n    if (remainingText) {\n      segments.push({\n        text: remainingText,\n        voice: 'narrator',\n        type: 'narration',\n      });\n    }\n  }\n  \n  // If no dialogue was detected, return entire text as narration\n  if (segments.length === 0) {\n    segments.push({\n      text: text,\n      voice: 'narrator',\n      type: 'narration',\n    });\n  }\n  \n  return segments;\n}\n\n/**\n * Example usage and test\n */\nexport function testParser() {\n  const examples = [\n    \"A raspy voice calls out from the doorway of the local tavern, 'Welcome to the Crimson Griffin, where the ale is warm and the company is... questionable.' As you enter, the warm glow of the fire pit and the murmur of hushed conversations envelop you.\",\n    \n    \"The figure's voice remains low and gravelly as it speaks, 'I am called Malakai, and I have been waiting for you, adventurer.'\",\n    \n    \"The old wizard says, 'You must find the crystal before nightfall.' He turns away with a sigh.\",\n    \n    \"The tavernkeeper, a gruff old man with a thick beard, eyes you from behind the bar, 'What can I get for you, stranger?'\",\n  ];\n  \n  console.log(\"=== Narrative Parser Tests ===\");\n  examples.forEach((example, i) => {\n    console.log(`\\nðŸ“– Example ${i + 1}:`);\n    console.log(`Input: \"${example}\"`);\n    const segments = parseNarrative(example);\n    console.log(`\\nParsed into ${segments.length} segments:`);\n    segments.forEach((seg, j) => {\n      console.log(`  ${j + 1}. [${seg.type}] (${seg.voice}): \"${seg.text}\"`);\n    });\n  });\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}