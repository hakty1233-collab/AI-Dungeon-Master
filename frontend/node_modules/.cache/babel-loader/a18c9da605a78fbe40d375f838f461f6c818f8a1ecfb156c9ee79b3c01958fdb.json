{"ast":null,"code":"// frontend/src/utils/merchantSystem.js\n\n/**\n * D&D 5e Merchant / Shop System\n *\n * Integrates with inventorySystem.js â€” gold is stored as a stackable\n * inventory item (id: 'gold') on the character, not a separate field.\n */\n\nimport { ITEM_TYPES, ITEM_RARITY, WEAPON_TEMPLATES, ARMOR_TEMPLATES, POTION_TEMPLATES, MISC_TEMPLATES, createItem, addItemToInventory, removeItemFromInventory } from './inventorySystem';\n\n// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n//  MERCHANT TYPES\n// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\nexport const MERCHANT_TYPES = {\n  GENERAL: 'general',\n  BLACKSMITH: 'blacksmith',\n  ALCHEMIST: 'alchemist',\n  MAGIC: 'magic',\n  FENCE: 'fence'\n};\nexport const MERCHANT_DEFINITIONS = {\n  [MERCHANT_TYPES.GENERAL]: {\n    name: 'General Store',\n    icon: 'ðŸª',\n    description: 'A well-stocked shop with everyday adventuring supplies.',\n    buyMultiplier: 1.0,\n    sellMultiplier: 0.5,\n    stockCategories: [ITEM_TYPES.MISC, ITEM_TYPES.POTION, ITEM_TYPES.WEAPON]\n  },\n  [MERCHANT_TYPES.BLACKSMITH]: {\n    name: 'Blacksmith',\n    icon: 'âš’ï¸',\n    description: 'A skilled smith who crafts and sells quality weapons and armor.',\n    buyMultiplier: 1.0,\n    sellMultiplier: 0.6,\n    stockCategories: [ITEM_TYPES.WEAPON, ITEM_TYPES.ARMOR, ITEM_TYPES.SHIELD]\n  },\n  [MERCHANT_TYPES.ALCHEMIST]: {\n    name: 'Alchemist',\n    icon: 'âš—ï¸',\n    description: 'A master of potions and elixirs.',\n    buyMultiplier: 1.0,\n    sellMultiplier: 0.4,\n    stockCategories: [ITEM_TYPES.POTION, ITEM_TYPES.SCROLL]\n  },\n  [MERCHANT_TYPES.MAGIC]: {\n    name: 'Arcane Emporium',\n    icon: 'ðŸ”®',\n    description: 'Rare and magical items for those who know their worth.',\n    buyMultiplier: 1.2,\n    sellMultiplier: 0.6,\n    stockCategories: [ITEM_TYPES.SCROLL, ITEM_TYPES.ACCESSORY, ITEM_TYPES.POTION]\n  },\n  [MERCHANT_TYPES.FENCE]: {\n    name: 'Shady Dealer',\n    icon: 'ðŸ•µï¸',\n    description: 'Asks no questions. Pays poorly. Sells cheap.',\n    buyMultiplier: 0.7,\n    sellMultiplier: 0.7,\n    stockCategories: [ITEM_TYPES.WEAPON, ITEM_TYPES.MISC, ITEM_TYPES.ARMOR]\n  }\n};\n\n// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n//  SHOP ITEM CATALOG\n// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\nexport const SHOP_ITEMS = {\n  ...WEAPON_TEMPLATES,\n  ...ARMOR_TEMPLATES,\n  ...POTION_TEMPLATES,\n  ...MISC_TEMPLATES,\n  // Extra weapons\n  handaxe: {\n    id: 'handaxe',\n    name: 'Handaxe',\n    type: ITEM_TYPES.WEAPON,\n    rarity: ITEM_RARITY.COMMON,\n    damage: '1d6',\n    damageType: 'slashing',\n    properties: ['light', 'thrown (20/60)'],\n    weight: 2,\n    value: 5,\n    description: 'A light axe that can be thrown.'\n  },\n  mace: {\n    id: 'mace',\n    name: 'Mace',\n    type: ITEM_TYPES.WEAPON,\n    rarity: ITEM_RARITY.COMMON,\n    damage: '1d6',\n    damageType: 'bludgeoning',\n    properties: [],\n    weight: 4,\n    value: 5,\n    description: 'A heavy flanged club.'\n  },\n  rapier: {\n    id: 'rapier',\n    name: 'Rapier',\n    type: ITEM_TYPES.WEAPON,\n    rarity: ITEM_RARITY.COMMON,\n    damage: '1d8',\n    damageType: 'piercing',\n    properties: ['finesse'],\n    weight: 2,\n    value: 25,\n    description: 'An elegant blade for the skilled duelist.'\n  },\n  flail: {\n    id: 'flail',\n    name: 'Flail',\n    type: ITEM_TYPES.WEAPON,\n    rarity: ITEM_RARITY.COMMON,\n    damage: '1d8',\n    damageType: 'bludgeoning',\n    properties: [],\n    weight: 2,\n    value: 10,\n    description: 'A spiked ball on a chain.'\n  },\n  greatsword: {\n    id: 'greatsword',\n    name: 'Greatsword',\n    type: ITEM_TYPES.WEAPON,\n    rarity: ITEM_RARITY.COMMON,\n    damage: '2d6',\n    damageType: 'slashing',\n    properties: ['heavy', 'two-handed'],\n    weight: 6,\n    value: 50,\n    description: 'A massive two-handed blade.'\n  },\n  hand_crossbow: {\n    id: 'hand_crossbow',\n    name: 'Hand Crossbow',\n    type: ITEM_TYPES.WEAPON,\n    rarity: ITEM_RARITY.COMMON,\n    damage: '1d6',\n    damageType: 'piercing',\n    properties: ['ammunition (30/120)', 'light'],\n    weight: 3,\n    value: 75,\n    description: 'A compact crossbow, easily concealed.'\n  },\n  plus1_sword: {\n    id: 'plus1_sword',\n    name: '+1 Longsword',\n    type: ITEM_TYPES.WEAPON,\n    rarity: ITEM_RARITY.UNCOMMON,\n    damage: '1d8+1',\n    damageType: 'slashing',\n    properties: ['versatile (1d10+1)', 'magical'],\n    weight: 3,\n    value: 500,\n    description: 'A magically enhanced longsword.',\n    magical: true\n  },\n  flame_tongue_dagger: {\n    id: 'flame_tongue_dagger',\n    name: 'Flame Tongue Dagger',\n    type: ITEM_TYPES.WEAPON,\n    rarity: ITEM_RARITY.RARE,\n    damage: '1d4+2d6',\n    damageType: 'piercing + fire',\n    properties: ['light', 'finesse', 'magical'],\n    weight: 1,\n    value: 2500,\n    description: 'A dagger wreathed in magical flames.',\n    magical: true\n  },\n  // Extra armor\n  padded: {\n    id: 'padded',\n    name: 'Padded Armor',\n    type: ITEM_TYPES.ARMOR,\n    rarity: ITEM_RARITY.COMMON,\n    ac: 11,\n    acBonus: 'DEX',\n    weight: 8,\n    value: 5,\n    description: 'Quilted layers of cloth.'\n  },\n  hide: {\n    id: 'hide',\n    name: 'Hide Armor',\n    type: ITEM_TYPES.ARMOR,\n    rarity: ITEM_RARITY.COMMON,\n    ac: 12,\n    acBonus: 'DEX_MAX2',\n    weight: 12,\n    value: 10,\n    description: 'Crude armor from thick hides.'\n  },\n  scale_mail: {\n    id: 'scale_mail',\n    name: 'Scale Mail',\n    type: ITEM_TYPES.ARMOR,\n    rarity: ITEM_RARITY.COMMON,\n    ac: 14,\n    acBonus: 'DEX_MAX2',\n    weight: 45,\n    value: 50,\n    description: 'Overlapping metal scales on leather.'\n  },\n  breastplate: {\n    id: 'breastplate',\n    name: 'Breastplate',\n    type: ITEM_TYPES.ARMOR,\n    rarity: ITEM_RARITY.UNCOMMON,\n    ac: 14,\n    acBonus: 'DEX_MAX2',\n    weight: 20,\n    value: 400,\n    description: 'A fitted metal chest piece.'\n  },\n  shield_basic: {\n    id: 'shield_basic',\n    name: 'Shield',\n    type: ITEM_TYPES.SHIELD,\n    rarity: ITEM_RARITY.COMMON,\n    acBonus: 2,\n    weight: 6,\n    value: 10,\n    description: 'A wooden or metal shield. +2 AC.'\n  },\n  // Extra potions\n  superior_healing: {\n    id: 'superior_healing',\n    name: 'Potion of Superior Healing',\n    type: ITEM_TYPES.POTION,\n    rarity: ITEM_RARITY.RARE,\n    effect: 'heal',\n    power: '8d4+8',\n    weight: 0.5,\n    value: 500,\n    description: 'Surges with healing energy.',\n    consumable: true\n  },\n  potion_of_speed: {\n    id: 'potion_of_speed',\n    name: 'Potion of Speed',\n    type: ITEM_TYPES.POTION,\n    rarity: ITEM_RARITY.RARE,\n    effect: 'haste',\n    power: 1,\n    weight: 0.5,\n    value: 400,\n    description: 'Grants Haste for 1 minute.',\n    consumable: true\n  },\n  potion_of_invisibility: {\n    id: 'potion_of_invisibility',\n    name: 'Potion of Invisibility',\n    type: ITEM_TYPES.POTION,\n    rarity: ITEM_RARITY.RARE,\n    effect: 'invisibility',\n    power: 1,\n    weight: 0.5,\n    value: 180,\n    description: 'Invisible for 1 hour.',\n    consumable: true\n  },\n  antitoxin: {\n    id: 'antitoxin',\n    name: 'Antitoxin',\n    type: ITEM_TYPES.POTION,\n    rarity: ITEM_RARITY.COMMON,\n    effect: 'cure_poison',\n    power: 1,\n    weight: 0.5,\n    value: 50,\n    description: 'Advantage on poison saves for 1 hour.',\n    consumable: true\n  },\n  // Scrolls\n  scroll_fireball: {\n    id: 'scroll_fireball',\n    name: 'Scroll of Fireball',\n    type: ITEM_TYPES.SCROLL,\n    rarity: ITEM_RARITY.UNCOMMON,\n    spellId: 'fireball',\n    weight: 0,\n    value: 300,\n    description: 'Cast Fireball once.',\n    consumable: true\n  },\n  scroll_healing: {\n    id: 'scroll_healing',\n    name: 'Scroll of Cure Wounds',\n    type: ITEM_TYPES.SCROLL,\n    rarity: ITEM_RARITY.COMMON,\n    spellId: 'cure_wounds',\n    weight: 0,\n    value: 60,\n    description: 'Cast Cure Wounds once.',\n    consumable: true\n  },\n  scroll_identify: {\n    id: 'scroll_identify',\n    name: 'Scroll of Identify',\n    type: ITEM_TYPES.SCROLL,\n    rarity: ITEM_RARITY.COMMON,\n    spellId: 'identify',\n    weight: 0,\n    value: 60,\n    description: 'Identify a magic item instantly.',\n    consumable: true\n  },\n  scroll_misty_step: {\n    id: 'scroll_misty_step',\n    name: 'Scroll of Misty Step',\n    type: ITEM_TYPES.SCROLL,\n    rarity: ITEM_RARITY.UNCOMMON,\n    spellId: 'misty_step',\n    weight: 0,\n    value: 150,\n    description: 'Cast Misty Step once.',\n    consumable: true\n  },\n  // Accessories\n  cloak_of_protection: {\n    id: 'cloak_of_protection',\n    name: 'Cloak of Protection',\n    type: ITEM_TYPES.ACCESSORY,\n    rarity: ITEM_RARITY.UNCOMMON,\n    acBonus: 1,\n    saveBonus: 1,\n    weight: 1,\n    value: 750,\n    description: '+1 AC and saves. Attunement.',\n    magical: true\n  },\n  ring_of_protection: {\n    id: 'ring_of_protection',\n    name: 'Ring of Protection',\n    type: ITEM_TYPES.ACCESSORY,\n    rarity: ITEM_RARITY.RARE,\n    acBonus: 1,\n    saveBonus: 1,\n    weight: 0,\n    value: 3500,\n    description: '+1 AC and saves. Attunement.',\n    magical: true\n  },\n  amulet_of_health: {\n    id: 'amulet_of_health',\n    name: 'Amulet of Health',\n    type: ITEM_TYPES.ACCESSORY,\n    rarity: ITEM_RARITY.RARE,\n    effect: 'set_con_19',\n    weight: 0,\n    value: 8000,\n    description: 'Sets CON to 19. Attunement.',\n    magical: true\n  },\n  // Extra misc\n  tinderbox: {\n    id: 'tinderbox',\n    name: 'Tinderbox',\n    type: ITEM_TYPES.MISC,\n    rarity: ITEM_RARITY.COMMON,\n    weight: 1,\n    value: 5,\n    description: 'Light torches and campfires.'\n  },\n  bedroll: {\n    id: 'bedroll',\n    name: 'Bedroll',\n    type: ITEM_TYPES.MISC,\n    rarity: ITEM_RARITY.COMMON,\n    weight: 7,\n    value: 1,\n    description: 'For sleeping outdoors.'\n  },\n  rations: {\n    id: 'rations',\n    name: 'Rations (1 day)',\n    type: ITEM_TYPES.MISC,\n    rarity: ITEM_RARITY.COMMON,\n    weight: 2,\n    value: 5,\n    description: 'Dried food for travel.',\n    stackable: true\n  },\n  arrows: {\n    id: 'arrows',\n    name: 'Arrows (20)',\n    type: ITEM_TYPES.MISC,\n    rarity: ITEM_RARITY.COMMON,\n    weight: 1,\n    value: 1,\n    description: 'A quiver of 20 arrows.',\n    stackable: true\n  },\n  thieves_tools: {\n    id: 'thieves_tools',\n    name: \"Thieves' Tools\",\n    type: ITEM_TYPES.MISC,\n    rarity: ITEM_RARITY.COMMON,\n    weight: 1,\n    value: 25,\n    description: 'Pick locks and disarm traps.'\n  },\n  healers_kit: {\n    id: 'healers_kit',\n    name: \"Healer's Kit\",\n    type: ITEM_TYPES.MISC,\n    rarity: ITEM_RARITY.COMMON,\n    weight: 3,\n    value: 5,\n    description: 'Stabilize dying creatures (10 uses).',\n    stackable: true\n  }\n};\n\n// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n//  MERCHANT STOCK TABLES\n// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\nexport const MERCHANT_STOCK = {\n  [MERCHANT_TYPES.GENERAL]: ['healing', 'greater_healing', 'antitoxin', 'rope', 'torch', 'tinderbox', 'bedroll', 'rations', 'arrows', 'healers_kit', 'dagger', 'staff'],\n  [MERCHANT_TYPES.BLACKSMITH]: ['dagger', 'shortsword', 'longsword', 'greatsword', 'greataxe', 'handaxe', 'mace', 'rapier', 'flail', 'hand_crossbow', 'bow', 'shield_basic', 'leather', 'padded', 'hide', 'scale_mail', 'chainmail', 'breastplate', 'plus1_sword'],\n  [MERCHANT_TYPES.ALCHEMIST]: ['healing', 'greater_healing', 'superior_healing', 'mana', 'antitoxin', 'potion_of_speed', 'potion_of_invisibility', 'scroll_healing', 'scroll_identify'],\n  [MERCHANT_TYPES.MAGIC]: ['scroll_fireball', 'scroll_misty_step', 'scroll_healing', 'scroll_identify', 'mana', 'potion_of_speed', 'potion_of_invisibility', 'plus1_sword', 'flame_tongue_dagger', 'cloak_of_protection', 'ring_of_protection', 'amulet_of_health'],\n  [MERCHANT_TYPES.FENCE]: ['dagger', 'shortsword', 'leather', 'healing', 'rope', 'thieves_tools', 'torch', 'arrows', 'rations']\n};\n\n// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n//  NARRATION DETECTION\n// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\nexport function detectMerchantInNarration(narration) {\n  if (!narration) return null;\n  const lower = narration.toLowerCase();\n  const commerceKeywords = ['shop', 'store', 'merchant', 'vendor', 'trader', 'market', 'bazaar', 'sells', 'for sale', 'available for purchase', 'buy', 'wares', 'inn', 'tavern keeper', 'blacksmith', 'alchemist', 'weapons shop', 'armory', 'general store', 'emporium'];\n  if (!commerceKeywords.some(kw => lower.includes(kw))) return null;\n  let merchantType = MERCHANT_TYPES.GENERAL;\n  let merchantName = 'Local Merchant';\n  if (lower.includes('blacksmith') || lower.includes('armory') || lower.includes('weapon') && lower.includes('shop')) {\n    merchantType = MERCHANT_TYPES.BLACKSMITH;\n    merchantName = 'Blacksmith';\n  } else if (lower.includes('alchemist') || lower.includes('potion') && lower.includes('shop')) {\n    merchantType = MERCHANT_TYPES.ALCHEMIST;\n    merchantName = \"Alchemist's Shop\";\n  } else if (lower.includes('magic') || lower.includes('arcane') || lower.includes('emporium')) {\n    merchantType = MERCHANT_TYPES.MAGIC;\n    merchantName = 'Arcane Emporium';\n  } else if (lower.includes('fence') || lower.includes('shady') || lower.includes('black market')) {\n    merchantType = MERCHANT_TYPES.FENCE;\n    merchantName = 'Shady Dealer';\n  } else if (lower.includes('general store') || lower.includes('supply')) {\n    merchantType = MERCHANT_TYPES.GENERAL;\n    merchantName = 'General Store';\n  }\n  console.log(`[MerchantDetect] ${merchantType}: \"${merchantName}\"`);\n  return createMerchant(merchantType, merchantName);\n}\n\n// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n//  MERCHANT CREATION\n// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\nexport function createMerchant(type = MERCHANT_TYPES.GENERAL, name = null) {\n  const def = MERCHANT_DEFINITIONS[type];\n  const stockKeys = MERCHANT_STOCK[type] || MERCHANT_STOCK[MERCHANT_TYPES.GENERAL];\n  const stock = stockKeys.map(key => SHOP_ITEMS[key]).filter(Boolean).map(item => ({\n    ...item,\n    quantity: getInitialStock(item)\n  }));\n  return {\n    id: `merchant_${Date.now()}`,\n    type,\n    name: name || def.name,\n    icon: def.icon,\n    description: def.description,\n    buyMultiplier: def.buyMultiplier,\n    sellMultiplier: def.sellMultiplier,\n    stock\n  };\n}\nfunction getInitialStock(item) {\n  if (item.rarity === ITEM_RARITY.LEGENDARY || item.rarity === ITEM_RARITY.EPIC || item.rarity === ITEM_RARITY.RARE) return 1;\n  if (item.consumable || item.stackable) return Math.floor(Math.random() * 5) + 3;\n  return Math.floor(Math.random() * 2) + 1;\n}\n\n// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n//  GOLD HELPERS\n// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\nexport function getGold(character) {\n  const goldItem = (character.inventory || []).find(i => i.id === 'gold');\n  return goldItem ? goldItem.quantity || 0 : 0;\n}\nexport function adjustGold(character, amount) {\n  const current = getGold(character);\n  const newAmount = current + amount;\n  if (newAmount < 0) return {\n    success: false,\n    character,\n    newAmount: current,\n    message: 'Not enough gold!'\n  };\n  const inventory = character.inventory || [];\n  const goldIndex = inventory.findIndex(i => i.id === 'gold');\n  let newInventory;\n  if (goldIndex !== -1) {\n    newInventory = inventory.map((item, i) => i === goldIndex ? {\n      ...item,\n      quantity: newAmount\n    } : item);\n  } else if (amount > 0) {\n    newInventory = [...inventory, {\n      id: 'gold',\n      name: 'Gold Coins',\n      type: ITEM_TYPES.MISC,\n      rarity: ITEM_RARITY.COMMON,\n      weight: 0,\n      value: 1,\n      description: 'Shiny gold coins.',\n      stackable: true,\n      instanceId: `gold_${Date.now()}`,\n      quantity: newAmount,\n      equipped: false\n    }];\n  } else {\n    return {\n      success: false,\n      character,\n      newAmount: 0,\n      message: 'Not enough gold!'\n    };\n  }\n  return {\n    success: true,\n    character: {\n      ...character,\n      inventory: newInventory\n    },\n    newAmount,\n    message: amount > 0 ? `+${amount} gold` : `${amount} gold`\n  };\n}\n\n// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n//  BUY / SELL\n// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\nexport function getBuyPrice(item, merchant) {\n  return Math.ceil(item.value * merchant.buyMultiplier);\n}\nexport function getSellPrice(item, merchant) {\n  return Math.max(1, Math.floor(item.value * merchant.sellMultiplier));\n}\nexport function buyItem(character, merchant, shopItem, quantity = 1) {\n  const price = getBuyPrice(shopItem, merchant) * quantity;\n  const currentGold = getGold(character);\n  if (currentGold < price) return {\n    success: false,\n    character,\n    merchant,\n    message: `Not enough gold! Need ${price} gp, have ${currentGold} gp.`\n  };\n  const stockEntry = merchant.stock.find(s => s.id === shopItem.id);\n  if (!stockEntry || stockEntry.quantity < quantity) return {\n    success: false,\n    character,\n    merchant,\n    message: 'Not enough stock!'\n  };\n  const goldResult = adjustGold(character, -price);\n  if (!goldResult.success) return {\n    success: false,\n    character,\n    merchant,\n    message: goldResult.message\n  };\n\n  // Create item instance â€” falls back to direct instantiation for shop-only items not in ALL_ITEMS\n  let newItem = createItem(shopItem.id, quantity);\n  if (!newItem) {\n    newItem = {\n      ...shopItem,\n      instanceId: `${shopItem.id}_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\n      quantity: shopItem.stackable ? quantity : 1,\n      equipped: false\n    };\n  }\n  const newInventory = addItemToInventory(goldResult.character.inventory, newItem);\n  const updatedCharacter = {\n    ...goldResult.character,\n    inventory: newInventory\n  };\n  const updatedStock = merchant.stock.map(s => s.id === shopItem.id ? {\n    ...s,\n    quantity: s.quantity - quantity\n  } : s).filter(s => s.quantity > 0);\n  const updatedMerchant = {\n    ...merchant,\n    stock: updatedStock\n  };\n  console.log(`[Shop] ${character.name} bought ${quantity}x ${shopItem.name} for ${price} gp`);\n  return {\n    success: true,\n    character: updatedCharacter,\n    merchant: updatedMerchant,\n    message: `Bought ${quantity}x ${shopItem.name} for ${price} gp!`\n  };\n}\nexport function sellItem(character, merchant, inventoryItem, quantity = 1) {\n  if (inventoryItem.id === 'gold') return {\n    success: false,\n    character,\n    merchant,\n    message: \"You can't sell gold coins.\"\n  };\n  if (inventoryItem.type === ITEM_TYPES.QUEST) return {\n    success: false,\n    character,\n    merchant,\n    message: 'Quest items cannot be sold.'\n  };\n  const price = getSellPrice(inventoryItem, merchant) * quantity;\n  const newInventory = removeItemFromInventory(character.inventory || [], inventoryItem.instanceId, quantity);\n  const goldResult = adjustGold({\n    ...character,\n    inventory: newInventory\n  }, price);\n  console.log(`[Shop] ${character.name} sold ${quantity}x ${inventoryItem.name} for ${price} gp`);\n  return {\n    success: true,\n    character: goldResult.character,\n    merchant,\n    message: `Sold ${quantity}x ${inventoryItem.name} for ${price} gp!`\n  };\n}\nexport function formatGold(amount) {\n  if (amount >= 1000) return `${(amount / 1000).toFixed(amount % 1000 === 0 ? 0 : 1)}k gp`;\n  return `${amount} gp`;\n}\nexport const RARITY_ORDER = {\n  [ITEM_RARITY.COMMON.name]: 0,\n  [ITEM_RARITY.UNCOMMON.name]: 1,\n  [ITEM_RARITY.RARE.name]: 2,\n  [ITEM_RARITY.EPIC.name]: 3,\n  [ITEM_RARITY.LEGENDARY.name]: 4\n};","map":{"version":3,"names":["ITEM_TYPES","ITEM_RARITY","WEAPON_TEMPLATES","ARMOR_TEMPLATES","POTION_TEMPLATES","MISC_TEMPLATES","createItem","addItemToInventory","removeItemFromInventory","MERCHANT_TYPES","GENERAL","BLACKSMITH","ALCHEMIST","MAGIC","FENCE","MERCHANT_DEFINITIONS","name","icon","description","buyMultiplier","sellMultiplier","stockCategories","MISC","POTION","WEAPON","ARMOR","SHIELD","SCROLL","ACCESSORY","SHOP_ITEMS","handaxe","id","type","rarity","COMMON","damage","damageType","properties","weight","value","mace","rapier","flail","greatsword","hand_crossbow","plus1_sword","UNCOMMON","magical","flame_tongue_dagger","RARE","padded","ac","acBonus","hide","scale_mail","breastplate","shield_basic","superior_healing","effect","power","consumable","potion_of_speed","potion_of_invisibility","antitoxin","scroll_fireball","spellId","scroll_healing","scroll_identify","scroll_misty_step","cloak_of_protection","saveBonus","ring_of_protection","amulet_of_health","tinderbox","bedroll","rations","stackable","arrows","thieves_tools","healers_kit","MERCHANT_STOCK","detectMerchantInNarration","narration","lower","toLowerCase","commerceKeywords","some","kw","includes","merchantType","merchantName","console","log","createMerchant","def","stockKeys","stock","map","key","filter","Boolean","item","quantity","getInitialStock","Date","now","LEGENDARY","EPIC","Math","floor","random","getGold","character","goldItem","inventory","find","i","adjustGold","amount","current","newAmount","success","message","goldIndex","findIndex","newInventory","instanceId","equipped","getBuyPrice","merchant","ceil","getSellPrice","max","buyItem","shopItem","price","currentGold","stockEntry","s","goldResult","newItem","toString","substr","updatedCharacter","updatedStock","updatedMerchant","sellItem","inventoryItem","QUEST","formatGold","toFixed","RARITY_ORDER"],"sources":["C:/Users/Hakty/Desktop/AI-Dungeon-Master/frontend/src/utils/merchantSystem.js"],"sourcesContent":["// frontend/src/utils/merchantSystem.js\n\n/**\n * D&D 5e Merchant / Shop System\n *\n * Integrates with inventorySystem.js â€” gold is stored as a stackable\n * inventory item (id: 'gold') on the character, not a separate field.\n */\n\nimport {\n  ITEM_TYPES,\n  ITEM_RARITY,\n  WEAPON_TEMPLATES,\n  ARMOR_TEMPLATES,\n  POTION_TEMPLATES,\n  MISC_TEMPLATES,\n  createItem,\n  addItemToInventory,\n  removeItemFromInventory\n} from './inventorySystem';\n\n// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n//  MERCHANT TYPES\n// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\nexport const MERCHANT_TYPES = {\n  GENERAL:    'general',\n  BLACKSMITH: 'blacksmith',\n  ALCHEMIST:  'alchemist',\n  MAGIC:      'magic',\n  FENCE:      'fence'\n};\n\nexport const MERCHANT_DEFINITIONS = {\n  [MERCHANT_TYPES.GENERAL]: {\n    name: 'General Store', icon: 'ðŸª',\n    description: 'A well-stocked shop with everyday adventuring supplies.',\n    buyMultiplier: 1.0, sellMultiplier: 0.5,\n    stockCategories: [ITEM_TYPES.MISC, ITEM_TYPES.POTION, ITEM_TYPES.WEAPON]\n  },\n  [MERCHANT_TYPES.BLACKSMITH]: {\n    name: 'Blacksmith', icon: 'âš’ï¸',\n    description: 'A skilled smith who crafts and sells quality weapons and armor.',\n    buyMultiplier: 1.0, sellMultiplier: 0.6,\n    stockCategories: [ITEM_TYPES.WEAPON, ITEM_TYPES.ARMOR, ITEM_TYPES.SHIELD]\n  },\n  [MERCHANT_TYPES.ALCHEMIST]: {\n    name: 'Alchemist', icon: 'âš—ï¸',\n    description: 'A master of potions and elixirs.',\n    buyMultiplier: 1.0, sellMultiplier: 0.4,\n    stockCategories: [ITEM_TYPES.POTION, ITEM_TYPES.SCROLL]\n  },\n  [MERCHANT_TYPES.MAGIC]: {\n    name: 'Arcane Emporium', icon: 'ðŸ”®',\n    description: 'Rare and magical items for those who know their worth.',\n    buyMultiplier: 1.2, sellMultiplier: 0.6,\n    stockCategories: [ITEM_TYPES.SCROLL, ITEM_TYPES.ACCESSORY, ITEM_TYPES.POTION]\n  },\n  [MERCHANT_TYPES.FENCE]: {\n    name: 'Shady Dealer', icon: 'ðŸ•µï¸',\n    description: 'Asks no questions. Pays poorly. Sells cheap.',\n    buyMultiplier: 0.7, sellMultiplier: 0.7,\n    stockCategories: [ITEM_TYPES.WEAPON, ITEM_TYPES.MISC, ITEM_TYPES.ARMOR]\n  }\n};\n\n// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n//  SHOP ITEM CATALOG\n// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\nexport const SHOP_ITEMS = {\n  ...WEAPON_TEMPLATES,\n  ...ARMOR_TEMPLATES,\n  ...POTION_TEMPLATES,\n  ...MISC_TEMPLATES,\n\n  // Extra weapons\n  handaxe: { id: 'handaxe', name: 'Handaxe', type: ITEM_TYPES.WEAPON, rarity: ITEM_RARITY.COMMON, damage: '1d6', damageType: 'slashing', properties: ['light', 'thrown (20/60)'], weight: 2, value: 5, description: 'A light axe that can be thrown.' },\n  mace: { id: 'mace', name: 'Mace', type: ITEM_TYPES.WEAPON, rarity: ITEM_RARITY.COMMON, damage: '1d6', damageType: 'bludgeoning', properties: [], weight: 4, value: 5, description: 'A heavy flanged club.' },\n  rapier: { id: 'rapier', name: 'Rapier', type: ITEM_TYPES.WEAPON, rarity: ITEM_RARITY.COMMON, damage: '1d8', damageType: 'piercing', properties: ['finesse'], weight: 2, value: 25, description: 'An elegant blade for the skilled duelist.' },\n  flail: { id: 'flail', name: 'Flail', type: ITEM_TYPES.WEAPON, rarity: ITEM_RARITY.COMMON, damage: '1d8', damageType: 'bludgeoning', properties: [], weight: 2, value: 10, description: 'A spiked ball on a chain.' },\n  greatsword: { id: 'greatsword', name: 'Greatsword', type: ITEM_TYPES.WEAPON, rarity: ITEM_RARITY.COMMON, damage: '2d6', damageType: 'slashing', properties: ['heavy', 'two-handed'], weight: 6, value: 50, description: 'A massive two-handed blade.' },\n  hand_crossbow: { id: 'hand_crossbow', name: 'Hand Crossbow', type: ITEM_TYPES.WEAPON, rarity: ITEM_RARITY.COMMON, damage: '1d6', damageType: 'piercing', properties: ['ammunition (30/120)', 'light'], weight: 3, value: 75, description: 'A compact crossbow, easily concealed.' },\n  plus1_sword: { id: 'plus1_sword', name: '+1 Longsword', type: ITEM_TYPES.WEAPON, rarity: ITEM_RARITY.UNCOMMON, damage: '1d8+1', damageType: 'slashing', properties: ['versatile (1d10+1)', 'magical'], weight: 3, value: 500, description: 'A magically enhanced longsword.', magical: true },\n  flame_tongue_dagger: { id: 'flame_tongue_dagger', name: 'Flame Tongue Dagger', type: ITEM_TYPES.WEAPON, rarity: ITEM_RARITY.RARE, damage: '1d4+2d6', damageType: 'piercing + fire', properties: ['light', 'finesse', 'magical'], weight: 1, value: 2500, description: 'A dagger wreathed in magical flames.', magical: true },\n\n  // Extra armor\n  padded: { id: 'padded', name: 'Padded Armor', type: ITEM_TYPES.ARMOR, rarity: ITEM_RARITY.COMMON, ac: 11, acBonus: 'DEX', weight: 8, value: 5, description: 'Quilted layers of cloth.' },\n  hide: { id: 'hide', name: 'Hide Armor', type: ITEM_TYPES.ARMOR, rarity: ITEM_RARITY.COMMON, ac: 12, acBonus: 'DEX_MAX2', weight: 12, value: 10, description: 'Crude armor from thick hides.' },\n  scale_mail: { id: 'scale_mail', name: 'Scale Mail', type: ITEM_TYPES.ARMOR, rarity: ITEM_RARITY.COMMON, ac: 14, acBonus: 'DEX_MAX2', weight: 45, value: 50, description: 'Overlapping metal scales on leather.' },\n  breastplate: { id: 'breastplate', name: 'Breastplate', type: ITEM_TYPES.ARMOR, rarity: ITEM_RARITY.UNCOMMON, ac: 14, acBonus: 'DEX_MAX2', weight: 20, value: 400, description: 'A fitted metal chest piece.' },\n  shield_basic: { id: 'shield_basic', name: 'Shield', type: ITEM_TYPES.SHIELD, rarity: ITEM_RARITY.COMMON, acBonus: 2, weight: 6, value: 10, description: 'A wooden or metal shield. +2 AC.' },\n\n  // Extra potions\n  superior_healing: { id: 'superior_healing', name: 'Potion of Superior Healing', type: ITEM_TYPES.POTION, rarity: ITEM_RARITY.RARE, effect: 'heal', power: '8d4+8', weight: 0.5, value: 500, description: 'Surges with healing energy.', consumable: true },\n  potion_of_speed: { id: 'potion_of_speed', name: 'Potion of Speed', type: ITEM_TYPES.POTION, rarity: ITEM_RARITY.RARE, effect: 'haste', power: 1, weight: 0.5, value: 400, description: 'Grants Haste for 1 minute.', consumable: true },\n  potion_of_invisibility: { id: 'potion_of_invisibility', name: 'Potion of Invisibility', type: ITEM_TYPES.POTION, rarity: ITEM_RARITY.RARE, effect: 'invisibility', power: 1, weight: 0.5, value: 180, description: 'Invisible for 1 hour.', consumable: true },\n  antitoxin: { id: 'antitoxin', name: 'Antitoxin', type: ITEM_TYPES.POTION, rarity: ITEM_RARITY.COMMON, effect: 'cure_poison', power: 1, weight: 0.5, value: 50, description: 'Advantage on poison saves for 1 hour.', consumable: true },\n\n  // Scrolls\n  scroll_fireball: { id: 'scroll_fireball', name: 'Scroll of Fireball', type: ITEM_TYPES.SCROLL, rarity: ITEM_RARITY.UNCOMMON, spellId: 'fireball', weight: 0, value: 300, description: 'Cast Fireball once.', consumable: true },\n  scroll_healing: { id: 'scroll_healing', name: 'Scroll of Cure Wounds', type: ITEM_TYPES.SCROLL, rarity: ITEM_RARITY.COMMON, spellId: 'cure_wounds', weight: 0, value: 60, description: 'Cast Cure Wounds once.', consumable: true },\n  scroll_identify: { id: 'scroll_identify', name: 'Scroll of Identify', type: ITEM_TYPES.SCROLL, rarity: ITEM_RARITY.COMMON, spellId: 'identify', weight: 0, value: 60, description: 'Identify a magic item instantly.', consumable: true },\n  scroll_misty_step: { id: 'scroll_misty_step', name: 'Scroll of Misty Step', type: ITEM_TYPES.SCROLL, rarity: ITEM_RARITY.UNCOMMON, spellId: 'misty_step', weight: 0, value: 150, description: 'Cast Misty Step once.', consumable: true },\n\n  // Accessories\n  cloak_of_protection: { id: 'cloak_of_protection', name: 'Cloak of Protection', type: ITEM_TYPES.ACCESSORY, rarity: ITEM_RARITY.UNCOMMON, acBonus: 1, saveBonus: 1, weight: 1, value: 750, description: '+1 AC and saves. Attunement.', magical: true },\n  ring_of_protection: { id: 'ring_of_protection', name: 'Ring of Protection', type: ITEM_TYPES.ACCESSORY, rarity: ITEM_RARITY.RARE, acBonus: 1, saveBonus: 1, weight: 0, value: 3500, description: '+1 AC and saves. Attunement.', magical: true },\n  amulet_of_health: { id: 'amulet_of_health', name: 'Amulet of Health', type: ITEM_TYPES.ACCESSORY, rarity: ITEM_RARITY.RARE, effect: 'set_con_19', weight: 0, value: 8000, description: 'Sets CON to 19. Attunement.', magical: true },\n\n  // Extra misc\n  tinderbox: { id: 'tinderbox', name: 'Tinderbox', type: ITEM_TYPES.MISC, rarity: ITEM_RARITY.COMMON, weight: 1, value: 5, description: 'Light torches and campfires.' },\n  bedroll: { id: 'bedroll', name: 'Bedroll', type: ITEM_TYPES.MISC, rarity: ITEM_RARITY.COMMON, weight: 7, value: 1, description: 'For sleeping outdoors.' },\n  rations: { id: 'rations', name: 'Rations (1 day)', type: ITEM_TYPES.MISC, rarity: ITEM_RARITY.COMMON, weight: 2, value: 5, description: 'Dried food for travel.', stackable: true },\n  arrows: { id: 'arrows', name: 'Arrows (20)', type: ITEM_TYPES.MISC, rarity: ITEM_RARITY.COMMON, weight: 1, value: 1, description: 'A quiver of 20 arrows.', stackable: true },\n  thieves_tools: { id: 'thieves_tools', name: \"Thieves' Tools\", type: ITEM_TYPES.MISC, rarity: ITEM_RARITY.COMMON, weight: 1, value: 25, description: 'Pick locks and disarm traps.' },\n  healers_kit: { id: 'healers_kit', name: \"Healer's Kit\", type: ITEM_TYPES.MISC, rarity: ITEM_RARITY.COMMON, weight: 3, value: 5, description: 'Stabilize dying creatures (10 uses).', stackable: true }\n};\n\n// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n//  MERCHANT STOCK TABLES\n// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\nexport const MERCHANT_STOCK = {\n  [MERCHANT_TYPES.GENERAL]:    ['healing', 'greater_healing', 'antitoxin', 'rope', 'torch', 'tinderbox', 'bedroll', 'rations', 'arrows', 'healers_kit', 'dagger', 'staff'],\n  [MERCHANT_TYPES.BLACKSMITH]: ['dagger', 'shortsword', 'longsword', 'greatsword', 'greataxe', 'handaxe', 'mace', 'rapier', 'flail', 'hand_crossbow', 'bow', 'shield_basic', 'leather', 'padded', 'hide', 'scale_mail', 'chainmail', 'breastplate', 'plus1_sword'],\n  [MERCHANT_TYPES.ALCHEMIST]:  ['healing', 'greater_healing', 'superior_healing', 'mana', 'antitoxin', 'potion_of_speed', 'potion_of_invisibility', 'scroll_healing', 'scroll_identify'],\n  [MERCHANT_TYPES.MAGIC]:      ['scroll_fireball', 'scroll_misty_step', 'scroll_healing', 'scroll_identify', 'mana', 'potion_of_speed', 'potion_of_invisibility', 'plus1_sword', 'flame_tongue_dagger', 'cloak_of_protection', 'ring_of_protection', 'amulet_of_health'],\n  [MERCHANT_TYPES.FENCE]:      ['dagger', 'shortsword', 'leather', 'healing', 'rope', 'thieves_tools', 'torch', 'arrows', 'rations']\n};\n\n// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n//  NARRATION DETECTION\n// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\nexport function detectMerchantInNarration(narration) {\n  if (!narration) return null;\n  const lower = narration.toLowerCase();\n\n  const commerceKeywords = ['shop', 'store', 'merchant', 'vendor', 'trader', 'market', 'bazaar', 'sells', 'for sale', 'available for purchase', 'buy', 'wares', 'inn', 'tavern keeper', 'blacksmith', 'alchemist', 'weapons shop', 'armory', 'general store', 'emporium'];\n  if (!commerceKeywords.some(kw => lower.includes(kw))) return null;\n\n  let merchantType = MERCHANT_TYPES.GENERAL;\n  let merchantName = 'Local Merchant';\n\n  if (lower.includes('blacksmith') || lower.includes('armory') || (lower.includes('weapon') && lower.includes('shop'))) {\n    merchantType = MERCHANT_TYPES.BLACKSMITH; merchantName = 'Blacksmith';\n  } else if (lower.includes('alchemist') || (lower.includes('potion') && lower.includes('shop'))) {\n    merchantType = MERCHANT_TYPES.ALCHEMIST; merchantName = \"Alchemist's Shop\";\n  } else if (lower.includes('magic') || lower.includes('arcane') || lower.includes('emporium')) {\n    merchantType = MERCHANT_TYPES.MAGIC; merchantName = 'Arcane Emporium';\n  } else if (lower.includes('fence') || lower.includes('shady') || lower.includes('black market')) {\n    merchantType = MERCHANT_TYPES.FENCE; merchantName = 'Shady Dealer';\n  } else if (lower.includes('general store') || lower.includes('supply')) {\n    merchantType = MERCHANT_TYPES.GENERAL; merchantName = 'General Store';\n  }\n\n  console.log(`[MerchantDetect] ${merchantType}: \"${merchantName}\"`);\n  return createMerchant(merchantType, merchantName);\n}\n\n// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n//  MERCHANT CREATION\n// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\nexport function createMerchant(type = MERCHANT_TYPES.GENERAL, name = null) {\n  const def = MERCHANT_DEFINITIONS[type];\n  const stockKeys = MERCHANT_STOCK[type] || MERCHANT_STOCK[MERCHANT_TYPES.GENERAL];\n  const stock = stockKeys.map(key => SHOP_ITEMS[key]).filter(Boolean).map(item => ({ ...item, quantity: getInitialStock(item) }));\n  return { id: `merchant_${Date.now()}`, type, name: name || def.name, icon: def.icon, description: def.description, buyMultiplier: def.buyMultiplier, sellMultiplier: def.sellMultiplier, stock };\n}\n\nfunction getInitialStock(item) {\n  if (item.rarity === ITEM_RARITY.LEGENDARY || item.rarity === ITEM_RARITY.EPIC || item.rarity === ITEM_RARITY.RARE) return 1;\n  if (item.consumable || item.stackable) return Math.floor(Math.random() * 5) + 3;\n  return Math.floor(Math.random() * 2) + 1;\n}\n\n// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n//  GOLD HELPERS\n// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\nexport function getGold(character) {\n  const goldItem = (character.inventory || []).find(i => i.id === 'gold');\n  return goldItem ? (goldItem.quantity || 0) : 0;\n}\n\nexport function adjustGold(character, amount) {\n  const current = getGold(character);\n  const newAmount = current + amount;\n  if (newAmount < 0) return { success: false, character, newAmount: current, message: 'Not enough gold!' };\n\n  const inventory = character.inventory || [];\n  const goldIndex = inventory.findIndex(i => i.id === 'gold');\n  let newInventory;\n\n  if (goldIndex !== -1) {\n    newInventory = inventory.map((item, i) => i === goldIndex ? { ...item, quantity: newAmount } : item);\n  } else if (amount > 0) {\n    newInventory = [...inventory, { id: 'gold', name: 'Gold Coins', type: ITEM_TYPES.MISC, rarity: ITEM_RARITY.COMMON, weight: 0, value: 1, description: 'Shiny gold coins.', stackable: true, instanceId: `gold_${Date.now()}`, quantity: newAmount, equipped: false }];\n  } else {\n    return { success: false, character, newAmount: 0, message: 'Not enough gold!' };\n  }\n\n  return { success: true, character: { ...character, inventory: newInventory }, newAmount, message: amount > 0 ? `+${amount} gold` : `${amount} gold` };\n}\n\n// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n//  BUY / SELL\n// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\nexport function getBuyPrice(item, merchant) {\n  return Math.ceil(item.value * merchant.buyMultiplier);\n}\n\nexport function getSellPrice(item, merchant) {\n  return Math.max(1, Math.floor(item.value * merchant.sellMultiplier));\n}\n\nexport function buyItem(character, merchant, shopItem, quantity = 1) {\n  const price = getBuyPrice(shopItem, merchant) * quantity;\n  const currentGold = getGold(character);\n  if (currentGold < price) return { success: false, character, merchant, message: `Not enough gold! Need ${price} gp, have ${currentGold} gp.` };\n\n  const stockEntry = merchant.stock.find(s => s.id === shopItem.id);\n  if (!stockEntry || stockEntry.quantity < quantity) return { success: false, character, merchant, message: 'Not enough stock!' };\n\n  const goldResult = adjustGold(character, -price);\n  if (!goldResult.success) return { success: false, character, merchant, message: goldResult.message };\n\n  // Create item instance â€” falls back to direct instantiation for shop-only items not in ALL_ITEMS\n  let newItem = createItem(shopItem.id, quantity);\n  if (!newItem) {\n    newItem = {\n      ...shopItem,\n      instanceId: `${shopItem.id}_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\n      quantity: shopItem.stackable ? quantity : 1,\n      equipped: false\n    };\n  }\n  const newInventory = addItemToInventory(goldResult.character.inventory, newItem);\n  const updatedCharacter = { ...goldResult.character, inventory: newInventory };\n  const updatedStock = merchant.stock.map(s => s.id === shopItem.id ? { ...s, quantity: s.quantity - quantity } : s).filter(s => s.quantity > 0);\n  const updatedMerchant = { ...merchant, stock: updatedStock };\n\n  console.log(`[Shop] ${character.name} bought ${quantity}x ${shopItem.name} for ${price} gp`);\n  return { success: true, character: updatedCharacter, merchant: updatedMerchant, message: `Bought ${quantity}x ${shopItem.name} for ${price} gp!` };\n}\n\nexport function sellItem(character, merchant, inventoryItem, quantity = 1) {\n  if (inventoryItem.id === 'gold') return { success: false, character, merchant, message: \"You can't sell gold coins.\" };\n  if (inventoryItem.type === ITEM_TYPES.QUEST) return { success: false, character, merchant, message: 'Quest items cannot be sold.' };\n\n  const price = getSellPrice(inventoryItem, merchant) * quantity;\n  const newInventory = removeItemFromInventory(character.inventory || [], inventoryItem.instanceId, quantity);\n  const goldResult = adjustGold({ ...character, inventory: newInventory }, price);\n\n  console.log(`[Shop] ${character.name} sold ${quantity}x ${inventoryItem.name} for ${price} gp`);\n  return { success: true, character: goldResult.character, merchant, message: `Sold ${quantity}x ${inventoryItem.name} for ${price} gp!` };\n}\n\nexport function formatGold(amount) {\n  if (amount >= 1000) return `${(amount / 1000).toFixed(amount % 1000 === 0 ? 0 : 1)}k gp`;\n  return `${amount} gp`;\n}\n\nexport const RARITY_ORDER = {\n  [ITEM_RARITY.COMMON.name]: 0,\n  [ITEM_RARITY.UNCOMMON.name]: 1,\n  [ITEM_RARITY.RARE.name]: 2,\n  [ITEM_RARITY.EPIC.name]: 3,\n  [ITEM_RARITY.LEGENDARY.name]: 4\n};"],"mappings":"AAAA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA,SACEA,UAAU,EACVC,WAAW,EACXC,gBAAgB,EAChBC,eAAe,EACfC,gBAAgB,EAChBC,cAAc,EACdC,UAAU,EACVC,kBAAkB,EAClBC,uBAAuB,QAClB,mBAAmB;;AAE1B;AACA;AACA;;AAEA,OAAO,MAAMC,cAAc,GAAG;EAC5BC,OAAO,EAAK,SAAS;EACrBC,UAAU,EAAE,YAAY;EACxBC,SAAS,EAAG,WAAW;EACvBC,KAAK,EAAO,OAAO;EACnBC,KAAK,EAAO;AACd,CAAC;AAED,OAAO,MAAMC,oBAAoB,GAAG;EAClC,CAACN,cAAc,CAACC,OAAO,GAAG;IACxBM,IAAI,EAAE,eAAe;IAAEC,IAAI,EAAE,IAAI;IACjCC,WAAW,EAAE,yDAAyD;IACtEC,aAAa,EAAE,GAAG;IAAEC,cAAc,EAAE,GAAG;IACvCC,eAAe,EAAE,CAACrB,UAAU,CAACsB,IAAI,EAAEtB,UAAU,CAACuB,MAAM,EAAEvB,UAAU,CAACwB,MAAM;EACzE,CAAC;EACD,CAACf,cAAc,CAACE,UAAU,GAAG;IAC3BK,IAAI,EAAE,YAAY;IAAEC,IAAI,EAAE,IAAI;IAC9BC,WAAW,EAAE,iEAAiE;IAC9EC,aAAa,EAAE,GAAG;IAAEC,cAAc,EAAE,GAAG;IACvCC,eAAe,EAAE,CAACrB,UAAU,CAACwB,MAAM,EAAExB,UAAU,CAACyB,KAAK,EAAEzB,UAAU,CAAC0B,MAAM;EAC1E,CAAC;EACD,CAACjB,cAAc,CAACG,SAAS,GAAG;IAC1BI,IAAI,EAAE,WAAW;IAAEC,IAAI,EAAE,IAAI;IAC7BC,WAAW,EAAE,kCAAkC;IAC/CC,aAAa,EAAE,GAAG;IAAEC,cAAc,EAAE,GAAG;IACvCC,eAAe,EAAE,CAACrB,UAAU,CAACuB,MAAM,EAAEvB,UAAU,CAAC2B,MAAM;EACxD,CAAC;EACD,CAAClB,cAAc,CAACI,KAAK,GAAG;IACtBG,IAAI,EAAE,iBAAiB;IAAEC,IAAI,EAAE,IAAI;IACnCC,WAAW,EAAE,wDAAwD;IACrEC,aAAa,EAAE,GAAG;IAAEC,cAAc,EAAE,GAAG;IACvCC,eAAe,EAAE,CAACrB,UAAU,CAAC2B,MAAM,EAAE3B,UAAU,CAAC4B,SAAS,EAAE5B,UAAU,CAACuB,MAAM;EAC9E,CAAC;EACD,CAACd,cAAc,CAACK,KAAK,GAAG;IACtBE,IAAI,EAAE,cAAc;IAAEC,IAAI,EAAE,KAAK;IACjCC,WAAW,EAAE,8CAA8C;IAC3DC,aAAa,EAAE,GAAG;IAAEC,cAAc,EAAE,GAAG;IACvCC,eAAe,EAAE,CAACrB,UAAU,CAACwB,MAAM,EAAExB,UAAU,CAACsB,IAAI,EAAEtB,UAAU,CAACyB,KAAK;EACxE;AACF,CAAC;;AAED;AACA;AACA;;AAEA,OAAO,MAAMI,UAAU,GAAG;EACxB,GAAG3B,gBAAgB;EACnB,GAAGC,eAAe;EAClB,GAAGC,gBAAgB;EACnB,GAAGC,cAAc;EAEjB;EACAyB,OAAO,EAAE;IAAEC,EAAE,EAAE,SAAS;IAAEf,IAAI,EAAE,SAAS;IAAEgB,IAAI,EAAEhC,UAAU,CAACwB,MAAM;IAAES,MAAM,EAAEhC,WAAW,CAACiC,MAAM;IAAEC,MAAM,EAAE,KAAK;IAAEC,UAAU,EAAE,UAAU;IAAEC,UAAU,EAAE,CAAC,OAAO,EAAE,gBAAgB,CAAC;IAAEC,MAAM,EAAE,CAAC;IAAEC,KAAK,EAAE,CAAC;IAAErB,WAAW,EAAE;EAAkC,CAAC;EACrPsB,IAAI,EAAE;IAAET,EAAE,EAAE,MAAM;IAAEf,IAAI,EAAE,MAAM;IAAEgB,IAAI,EAAEhC,UAAU,CAACwB,MAAM;IAAES,MAAM,EAAEhC,WAAW,CAACiC,MAAM;IAAEC,MAAM,EAAE,KAAK;IAAEC,UAAU,EAAE,aAAa;IAAEC,UAAU,EAAE,EAAE;IAAEC,MAAM,EAAE,CAAC;IAAEC,KAAK,EAAE,CAAC;IAAErB,WAAW,EAAE;EAAwB,CAAC;EAC5MuB,MAAM,EAAE;IAAEV,EAAE,EAAE,QAAQ;IAAEf,IAAI,EAAE,QAAQ;IAAEgB,IAAI,EAAEhC,UAAU,CAACwB,MAAM;IAAES,MAAM,EAAEhC,WAAW,CAACiC,MAAM;IAAEC,MAAM,EAAE,KAAK;IAAEC,UAAU,EAAE,UAAU;IAAEC,UAAU,EAAE,CAAC,SAAS,CAAC;IAAEC,MAAM,EAAE,CAAC;IAAEC,KAAK,EAAE,EAAE;IAAErB,WAAW,EAAE;EAA4C,CAAC;EAC7OwB,KAAK,EAAE;IAAEX,EAAE,EAAE,OAAO;IAAEf,IAAI,EAAE,OAAO;IAAEgB,IAAI,EAAEhC,UAAU,CAACwB,MAAM;IAAES,MAAM,EAAEhC,WAAW,CAACiC,MAAM;IAAEC,MAAM,EAAE,KAAK;IAAEC,UAAU,EAAE,aAAa;IAAEC,UAAU,EAAE,EAAE;IAAEC,MAAM,EAAE,CAAC;IAAEC,KAAK,EAAE,EAAE;IAAErB,WAAW,EAAE;EAA4B,CAAC;EACpNyB,UAAU,EAAE;IAAEZ,EAAE,EAAE,YAAY;IAAEf,IAAI,EAAE,YAAY;IAAEgB,IAAI,EAAEhC,UAAU,CAACwB,MAAM;IAAES,MAAM,EAAEhC,WAAW,CAACiC,MAAM;IAAEC,MAAM,EAAE,KAAK;IAAEC,UAAU,EAAE,UAAU;IAAEC,UAAU,EAAE,CAAC,OAAO,EAAE,YAAY,CAAC;IAAEC,MAAM,EAAE,CAAC;IAAEC,KAAK,EAAE,EAAE;IAAErB,WAAW,EAAE;EAA8B,CAAC;EACvP0B,aAAa,EAAE;IAAEb,EAAE,EAAE,eAAe;IAAEf,IAAI,EAAE,eAAe;IAAEgB,IAAI,EAAEhC,UAAU,CAACwB,MAAM;IAAES,MAAM,EAAEhC,WAAW,CAACiC,MAAM;IAAEC,MAAM,EAAE,KAAK;IAAEC,UAAU,EAAE,UAAU;IAAEC,UAAU,EAAE,CAAC,qBAAqB,EAAE,OAAO,CAAC;IAAEC,MAAM,EAAE,CAAC;IAAEC,KAAK,EAAE,EAAE;IAAErB,WAAW,EAAE;EAAwC,CAAC;EACnR2B,WAAW,EAAE;IAAEd,EAAE,EAAE,aAAa;IAAEf,IAAI,EAAE,cAAc;IAAEgB,IAAI,EAAEhC,UAAU,CAACwB,MAAM;IAAES,MAAM,EAAEhC,WAAW,CAAC6C,QAAQ;IAAEX,MAAM,EAAE,OAAO;IAAEC,UAAU,EAAE,UAAU;IAAEC,UAAU,EAAE,CAAC,oBAAoB,EAAE,SAAS,CAAC;IAAEC,MAAM,EAAE,CAAC;IAAEC,KAAK,EAAE,GAAG;IAAErB,WAAW,EAAE,iCAAiC;IAAE6B,OAAO,EAAE;EAAK,CAAC;EAC7RC,mBAAmB,EAAE;IAAEjB,EAAE,EAAE,qBAAqB;IAAEf,IAAI,EAAE,qBAAqB;IAAEgB,IAAI,EAAEhC,UAAU,CAACwB,MAAM;IAAES,MAAM,EAAEhC,WAAW,CAACgD,IAAI;IAAEd,MAAM,EAAE,SAAS;IAAEC,UAAU,EAAE,iBAAiB;IAAEC,UAAU,EAAE,CAAC,OAAO,EAAE,SAAS,EAAE,SAAS,CAAC;IAAEC,MAAM,EAAE,CAAC;IAAEC,KAAK,EAAE,IAAI;IAAErB,WAAW,EAAE,sCAAsC;IAAE6B,OAAO,EAAE;EAAK,CAAC;EAE7T;EACAG,MAAM,EAAE;IAAEnB,EAAE,EAAE,QAAQ;IAAEf,IAAI,EAAE,cAAc;IAAEgB,IAAI,EAAEhC,UAAU,CAACyB,KAAK;IAAEQ,MAAM,EAAEhC,WAAW,CAACiC,MAAM;IAAEiB,EAAE,EAAE,EAAE;IAAEC,OAAO,EAAE,KAAK;IAAEd,MAAM,EAAE,CAAC;IAAEC,KAAK,EAAE,CAAC;IAAErB,WAAW,EAAE;EAA2B,CAAC;EACxLmC,IAAI,EAAE;IAAEtB,EAAE,EAAE,MAAM;IAAEf,IAAI,EAAE,YAAY;IAAEgB,IAAI,EAAEhC,UAAU,CAACyB,KAAK;IAAEQ,MAAM,EAAEhC,WAAW,CAACiC,MAAM;IAAEiB,EAAE,EAAE,EAAE;IAAEC,OAAO,EAAE,UAAU;IAAEd,MAAM,EAAE,EAAE;IAAEC,KAAK,EAAE,EAAE;IAAErB,WAAW,EAAE;EAAgC,CAAC;EAC9LoC,UAAU,EAAE;IAAEvB,EAAE,EAAE,YAAY;IAAEf,IAAI,EAAE,YAAY;IAAEgB,IAAI,EAAEhC,UAAU,CAACyB,KAAK;IAAEQ,MAAM,EAAEhC,WAAW,CAACiC,MAAM;IAAEiB,EAAE,EAAE,EAAE;IAAEC,OAAO,EAAE,UAAU;IAAEd,MAAM,EAAE,EAAE;IAAEC,KAAK,EAAE,EAAE;IAAErB,WAAW,EAAE;EAAuC,CAAC;EACjNqC,WAAW,EAAE;IAAExB,EAAE,EAAE,aAAa;IAAEf,IAAI,EAAE,aAAa;IAAEgB,IAAI,EAAEhC,UAAU,CAACyB,KAAK;IAAEQ,MAAM,EAAEhC,WAAW,CAAC6C,QAAQ;IAAEK,EAAE,EAAE,EAAE;IAAEC,OAAO,EAAE,UAAU;IAAEd,MAAM,EAAE,EAAE;IAAEC,KAAK,EAAE,GAAG;IAAErB,WAAW,EAAE;EAA8B,CAAC;EAC9MsC,YAAY,EAAE;IAAEzB,EAAE,EAAE,cAAc;IAAEf,IAAI,EAAE,QAAQ;IAAEgB,IAAI,EAAEhC,UAAU,CAAC0B,MAAM;IAAEO,MAAM,EAAEhC,WAAW,CAACiC,MAAM;IAAEkB,OAAO,EAAE,CAAC;IAAEd,MAAM,EAAE,CAAC;IAAEC,KAAK,EAAE,EAAE;IAAErB,WAAW,EAAE;EAAmC,CAAC;EAE5L;EACAuC,gBAAgB,EAAE;IAAE1B,EAAE,EAAE,kBAAkB;IAAEf,IAAI,EAAE,4BAA4B;IAAEgB,IAAI,EAAEhC,UAAU,CAACuB,MAAM;IAAEU,MAAM,EAAEhC,WAAW,CAACgD,IAAI;IAAES,MAAM,EAAE,MAAM;IAAEC,KAAK,EAAE,OAAO;IAAErB,MAAM,EAAE,GAAG;IAAEC,KAAK,EAAE,GAAG;IAAErB,WAAW,EAAE,6BAA6B;IAAE0C,UAAU,EAAE;EAAK,CAAC;EAC1PC,eAAe,EAAE;IAAE9B,EAAE,EAAE,iBAAiB;IAAEf,IAAI,EAAE,iBAAiB;IAAEgB,IAAI,EAAEhC,UAAU,CAACuB,MAAM;IAAEU,MAAM,EAAEhC,WAAW,CAACgD,IAAI;IAAES,MAAM,EAAE,OAAO;IAAEC,KAAK,EAAE,CAAC;IAAErB,MAAM,EAAE,GAAG;IAAEC,KAAK,EAAE,GAAG;IAAErB,WAAW,EAAE,4BAA4B;IAAE0C,UAAU,EAAE;EAAK,CAAC;EACvOE,sBAAsB,EAAE;IAAE/B,EAAE,EAAE,wBAAwB;IAAEf,IAAI,EAAE,wBAAwB;IAAEgB,IAAI,EAAEhC,UAAU,CAACuB,MAAM;IAAEU,MAAM,EAAEhC,WAAW,CAACgD,IAAI;IAAES,MAAM,EAAE,cAAc;IAAEC,KAAK,EAAE,CAAC;IAAErB,MAAM,EAAE,GAAG;IAAEC,KAAK,EAAE,GAAG;IAAErB,WAAW,EAAE,uBAAuB;IAAE0C,UAAU,EAAE;EAAK,CAAC;EAC9PG,SAAS,EAAE;IAAEhC,EAAE,EAAE,WAAW;IAAEf,IAAI,EAAE,WAAW;IAAEgB,IAAI,EAAEhC,UAAU,CAACuB,MAAM;IAAEU,MAAM,EAAEhC,WAAW,CAACiC,MAAM;IAAEwB,MAAM,EAAE,aAAa;IAAEC,KAAK,EAAE,CAAC;IAAErB,MAAM,EAAE,GAAG;IAAEC,KAAK,EAAE,EAAE;IAAErB,WAAW,EAAE,uCAAuC;IAAE0C,UAAU,EAAE;EAAK,CAAC;EAEvO;EACAI,eAAe,EAAE;IAAEjC,EAAE,EAAE,iBAAiB;IAAEf,IAAI,EAAE,oBAAoB;IAAEgB,IAAI,EAAEhC,UAAU,CAAC2B,MAAM;IAAEM,MAAM,EAAEhC,WAAW,CAAC6C,QAAQ;IAAEmB,OAAO,EAAE,UAAU;IAAE3B,MAAM,EAAE,CAAC;IAAEC,KAAK,EAAE,GAAG;IAAErB,WAAW,EAAE,qBAAqB;IAAE0C,UAAU,EAAE;EAAK,CAAC;EAC/NM,cAAc,EAAE;IAAEnC,EAAE,EAAE,gBAAgB;IAAEf,IAAI,EAAE,uBAAuB;IAAEgB,IAAI,EAAEhC,UAAU,CAAC2B,MAAM;IAAEM,MAAM,EAAEhC,WAAW,CAACiC,MAAM;IAAE+B,OAAO,EAAE,aAAa;IAAE3B,MAAM,EAAE,CAAC;IAAEC,KAAK,EAAE,EAAE;IAAErB,WAAW,EAAE,wBAAwB;IAAE0C,UAAU,EAAE;EAAK,CAAC;EACnOO,eAAe,EAAE;IAAEpC,EAAE,EAAE,iBAAiB;IAAEf,IAAI,EAAE,oBAAoB;IAAEgB,IAAI,EAAEhC,UAAU,CAAC2B,MAAM;IAAEM,MAAM,EAAEhC,WAAW,CAACiC,MAAM;IAAE+B,OAAO,EAAE,UAAU;IAAE3B,MAAM,EAAE,CAAC;IAAEC,KAAK,EAAE,EAAE;IAAErB,WAAW,EAAE,kCAAkC;IAAE0C,UAAU,EAAE;EAAK,CAAC;EACzOQ,iBAAiB,EAAE;IAAErC,EAAE,EAAE,mBAAmB;IAAEf,IAAI,EAAE,sBAAsB;IAAEgB,IAAI,EAAEhC,UAAU,CAAC2B,MAAM;IAAEM,MAAM,EAAEhC,WAAW,CAAC6C,QAAQ;IAAEmB,OAAO,EAAE,YAAY;IAAE3B,MAAM,EAAE,CAAC;IAAEC,KAAK,EAAE,GAAG;IAAErB,WAAW,EAAE,uBAAuB;IAAE0C,UAAU,EAAE;EAAK,CAAC;EAEzO;EACAS,mBAAmB,EAAE;IAAEtC,EAAE,EAAE,qBAAqB;IAAEf,IAAI,EAAE,qBAAqB;IAAEgB,IAAI,EAAEhC,UAAU,CAAC4B,SAAS;IAAEK,MAAM,EAAEhC,WAAW,CAAC6C,QAAQ;IAAEM,OAAO,EAAE,CAAC;IAAEkB,SAAS,EAAE,CAAC;IAAEhC,MAAM,EAAE,CAAC;IAAEC,KAAK,EAAE,GAAG;IAAErB,WAAW,EAAE,8BAA8B;IAAE6B,OAAO,EAAE;EAAK,CAAC;EACtPwB,kBAAkB,EAAE;IAAExC,EAAE,EAAE,oBAAoB;IAAEf,IAAI,EAAE,oBAAoB;IAAEgB,IAAI,EAAEhC,UAAU,CAAC4B,SAAS;IAAEK,MAAM,EAAEhC,WAAW,CAACgD,IAAI;IAAEG,OAAO,EAAE,CAAC;IAAEkB,SAAS,EAAE,CAAC;IAAEhC,MAAM,EAAE,CAAC;IAAEC,KAAK,EAAE,IAAI;IAAErB,WAAW,EAAE,8BAA8B;IAAE6B,OAAO,EAAE;EAAK,CAAC;EAChPyB,gBAAgB,EAAE;IAAEzC,EAAE,EAAE,kBAAkB;IAAEf,IAAI,EAAE,kBAAkB;IAAEgB,IAAI,EAAEhC,UAAU,CAAC4B,SAAS;IAAEK,MAAM,EAAEhC,WAAW,CAACgD,IAAI;IAAES,MAAM,EAAE,YAAY;IAAEpB,MAAM,EAAE,CAAC;IAAEC,KAAK,EAAE,IAAI;IAAErB,WAAW,EAAE,6BAA6B;IAAE6B,OAAO,EAAE;EAAK,CAAC;EAErO;EACA0B,SAAS,EAAE;IAAE1C,EAAE,EAAE,WAAW;IAAEf,IAAI,EAAE,WAAW;IAAEgB,IAAI,EAAEhC,UAAU,CAACsB,IAAI;IAAEW,MAAM,EAAEhC,WAAW,CAACiC,MAAM;IAAEI,MAAM,EAAE,CAAC;IAAEC,KAAK,EAAE,CAAC;IAAErB,WAAW,EAAE;EAA+B,CAAC;EACtKwD,OAAO,EAAE;IAAE3C,EAAE,EAAE,SAAS;IAAEf,IAAI,EAAE,SAAS;IAAEgB,IAAI,EAAEhC,UAAU,CAACsB,IAAI;IAAEW,MAAM,EAAEhC,WAAW,CAACiC,MAAM;IAAEI,MAAM,EAAE,CAAC;IAAEC,KAAK,EAAE,CAAC;IAAErB,WAAW,EAAE;EAAyB,CAAC;EAC1JyD,OAAO,EAAE;IAAE5C,EAAE,EAAE,SAAS;IAAEf,IAAI,EAAE,iBAAiB;IAAEgB,IAAI,EAAEhC,UAAU,CAACsB,IAAI;IAAEW,MAAM,EAAEhC,WAAW,CAACiC,MAAM;IAAEI,MAAM,EAAE,CAAC;IAAEC,KAAK,EAAE,CAAC;IAAErB,WAAW,EAAE,wBAAwB;IAAE0D,SAAS,EAAE;EAAK,CAAC;EACnLC,MAAM,EAAE;IAAE9C,EAAE,EAAE,QAAQ;IAAEf,IAAI,EAAE,aAAa;IAAEgB,IAAI,EAAEhC,UAAU,CAACsB,IAAI;IAAEW,MAAM,EAAEhC,WAAW,CAACiC,MAAM;IAAEI,MAAM,EAAE,CAAC;IAAEC,KAAK,EAAE,CAAC;IAAErB,WAAW,EAAE,wBAAwB;IAAE0D,SAAS,EAAE;EAAK,CAAC;EAC7KE,aAAa,EAAE;IAAE/C,EAAE,EAAE,eAAe;IAAEf,IAAI,EAAE,gBAAgB;IAAEgB,IAAI,EAAEhC,UAAU,CAACsB,IAAI;IAAEW,MAAM,EAAEhC,WAAW,CAACiC,MAAM;IAAEI,MAAM,EAAE,CAAC;IAAEC,KAAK,EAAE,EAAE;IAAErB,WAAW,EAAE;EAA+B,CAAC;EACpL6D,WAAW,EAAE;IAAEhD,EAAE,EAAE,aAAa;IAAEf,IAAI,EAAE,cAAc;IAAEgB,IAAI,EAAEhC,UAAU,CAACsB,IAAI;IAAEW,MAAM,EAAEhC,WAAW,CAACiC,MAAM;IAAEI,MAAM,EAAE,CAAC;IAAEC,KAAK,EAAE,CAAC;IAAErB,WAAW,EAAE,sCAAsC;IAAE0D,SAAS,EAAE;EAAK;AACvM,CAAC;;AAED;AACA;AACA;;AAEA,OAAO,MAAMI,cAAc,GAAG;EAC5B,CAACvE,cAAc,CAACC,OAAO,GAAM,CAAC,SAAS,EAAE,iBAAiB,EAAE,WAAW,EAAE,MAAM,EAAE,OAAO,EAAE,WAAW,EAAE,SAAS,EAAE,SAAS,EAAE,QAAQ,EAAE,aAAa,EAAE,QAAQ,EAAE,OAAO,CAAC;EACxK,CAACD,cAAc,CAACE,UAAU,GAAG,CAAC,QAAQ,EAAE,YAAY,EAAE,WAAW,EAAE,YAAY,EAAE,UAAU,EAAE,SAAS,EAAE,MAAM,EAAE,QAAQ,EAAE,OAAO,EAAE,eAAe,EAAE,KAAK,EAAE,cAAc,EAAE,SAAS,EAAE,QAAQ,EAAE,MAAM,EAAE,YAAY,EAAE,WAAW,EAAE,aAAa,EAAE,aAAa,CAAC;EAChQ,CAACF,cAAc,CAACG,SAAS,GAAI,CAAC,SAAS,EAAE,iBAAiB,EAAE,kBAAkB,EAAE,MAAM,EAAE,WAAW,EAAE,iBAAiB,EAAE,wBAAwB,EAAE,gBAAgB,EAAE,iBAAiB,CAAC;EACtL,CAACH,cAAc,CAACI,KAAK,GAAQ,CAAC,iBAAiB,EAAE,mBAAmB,EAAE,gBAAgB,EAAE,iBAAiB,EAAE,MAAM,EAAE,iBAAiB,EAAE,wBAAwB,EAAE,aAAa,EAAE,qBAAqB,EAAE,qBAAqB,EAAE,oBAAoB,EAAE,kBAAkB,CAAC;EACtQ,CAACJ,cAAc,CAACK,KAAK,GAAQ,CAAC,QAAQ,EAAE,YAAY,EAAE,SAAS,EAAE,SAAS,EAAE,MAAM,EAAE,eAAe,EAAE,OAAO,EAAE,QAAQ,EAAE,SAAS;AACnI,CAAC;;AAED;AACA;AACA;;AAEA,OAAO,SAASmE,yBAAyBA,CAACC,SAAS,EAAE;EACnD,IAAI,CAACA,SAAS,EAAE,OAAO,IAAI;EAC3B,MAAMC,KAAK,GAAGD,SAAS,CAACE,WAAW,CAAC,CAAC;EAErC,MAAMC,gBAAgB,GAAG,CAAC,MAAM,EAAE,OAAO,EAAE,UAAU,EAAE,QAAQ,EAAE,QAAQ,EAAE,QAAQ,EAAE,QAAQ,EAAE,OAAO,EAAE,UAAU,EAAE,wBAAwB,EAAE,KAAK,EAAE,OAAO,EAAE,KAAK,EAAE,eAAe,EAAE,YAAY,EAAE,WAAW,EAAE,cAAc,EAAE,QAAQ,EAAE,eAAe,EAAE,UAAU,CAAC;EACvQ,IAAI,CAACA,gBAAgB,CAACC,IAAI,CAACC,EAAE,IAAIJ,KAAK,CAACK,QAAQ,CAACD,EAAE,CAAC,CAAC,EAAE,OAAO,IAAI;EAEjE,IAAIE,YAAY,GAAGhF,cAAc,CAACC,OAAO;EACzC,IAAIgF,YAAY,GAAG,gBAAgB;EAEnC,IAAIP,KAAK,CAACK,QAAQ,CAAC,YAAY,CAAC,IAAIL,KAAK,CAACK,QAAQ,CAAC,QAAQ,CAAC,IAAKL,KAAK,CAACK,QAAQ,CAAC,QAAQ,CAAC,IAAIL,KAAK,CAACK,QAAQ,CAAC,MAAM,CAAE,EAAE;IACpHC,YAAY,GAAGhF,cAAc,CAACE,UAAU;IAAE+E,YAAY,GAAG,YAAY;EACvE,CAAC,MAAM,IAAIP,KAAK,CAACK,QAAQ,CAAC,WAAW,CAAC,IAAKL,KAAK,CAACK,QAAQ,CAAC,QAAQ,CAAC,IAAIL,KAAK,CAACK,QAAQ,CAAC,MAAM,CAAE,EAAE;IAC9FC,YAAY,GAAGhF,cAAc,CAACG,SAAS;IAAE8E,YAAY,GAAG,kBAAkB;EAC5E,CAAC,MAAM,IAAIP,KAAK,CAACK,QAAQ,CAAC,OAAO,CAAC,IAAIL,KAAK,CAACK,QAAQ,CAAC,QAAQ,CAAC,IAAIL,KAAK,CAACK,QAAQ,CAAC,UAAU,CAAC,EAAE;IAC5FC,YAAY,GAAGhF,cAAc,CAACI,KAAK;IAAE6E,YAAY,GAAG,iBAAiB;EACvE,CAAC,MAAM,IAAIP,KAAK,CAACK,QAAQ,CAAC,OAAO,CAAC,IAAIL,KAAK,CAACK,QAAQ,CAAC,OAAO,CAAC,IAAIL,KAAK,CAACK,QAAQ,CAAC,cAAc,CAAC,EAAE;IAC/FC,YAAY,GAAGhF,cAAc,CAACK,KAAK;IAAE4E,YAAY,GAAG,cAAc;EACpE,CAAC,MAAM,IAAIP,KAAK,CAACK,QAAQ,CAAC,eAAe,CAAC,IAAIL,KAAK,CAACK,QAAQ,CAAC,QAAQ,CAAC,EAAE;IACtEC,YAAY,GAAGhF,cAAc,CAACC,OAAO;IAAEgF,YAAY,GAAG,eAAe;EACvE;EAEAC,OAAO,CAACC,GAAG,CAAC,oBAAoBH,YAAY,MAAMC,YAAY,GAAG,CAAC;EAClE,OAAOG,cAAc,CAACJ,YAAY,EAAEC,YAAY,CAAC;AACnD;;AAEA;AACA;AACA;;AAEA,OAAO,SAASG,cAAcA,CAAC7D,IAAI,GAAGvB,cAAc,CAACC,OAAO,EAAEM,IAAI,GAAG,IAAI,EAAE;EACzE,MAAM8E,GAAG,GAAG/E,oBAAoB,CAACiB,IAAI,CAAC;EACtC,MAAM+D,SAAS,GAAGf,cAAc,CAAChD,IAAI,CAAC,IAAIgD,cAAc,CAACvE,cAAc,CAACC,OAAO,CAAC;EAChF,MAAMsF,KAAK,GAAGD,SAAS,CAACE,GAAG,CAACC,GAAG,IAAIrE,UAAU,CAACqE,GAAG,CAAC,CAAC,CAACC,MAAM,CAACC,OAAO,CAAC,CAACH,GAAG,CAACI,IAAI,KAAK;IAAE,GAAGA,IAAI;IAAEC,QAAQ,EAAEC,eAAe,CAACF,IAAI;EAAE,CAAC,CAAC,CAAC;EAC/H,OAAO;IAAEtE,EAAE,EAAE,YAAYyE,IAAI,CAACC,GAAG,CAAC,CAAC,EAAE;IAAEzE,IAAI;IAAEhB,IAAI,EAAEA,IAAI,IAAI8E,GAAG,CAAC9E,IAAI;IAAEC,IAAI,EAAE6E,GAAG,CAAC7E,IAAI;IAAEC,WAAW,EAAE4E,GAAG,CAAC5E,WAAW;IAAEC,aAAa,EAAE2E,GAAG,CAAC3E,aAAa;IAAEC,cAAc,EAAE0E,GAAG,CAAC1E,cAAc;IAAE4E;EAAM,CAAC;AAClM;AAEA,SAASO,eAAeA,CAACF,IAAI,EAAE;EAC7B,IAAIA,IAAI,CAACpE,MAAM,KAAKhC,WAAW,CAACyG,SAAS,IAAIL,IAAI,CAACpE,MAAM,KAAKhC,WAAW,CAAC0G,IAAI,IAAIN,IAAI,CAACpE,MAAM,KAAKhC,WAAW,CAACgD,IAAI,EAAE,OAAO,CAAC;EAC3H,IAAIoD,IAAI,CAACzC,UAAU,IAAIyC,IAAI,CAACzB,SAAS,EAAE,OAAOgC,IAAI,CAACC,KAAK,CAACD,IAAI,CAACE,MAAM,CAAC,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC;EAC/E,OAAOF,IAAI,CAACC,KAAK,CAACD,IAAI,CAACE,MAAM,CAAC,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC;AAC1C;;AAEA;AACA;AACA;;AAEA,OAAO,SAASC,OAAOA,CAACC,SAAS,EAAE;EACjC,MAAMC,QAAQ,GAAG,CAACD,SAAS,CAACE,SAAS,IAAI,EAAE,EAAEC,IAAI,CAACC,CAAC,IAAIA,CAAC,CAACrF,EAAE,KAAK,MAAM,CAAC;EACvE,OAAOkF,QAAQ,GAAIA,QAAQ,CAACX,QAAQ,IAAI,CAAC,GAAI,CAAC;AAChD;AAEA,OAAO,SAASe,UAAUA,CAACL,SAAS,EAAEM,MAAM,EAAE;EAC5C,MAAMC,OAAO,GAAGR,OAAO,CAACC,SAAS,CAAC;EAClC,MAAMQ,SAAS,GAAGD,OAAO,GAAGD,MAAM;EAClC,IAAIE,SAAS,GAAG,CAAC,EAAE,OAAO;IAAEC,OAAO,EAAE,KAAK;IAAET,SAAS;IAAEQ,SAAS,EAAED,OAAO;IAAEG,OAAO,EAAE;EAAmB,CAAC;EAExG,MAAMR,SAAS,GAAGF,SAAS,CAACE,SAAS,IAAI,EAAE;EAC3C,MAAMS,SAAS,GAAGT,SAAS,CAACU,SAAS,CAACR,CAAC,IAAIA,CAAC,CAACrF,EAAE,KAAK,MAAM,CAAC;EAC3D,IAAI8F,YAAY;EAEhB,IAAIF,SAAS,KAAK,CAAC,CAAC,EAAE;IACpBE,YAAY,GAAGX,SAAS,CAACjB,GAAG,CAAC,CAACI,IAAI,EAAEe,CAAC,KAAKA,CAAC,KAAKO,SAAS,GAAG;MAAE,GAAGtB,IAAI;MAAEC,QAAQ,EAAEkB;IAAU,CAAC,GAAGnB,IAAI,CAAC;EACtG,CAAC,MAAM,IAAIiB,MAAM,GAAG,CAAC,EAAE;IACrBO,YAAY,GAAG,CAAC,GAAGX,SAAS,EAAE;MAAEnF,EAAE,EAAE,MAAM;MAAEf,IAAI,EAAE,YAAY;MAAEgB,IAAI,EAAEhC,UAAU,CAACsB,IAAI;MAAEW,MAAM,EAAEhC,WAAW,CAACiC,MAAM;MAAEI,MAAM,EAAE,CAAC;MAAEC,KAAK,EAAE,CAAC;MAAErB,WAAW,EAAE,mBAAmB;MAAE0D,SAAS,EAAE,IAAI;MAAEkD,UAAU,EAAE,QAAQtB,IAAI,CAACC,GAAG,CAAC,CAAC,EAAE;MAAEH,QAAQ,EAAEkB,SAAS;MAAEO,QAAQ,EAAE;IAAM,CAAC,CAAC;EACtQ,CAAC,MAAM;IACL,OAAO;MAAEN,OAAO,EAAE,KAAK;MAAET,SAAS;MAAEQ,SAAS,EAAE,CAAC;MAAEE,OAAO,EAAE;IAAmB,CAAC;EACjF;EAEA,OAAO;IAAED,OAAO,EAAE,IAAI;IAAET,SAAS,EAAE;MAAE,GAAGA,SAAS;MAAEE,SAAS,EAAEW;IAAa,CAAC;IAAEL,SAAS;IAAEE,OAAO,EAAEJ,MAAM,GAAG,CAAC,GAAG,IAAIA,MAAM,OAAO,GAAG,GAAGA,MAAM;EAAQ,CAAC;AACvJ;;AAEA;AACA;AACA;;AAEA,OAAO,SAASU,WAAWA,CAAC3B,IAAI,EAAE4B,QAAQ,EAAE;EAC1C,OAAOrB,IAAI,CAACsB,IAAI,CAAC7B,IAAI,CAAC9D,KAAK,GAAG0F,QAAQ,CAAC9G,aAAa,CAAC;AACvD;AAEA,OAAO,SAASgH,YAAYA,CAAC9B,IAAI,EAAE4B,QAAQ,EAAE;EAC3C,OAAOrB,IAAI,CAACwB,GAAG,CAAC,CAAC,EAAExB,IAAI,CAACC,KAAK,CAACR,IAAI,CAAC9D,KAAK,GAAG0F,QAAQ,CAAC7G,cAAc,CAAC,CAAC;AACtE;AAEA,OAAO,SAASiH,OAAOA,CAACrB,SAAS,EAAEiB,QAAQ,EAAEK,QAAQ,EAAEhC,QAAQ,GAAG,CAAC,EAAE;EACnE,MAAMiC,KAAK,GAAGP,WAAW,CAACM,QAAQ,EAAEL,QAAQ,CAAC,GAAG3B,QAAQ;EACxD,MAAMkC,WAAW,GAAGzB,OAAO,CAACC,SAAS,CAAC;EACtC,IAAIwB,WAAW,GAAGD,KAAK,EAAE,OAAO;IAAEd,OAAO,EAAE,KAAK;IAAET,SAAS;IAAEiB,QAAQ;IAAEP,OAAO,EAAE,yBAAyBa,KAAK,aAAaC,WAAW;EAAO,CAAC;EAE9I,MAAMC,UAAU,GAAGR,QAAQ,CAACjC,KAAK,CAACmB,IAAI,CAACuB,CAAC,IAAIA,CAAC,CAAC3G,EAAE,KAAKuG,QAAQ,CAACvG,EAAE,CAAC;EACjE,IAAI,CAAC0G,UAAU,IAAIA,UAAU,CAACnC,QAAQ,GAAGA,QAAQ,EAAE,OAAO;IAAEmB,OAAO,EAAE,KAAK;IAAET,SAAS;IAAEiB,QAAQ;IAAEP,OAAO,EAAE;EAAoB,CAAC;EAE/H,MAAMiB,UAAU,GAAGtB,UAAU,CAACL,SAAS,EAAE,CAACuB,KAAK,CAAC;EAChD,IAAI,CAACI,UAAU,CAAClB,OAAO,EAAE,OAAO;IAAEA,OAAO,EAAE,KAAK;IAAET,SAAS;IAAEiB,QAAQ;IAAEP,OAAO,EAAEiB,UAAU,CAACjB;EAAQ,CAAC;;EAEpG;EACA,IAAIkB,OAAO,GAAGtI,UAAU,CAACgI,QAAQ,CAACvG,EAAE,EAAEuE,QAAQ,CAAC;EAC/C,IAAI,CAACsC,OAAO,EAAE;IACZA,OAAO,GAAG;MACR,GAAGN,QAAQ;MACXR,UAAU,EAAE,GAAGQ,QAAQ,CAACvG,EAAE,IAAIyE,IAAI,CAACC,GAAG,CAAC,CAAC,IAAIG,IAAI,CAACE,MAAM,CAAC,CAAC,CAAC+B,QAAQ,CAAC,EAAE,CAAC,CAACC,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE;MACrFxC,QAAQ,EAAEgC,QAAQ,CAAC1D,SAAS,GAAG0B,QAAQ,GAAG,CAAC;MAC3CyB,QAAQ,EAAE;IACZ,CAAC;EACH;EACA,MAAMF,YAAY,GAAGtH,kBAAkB,CAACoI,UAAU,CAAC3B,SAAS,CAACE,SAAS,EAAE0B,OAAO,CAAC;EAChF,MAAMG,gBAAgB,GAAG;IAAE,GAAGJ,UAAU,CAAC3B,SAAS;IAAEE,SAAS,EAAEW;EAAa,CAAC;EAC7E,MAAMmB,YAAY,GAAGf,QAAQ,CAACjC,KAAK,CAACC,GAAG,CAACyC,CAAC,IAAIA,CAAC,CAAC3G,EAAE,KAAKuG,QAAQ,CAACvG,EAAE,GAAG;IAAE,GAAG2G,CAAC;IAAEpC,QAAQ,EAAEoC,CAAC,CAACpC,QAAQ,GAAGA;EAAS,CAAC,GAAGoC,CAAC,CAAC,CAACvC,MAAM,CAACuC,CAAC,IAAIA,CAAC,CAACpC,QAAQ,GAAG,CAAC,CAAC;EAC9I,MAAM2C,eAAe,GAAG;IAAE,GAAGhB,QAAQ;IAAEjC,KAAK,EAAEgD;EAAa,CAAC;EAE5DrD,OAAO,CAACC,GAAG,CAAC,UAAUoB,SAAS,CAAChG,IAAI,WAAWsF,QAAQ,KAAKgC,QAAQ,CAACtH,IAAI,QAAQuH,KAAK,KAAK,CAAC;EAC5F,OAAO;IAAEd,OAAO,EAAE,IAAI;IAAET,SAAS,EAAE+B,gBAAgB;IAAEd,QAAQ,EAAEgB,eAAe;IAAEvB,OAAO,EAAE,UAAUpB,QAAQ,KAAKgC,QAAQ,CAACtH,IAAI,QAAQuH,KAAK;EAAO,CAAC;AACpJ;AAEA,OAAO,SAASW,QAAQA,CAAClC,SAAS,EAAEiB,QAAQ,EAAEkB,aAAa,EAAE7C,QAAQ,GAAG,CAAC,EAAE;EACzE,IAAI6C,aAAa,CAACpH,EAAE,KAAK,MAAM,EAAE,OAAO;IAAE0F,OAAO,EAAE,KAAK;IAAET,SAAS;IAAEiB,QAAQ;IAAEP,OAAO,EAAE;EAA6B,CAAC;EACtH,IAAIyB,aAAa,CAACnH,IAAI,KAAKhC,UAAU,CAACoJ,KAAK,EAAE,OAAO;IAAE3B,OAAO,EAAE,KAAK;IAAET,SAAS;IAAEiB,QAAQ;IAAEP,OAAO,EAAE;EAA8B,CAAC;EAEnI,MAAMa,KAAK,GAAGJ,YAAY,CAACgB,aAAa,EAAElB,QAAQ,CAAC,GAAG3B,QAAQ;EAC9D,MAAMuB,YAAY,GAAGrH,uBAAuB,CAACwG,SAAS,CAACE,SAAS,IAAI,EAAE,EAAEiC,aAAa,CAACrB,UAAU,EAAExB,QAAQ,CAAC;EAC3G,MAAMqC,UAAU,GAAGtB,UAAU,CAAC;IAAE,GAAGL,SAAS;IAAEE,SAAS,EAAEW;EAAa,CAAC,EAAEU,KAAK,CAAC;EAE/E5C,OAAO,CAACC,GAAG,CAAC,UAAUoB,SAAS,CAAChG,IAAI,SAASsF,QAAQ,KAAK6C,aAAa,CAACnI,IAAI,QAAQuH,KAAK,KAAK,CAAC;EAC/F,OAAO;IAAEd,OAAO,EAAE,IAAI;IAAET,SAAS,EAAE2B,UAAU,CAAC3B,SAAS;IAAEiB,QAAQ;IAAEP,OAAO,EAAE,QAAQpB,QAAQ,KAAK6C,aAAa,CAACnI,IAAI,QAAQuH,KAAK;EAAO,CAAC;AAC1I;AAEA,OAAO,SAASc,UAAUA,CAAC/B,MAAM,EAAE;EACjC,IAAIA,MAAM,IAAI,IAAI,EAAE,OAAO,GAAG,CAACA,MAAM,GAAG,IAAI,EAAEgC,OAAO,CAAChC,MAAM,GAAG,IAAI,KAAK,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,MAAM;EACxF,OAAO,GAAGA,MAAM,KAAK;AACvB;AAEA,OAAO,MAAMiC,YAAY,GAAG;EAC1B,CAACtJ,WAAW,CAACiC,MAAM,CAAClB,IAAI,GAAG,CAAC;EAC5B,CAACf,WAAW,CAAC6C,QAAQ,CAAC9B,IAAI,GAAG,CAAC;EAC9B,CAACf,WAAW,CAACgD,IAAI,CAACjC,IAAI,GAAG,CAAC;EAC1B,CAACf,WAAW,CAAC0G,IAAI,CAAC3F,IAAI,GAAG,CAAC;EAC1B,CAACf,WAAW,CAACyG,SAAS,CAAC1F,IAAI,GAAG;AAChC,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}