{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Hakty\\\\Desktop\\\\AI-Dungeon-Master\\\\frontend\\\\src\\\\components\\\\GameScreen.jsx\",\n  _s = $RefreshSig$();\n// frontend/src/components/GameScreen.jsx\nimport { useState, useEffect, useRef } from \"react\";\nimport { useCampaignStore } from \"../state/campaignStore\";\nimport { playTurn } from \"../services/api\";\nimport { generateVoice } from \"../services/voiceApi\";\nimport { generateSoundEffects } from \"../services/soundEffectsApi\";\nimport { parseNarrative } from \"../utils/narrativeParser\";\nimport { autoSave } from \"../services/saveLoadService\";\nimport { processXPFromNarration, awardXPToParty } from \"../utils/xpSystem\";\nimport { detectScene } from \"../utils/musicSceneDetection\";\nimport ChatLog from \"./ChatLog\";\nimport DiceRoller from \"./DiceRoller\";\nimport SaveLoadModal from \"./SaveLoadModal\";\nimport CharacterSheet from \"./CharacterSheet\";\nimport LevelUpNotification from \"./LevelUpNotification\";\nimport XPNotification from \"./XPNotification\";\nimport CombatTracker from \"./CombatTracker\";\nimport StartCombatModal from \"./StartCombatModal\";\nimport MusicSystem from \"./MusicSystem\";\nimport { detectLootInNarration, addItemToInventory } from \"../utils/inventorySystem\";\nimport InventoryPanel from \"./InventoryPanel\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function GameScreen() {\n  _s();\n  // Local state\n  const [input, setInput] = useState(\"\");\n  const [isGeneratingVoice, setIsGeneratingVoice] = useState(false);\n  const [showSaveModal, setShowSaveModal] = useState(false);\n  const [showLoadModal, setShowLoadModal] = useState(false);\n  const [selectedCharacter, setSelectedCharacter] = useState(null);\n  const [showCharacterSheet, setShowCharacterSheet] = useState(false);\n  const [levelUpData, setLevelUpData] = useState(null);\n  const [xpNotification, setXPNotification] = useState(null);\n  const [combat, setCombat] = useState(null);\n  const [showStartCombat, setShowStartCombat] = useState(false);\n\n  // Refs\n  const audioRef = useRef(null);\n  const audioQueue = useRef([]);\n  const isPlaying = useRef(false);\n  const recognitionRef = useRef(null);\n  const silenceTimeoutRef = useRef(null);\n  const musicSystemRef = useRef(null);\n\n  // Store state\n  const campaign = useCampaignStore(state => state.campaign);\n  const party = useCampaignStore(state => state.party);\n  const updateFromDM = useCampaignStore(state => state.updateFromDM);\n  const setCampaign = useCampaignStore(state => state.setCampaign);\n  const updateParty = useCampaignStore(state => state.updateParty);\n  const voiceMode = useCampaignStore(state => state.voiceMode);\n  const soundEffectsEnabled = useCampaignStore(state => state.soundEffectsEnabled || false);\n  const micListening = useCampaignStore(state => state.micListening);\n  const toggleMic = useCampaignStore(state => state.toggleMic);\n  const addDiceRoll = useCampaignStore(state => state.addDiceRoll);\n  const toggleVoice = useCampaignStore(state => state.toggleVoice);\n  const toggleSoundEffects = useCampaignStore(state => state.toggleSoundEffects || (() => {}));\n  const [showInventory, setShowInventory] = useState(false);\n  const [activeCharacterInventory, setActiveCharacterInventory] = useState(null);\n\n  /* ============================\n     Speech Recognition (Disabled)\n     ============================ */\n  useEffect(() => {\n    // Speech recognition disabled\n  }, [micListening]);\n\n  /* ============================\n     Audio Queue System\n     ============================ */\n  const playAudioQueue = () => {\n    if (isPlaying.current || audioQueue.current.length === 0) return;\n    isPlaying.current = true;\n    const audioItem = audioQueue.current.shift();\n    if (!audioRef.current) {\n      audioRef.current = new Audio();\n    }\n    audioRef.current.src = audioItem.audio;\n    audioRef.current.volume = audioItem.volume || 1.0;\n    audioRef.current.onended = () => {\n      console.log(`âœ… Finished playing ${audioItem.type}`);\n      isPlaying.current = false;\n      playAudioQueue();\n    };\n    audioRef.current.onerror = err => {\n      console.error(\"âŒ Audio playback error:\", err);\n      isPlaying.current = false;\n      playAudioQueue();\n    };\n    console.log(`ðŸ”Š Playing ${audioItem.type}...`);\n    audioRef.current.play().catch(err => {\n      console.error(\"âŒ Failed to play audio:\", err);\n      isPlaying.current = false;\n      playAudioQueue();\n    });\n  };\n\n  /* ============================\n     Play Background Sound Effects\n     ============================ */\n  const playBackgroundSound = (audioData, category) => {\n    try {\n      const audio = new Audio(audioData);\n      audio.volume = 0.3;\n      audio.loop = false;\n      console.log(`ðŸŽµ Playing background sound: ${category}`);\n      audio.play().catch(err => {\n        console.error(\"âŒ Failed to play background sound:\", err);\n      });\n      audio.onended = () => {\n        console.log(`âœ… Background sound finished: ${category}`);\n      };\n    } catch (err) {\n      console.error(\"âŒ Background sound error:\", err);\n    }\n  };\n\n  /* ============================\n     Generate and Play Sound Effects\n     ============================ */\n  const playSoundEffects = async text => {\n    if (!soundEffectsEnabled) {\n      console.log(\"ðŸ”‡ Sound effects disabled by user\");\n      return;\n    }\n    try {\n      console.log(\"ðŸ”Š Requesting sound effects for text...\");\n      const soundEffects = await generateSoundEffects(text);\n      console.log(`ðŸ“¦ Received ${soundEffects.length} sound effects from backend`);\n      if (soundEffects.length === 0) {\n        console.log(\"ðŸ”‡ No sound effects generated for this text\");\n        return;\n      }\n      soundEffects.forEach(sfx => {\n        console.log(`ðŸŽµ Playing background sound: ${sfx.category}`);\n        playBackgroundSound(sfx.audio, sfx.category);\n      });\n    } catch (err) {\n      console.error(\"âŒ Failed to play sound effects:\", err);\n    }\n  };\n\n  /* ============================\n     ElevenLabs Voice Generation\n     ============================ */\n  const speakWithElevenLabs = async (text, voice = \"narrator\") => {\n    if (!voiceMode) {\n      console.log(\"ðŸ”‡ Voice mode is OFF - skipping narration\");\n      return;\n    }\n    try {\n      setIsGeneratingVoice(true);\n      console.log(`ðŸŽ™ï¸ Generating ${voice} voice with ElevenLabs...`);\n      const cleanText = text.replace(/\\*\\*(.*?)\\*\\*/g, \"$1\").replace(/\\*(.*?)\\*/g, \"$1\").replace(/#{1,6}\\s/g, \"\");\n      const audioData = await generateVoice({\n        text: cleanText,\n        voice\n      });\n      audioQueue.current.push({\n        audio: audioData,\n        type: `narration_${voice}`,\n        volume: 1.0\n      });\n      if (!isPlaying.current) {\n        playAudioQueue();\n      }\n      setIsGeneratingVoice(false);\n    } catch (err) {\n      console.error(\"âŒ Failed to generate voice:\", err);\n      setIsGeneratingVoice(false);\n      console.log(\"âš ï¸ Falling back to browser TTS\");\n      const utterance = new SpeechSynthesisUtterance(text);\n      speechSynthesis.speak(utterance);\n    }\n  };\n  const speakAIResponse = async aiResponse => {\n    console.log(\"ðŸŽ™ï¸ Voice mode:\", voiceMode);\n    console.log(\"ðŸ“ AI Response:\", aiResponse);\n    if (!voiceMode) {\n      console.log(\"ðŸ”‡ Voice mode is OFF - skipping narration\");\n      return;\n    }\n    const fullText = typeof aiResponse === 'string' ? aiResponse : Array.isArray(aiResponse) ? aiResponse.map(e => e.text).join(' ') : '';\n    if (soundEffectsEnabled && fullText) {\n      playSoundEffects(fullText);\n    }\n    if (Array.isArray(aiResponse)) {\n      console.log(\"ðŸ“š Speaking array of\", aiResponse.length, \"entries\");\n      for (const entry of aiResponse) {\n        var _entry$description, _entry$description2, _entry$description3;\n        const voice = (_entry$description = entry.description) !== null && _entry$description !== void 0 && _entry$description.toLowerCase().includes(\"dark\") ? \"dark\" : (_entry$description2 = entry.description) !== null && _entry$description2 !== void 0 && _entry$description2.toLowerCase().includes(\"old\") ? \"old_wise\" : (_entry$description3 = entry.description) !== null && _entry$description3 !== void 0 && _entry$description3.toLowerCase().includes(\"gruff\") ? \"gruff\" : \"narrator\";\n        await speakWithElevenLabs(entry.text, voice);\n      }\n      return;\n    }\n    if (typeof aiResponse === 'string' && aiResponse.trim()) {\n      console.log(\"ðŸ“– Parsing narrative for dialogue...\");\n      const segments = parseNarrative(aiResponse);\n      console.log(`ðŸŽ­ Found ${segments.length} segments`);\n      for (const segment of segments) {\n        console.log(`  ðŸ—£ï¸ ${segment.type} (${segment.voice}): \"${segment.text.substring(0, 40)}...\"`);\n        await speakWithElevenLabs(segment.text, segment.voice);\n      }\n      return;\n    }\n    console.warn(\"âš ï¸ Unknown AI response format\");\n  };\n\n  /* ============================\n     Dice handler\n     ============================ */\n  const handleDiceRoll = ({\n    sides,\n    result\n  }) => {\n    console.log(\"ðŸŽ² Rolled d\" + sides + \":\", result);\n    addDiceRoll({\n      sides,\n      result\n    });\n  };\n\n  /* ============================\n     Submit player turn\n     ============================ */\n  const handleSubmit = async e => {\n    e.preventDefault();\n    if (!input.trim()) return;\n    console.log(\"ðŸŽ® Submitting player action:\", input);\n    try {\n      const dmResponse = await playTurn({\n        message: input,\n        campaign,\n        party\n      });\n      console.log(\"ðŸ“¨ DM Response received:\", dmResponse);\n      updateFromDM(dmResponse);\n      if (dmResponse !== null && dmResponse !== void 0 && dmResponse.aiResponse && party.length > 0) {\n        const xpResult = processXPFromNarration(dmResponse.aiResponse, party);\n        if (xpResult) {\n          console.log(\"ðŸŽ‰ XP Awarded:\", xpResult);\n          updateParty(xpResult.partyUpdates);\n          setXPNotification({\n            xpGained: xpResult.totalXP,\n            reason: xpResult.message\n          });\n          if (xpResult.levelUps.length > 0) {\n            setTimeout(() => {\n              setLevelUpData(xpResult.levelUps);\n            }, 3500);\n          }\n        }\n      }\n      // After the XP detection block, add:\n      // ðŸŽ’ AUTO LOOT DETECTION\n      if (dmResponse !== null && dmResponse !== void 0 && dmResponse.aiResponse) {\n        const foundLoot = detectLootInNarration(dmResponse.aiResponse);\n        if (foundLoot.length > 0) {\n          console.log(\"ðŸŽ’ Loot detected:\", foundLoot);\n\n          // Add items to first party member's inventory\n          if (party.length > 0) {\n            const updatedParty = party.map((char, index) => {\n              if (index === 0) {\n                // Give to first character\n                let newInventory = char.inventory || [];\n                foundLoot.forEach(item => {\n                  newInventory = addItemToInventory(newInventory, item);\n                });\n                return {\n                  ...char,\n                  inventory: newInventory\n                };\n              }\n              return char;\n            });\n            updateParty(updatedParty);\n            alert(`Found: ${foundLoot.map(i => i.name).join(', ')}!`);\n          }\n        }\n      }\n      autoSave(dmResponse.campaignState, party);\n      if (dmResponse !== null && dmResponse !== void 0 && dmResponse.aiResponse) {\n        console.log(\"ðŸŽ¤ Attempting to speak response...\");\n        await speakAIResponse(dmResponse.aiResponse);\n\n        // ðŸŽµ AUTO SCENE DETECTION\n        if (musicSystemRef.current) {\n          const scene = detectScene(dmResponse.aiResponse, (combat === null || combat === void 0 ? void 0 : combat.isActive) || false);\n          if (scene) {\n            console.log(`ðŸŽµ Scene detected: ${scene.reason}`);\n            musicSystemRef.current.playTrack(scene.track);\n          }\n        }\n      } else {\n        console.warn(\"âš ï¸ No aiResponse in DM response\");\n      }\n      setInput(\"\");\n    } catch (err) {\n      console.error(\"âŒ Turn error:\", err);\n    }\n  };\n  const handleLoadCampaign = (loadedCampaign, loadedParty) => {\n    setCampaign({\n      ...loadedCampaign,\n      party: loadedParty\n    });\n    alert(\"Campaign loaded successfully!\");\n  };\n  const handleCharacterUpdate = updatedCharacter => {\n    const updatedParty = party.map(char => char.name === updatedCharacter.name ? updatedCharacter : char);\n    updateParty(updatedParty);\n    setSelectedCharacter(updatedCharacter);\n  };\n  const handleViewCharacter = character => {\n    setSelectedCharacter(character);\n    setShowCharacterSheet(true);\n  };\n  const handleStartCombat = newCombat => {\n    setCombat(newCombat);\n    setShowStartCombat(false);\n    console.log(\"âš”ï¸ Combat started!\", newCombat);\n\n    // ðŸŽµ Switch to combat music\n    if (musicSystemRef.current) {\n      musicSystemRef.current.playTrack('combat_easy');\n    }\n  };\n  const handleUpdateCombat = updatedCombat => {\n    setCombat(updatedCombat);\n  };\n  const handleEndCombat = result => {\n    console.log(\"Combat ended:\", result);\n\n    // ðŸŽµ Victory/defeat music\n    if (musicSystemRef.current) {\n      if (result.result === 'victory') {\n        musicSystemRef.current.playTrack('victory');\n        // Return to exploration after 8 seconds\n        setTimeout(() => {\n          if (musicSystemRef.current) {\n            musicSystemRef.current.playTrack('peaceful_village');\n          }\n        }, 8000);\n      } else if (result.result === 'defeat') {\n        musicSystemRef.current.playTrack('defeat');\n      }\n    }\n    if (result.result === 'victory' && result.xpReward) {\n      const xpResult = awardXPToParty(party, result.xpReward, 'Combat Victory');\n      updateParty(xpResult.partyUpdates);\n      setXPNotification({\n        xpGained: result.xpReward,\n        reason: 'Combat Victory!'\n      });\n      if (xpResult.levelUps.length > 0) {\n        setTimeout(() => {\n          setLevelUpData(xpResult.levelUps);\n        }, 3500);\n      }\n    }\n    setCombat(null);\n    alert(result.message);\n  };\n  if (!campaign) return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"container\",\n    style: {\n      textAlign: 'center',\n      paddingTop: '100px'\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n      children: \"No Campaign Started\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 408,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n      style: {\n        color: '#888',\n        fontSize: '18px'\n      },\n      children: \"Please start a campaign from the setup screen.\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 409,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 407,\n    columnNumber: 5\n  }, this);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      minHeight: '100vh',\n      background: 'linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%)'\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"container\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"card mb-lg\",\n        style: {\n          marginBottom: '20px'\n        },\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            display: 'flex',\n            justifyContent: 'space-between',\n            alignItems: 'center'\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n              style: {\n                margin: 0\n              },\n              children: [campaign.theme, \" Adventure\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 420,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n              style: {\n                margin: '5px 0 0 0',\n                color: '#aaa',\n                fontSize: '16px'\n              },\n              children: [\"Difficulty: \", campaign.difficulty]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 421,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 419,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              display: 'flex',\n              gap: '10px'\n            },\n            children: [/*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: () => setShowStartCombat(true),\n              className: \"btn btn-danger\",\n              children: \"\\u2694\\uFE0F Combat\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 427,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: () => setShowSaveModal(true),\n              className: \"btn btn-success\",\n              children: \"\\uD83D\\uDCBE Save\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 430,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: () => setShowLoadModal(true),\n              className: \"btn btn-info\",\n              children: \"\\uD83D\\uDCC2 Load\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 433,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 426,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 418,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 417,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"card mb-lg\",\n        children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n          style: {\n            margin: '0 0 15px 0'\n          },\n          children: \"\\uD83C\\uDFB5 Audio Settings\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 442,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            display: 'flex',\n            flexDirection: 'column',\n            gap: '10px'\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"label\", {\n            style: {\n              display: 'flex',\n              alignItems: 'center',\n              gap: '10px',\n              cursor: 'pointer'\n            },\n            children: [/*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"checkbox\",\n              checked: voiceMode,\n              onChange: toggleVoice\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 445,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              children: [\"\\uD83C\\uDF99\\uFE0F Voice Narration \", voiceMode ? \"ON\" : \"OFF\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 450,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 444,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n            style: {\n              display: 'flex',\n              alignItems: 'center',\n              gap: '10px',\n              cursor: 'pointer'\n            },\n            children: [/*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"checkbox\",\n              checked: soundEffectsEnabled,\n              onChange: toggleSoundEffects\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 453,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              children: [\"\\uD83D\\uDD0A Sound Effects \", soundEffectsEnabled ? \"ON\" : \"OFF\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 458,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 452,\n            columnNumber: 13\n          }, this), isGeneratingVoice && /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              marginTop: '5px',\n              color: '#888',\n              fontSize: '14px'\n            },\n            children: \"\\u23F3 Generating audio...\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 461,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 443,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 441,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"mb-lg\",\n        children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n          style: {\n            marginBottom: '15px'\n          },\n          children: \"\\uD83D\\uDC65 Your Party\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 470,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"grid grid-auto\",\n          children: party.map((c, i) => {\n            const hpPercent = c.hp / c.maxHp * 100;\n            const hpColor = hpPercent > 50 ? '#4CAF50' : hpPercent > 25 ? '#ff9800' : '#f44336';\n            return /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"card card-hover\",\n              onClick: () => handleViewCharacter(c),\n              style: {\n                cursor: 'pointer'\n              },\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                style: {\n                  display: 'flex',\n                  justifyContent: 'space-between',\n                  alignItems: 'flex-start',\n                  marginBottom: '12px'\n                },\n                children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                  children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n                    style: {\n                      margin: '0 0 5px 0'\n                    },\n                    children: c.name\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 485,\n                    columnNumber: 23\n                  }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                    style: {\n                      margin: 0,\n                      fontSize: '13px',\n                      color: '#aaa'\n                    },\n                    children: [\"Lvl \", c.level, \" \", c.race, \" \", c.class]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 486,\n                    columnNumber: 23\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 484,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                  onClick: e => {\n                    e.stopPropagation();\n                    handleViewCharacter(c);\n                  },\n                  className: \"btn btn-success btn-sm\",\n                  children: \"\\uD83D\\uDCCB Sheet\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 490,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 483,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                style: {\n                  marginTop: '12px'\n                },\n                children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                  style: {\n                    fontSize: '12px',\n                    color: '#aaa',\n                    marginBottom: '5px'\n                  },\n                  children: [\"HP: \", c.hp, \" / \", c.maxHp]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 502,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"progress-bar\",\n                  children: /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"progress-fill\",\n                    style: {\n                      width: `${hpPercent}%`,\n                      backgroundColor: hpColor\n                    }\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 506,\n                    columnNumber: 23\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 505,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 501,\n                columnNumber: 19\n              }, this), c.xp !== undefined && /*#__PURE__*/_jsxDEV(\"div\", {\n                style: {\n                  marginTop: '8px',\n                  fontSize: '12px',\n                  color: '#888'\n                },\n                children: [\"XP: \", c.xp]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 514,\n                columnNumber: 21\n              }, this)]\n            }, i, true, {\n              fileName: _jsxFileName,\n              lineNumber: 477,\n              columnNumber: 17\n            }, this);\n          })\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 471,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 469,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          marginBottom: '20px'\n        },\n        children: /*#__PURE__*/_jsxDEV(DiceRoller, {\n          onRoll: handleDiceRoll\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 525,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 524,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"card mb-lg\",\n        children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n          style: {\n            margin: '0 0 15px 0'\n          },\n          children: \"\\uD83D\\uDCDC Adventure Log\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 530,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(ChatLog, {\n          history: campaign.history\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 531,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 529,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"card\",\n        children: /*#__PURE__*/_jsxDEV(\"form\", {\n          onSubmit: handleSubmit,\n          style: {\n            display: 'flex',\n            gap: '10px'\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"input\", {\n            value: input,\n            onChange: e => setInput(e.target.value),\n            placeholder: \"What do you do?\",\n            className: \"input\",\n            disabled: isGeneratingVoice,\n            style: {\n              flex: 1\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 537,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            type: \"submit\",\n            disabled: isGeneratingVoice,\n            className: \"btn btn-primary\",\n            children: \"Submit\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 545,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            type: \"button\",\n            className: \"btn btn-ghost\",\n            disabled: true,\n            title: \"Speech input is currently disabled\",\n            style: {\n              opacity: 0.5,\n              cursor: 'not-allowed'\n            },\n            children: \"\\uD83C\\uDFA4 Voice\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 552,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 536,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 535,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 415,\n      columnNumber: 7\n    }, this), combat && combat.isActive && /*#__PURE__*/_jsxDEV(CombatTracker, {\n      combat: combat,\n      onUpdate: handleUpdateCombat,\n      onEnd: handleEndCombat\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 567,\n      columnNumber: 9\n    }, this), showStartCombat && /*#__PURE__*/_jsxDEV(StartCombatModal, {\n      party: party,\n      onStart: handleStartCombat,\n      onClose: () => setShowStartCombat(false)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 576,\n      columnNumber: 9\n    }, this), levelUpData && /*#__PURE__*/_jsxDEV(LevelUpNotification, {\n      levelUps: levelUpData,\n      onClose: () => setLevelUpData(null)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 585,\n      columnNumber: 9\n    }, this), xpNotification && /*#__PURE__*/_jsxDEV(XPNotification, {\n      xpGained: xpNotification.xpGained,\n      reason: xpNotification.reason,\n      onComplete: () => setXPNotification(null)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 593,\n      columnNumber: 9\n    }, this), showCharacterSheet && selectedCharacter && /*#__PURE__*/_jsxDEV(CharacterSheet, {\n      character: selectedCharacter,\n      onUpdate: handleCharacterUpdate,\n      onClose: () => {\n        setShowCharacterSheet(false);\n        setSelectedCharacter(null);\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 602,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(SaveLoadModal, {\n      isOpen: showSaveModal,\n      onClose: () => setShowSaveModal(false),\n      mode: \"save\",\n      campaign: campaign,\n      party: party,\n      onLoad: handleLoadCampaign\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 613,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(SaveLoadModal, {\n      isOpen: showLoadModal,\n      onClose: () => setShowLoadModal(false),\n      mode: \"load\",\n      campaign: campaign,\n      party: party,\n      onLoad: handleLoadCampaign\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 622,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(MusicSystem, {\n      ref: musicSystemRef\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 632,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 414,\n    columnNumber: 5\n  }, this);\n}\n_s(GameScreen, \"SfMGt4uaMZW3eqYwOKvHKlx79Ts=\", false, function () {\n  return [useCampaignStore, useCampaignStore, useCampaignStore, useCampaignStore, useCampaignStore, useCampaignStore, useCampaignStore, useCampaignStore, useCampaignStore, useCampaignStore, useCampaignStore, useCampaignStore];\n});\n_c = GameScreen;\nvar _c;\n$RefreshReg$(_c, \"GameScreen\");","map":{"version":3,"names":["useState","useEffect","useRef","useCampaignStore","playTurn","generateVoice","generateSoundEffects","parseNarrative","autoSave","processXPFromNarration","awardXPToParty","detectScene","ChatLog","DiceRoller","SaveLoadModal","CharacterSheet","LevelUpNotification","XPNotification","CombatTracker","StartCombatModal","MusicSystem","detectLootInNarration","addItemToInventory","InventoryPanel","jsxDEV","_jsxDEV","GameScreen","_s","input","setInput","isGeneratingVoice","setIsGeneratingVoice","showSaveModal","setShowSaveModal","showLoadModal","setShowLoadModal","selectedCharacter","setSelectedCharacter","showCharacterSheet","setShowCharacterSheet","levelUpData","setLevelUpData","xpNotification","setXPNotification","combat","setCombat","showStartCombat","setShowStartCombat","audioRef","audioQueue","isPlaying","recognitionRef","silenceTimeoutRef","musicSystemRef","campaign","state","party","updateFromDM","setCampaign","updateParty","voiceMode","soundEffectsEnabled","micListening","toggleMic","addDiceRoll","toggleVoice","toggleSoundEffects","showInventory","setShowInventory","activeCharacterInventory","setActiveCharacterInventory","playAudioQueue","current","length","audioItem","shift","Audio","src","audio","volume","onended","console","log","type","onerror","err","error","play","catch","playBackgroundSound","audioData","category","loop","playSoundEffects","text","soundEffects","forEach","sfx","speakWithElevenLabs","voice","cleanText","replace","push","utterance","SpeechSynthesisUtterance","speechSynthesis","speak","speakAIResponse","aiResponse","fullText","Array","isArray","map","e","join","entry","_entry$description","_entry$description2","_entry$description3","description","toLowerCase","includes","trim","segments","segment","substring","warn","handleDiceRoll","sides","result","handleSubmit","preventDefault","dmResponse","message","xpResult","partyUpdates","xpGained","totalXP","reason","levelUps","setTimeout","foundLoot","updatedParty","char","index","newInventory","inventory","item","alert","i","name","campaignState","scene","isActive","playTrack","track","handleLoadCampaign","loadedCampaign","loadedParty","handleCharacterUpdate","updatedCharacter","handleViewCharacter","character","handleStartCombat","newCombat","handleUpdateCombat","updatedCombat","handleEndCombat","xpReward","className","style","textAlign","paddingTop","children","fileName","_jsxFileName","lineNumber","columnNumber","color","fontSize","minHeight","background","marginBottom","display","justifyContent","alignItems","margin","theme","difficulty","gap","onClick","flexDirection","cursor","checked","onChange","marginTop","c","hpPercent","hp","maxHp","hpColor","level","race","class","stopPropagation","width","backgroundColor","xp","undefined","onRoll","history","onSubmit","value","target","placeholder","disabled","flex","title","opacity","onUpdate","onEnd","onStart","onClose","onComplete","isOpen","mode","onLoad","ref","_c","$RefreshReg$"],"sources":["C:/Users/Hakty/Desktop/AI-Dungeon-Master/frontend/src/components/GameScreen.jsx"],"sourcesContent":["// frontend/src/components/GameScreen.jsx\nimport { useState, useEffect, useRef } from \"react\";\nimport { useCampaignStore } from \"../state/campaignStore\";\nimport { playTurn } from \"../services/api\";\nimport { generateVoice } from \"../services/voiceApi\";\nimport { generateSoundEffects } from \"../services/soundEffectsApi\";\nimport { parseNarrative } from \"../utils/narrativeParser\";\nimport { autoSave } from \"../services/saveLoadService\";\nimport { processXPFromNarration, awardXPToParty } from \"../utils/xpSystem\";\nimport { detectScene } from \"../utils/musicSceneDetection\";\nimport ChatLog from \"./ChatLog\";\nimport DiceRoller from \"./DiceRoller\";\nimport SaveLoadModal from \"./SaveLoadModal\";\nimport CharacterSheet from \"./CharacterSheet\";\nimport LevelUpNotification from \"./LevelUpNotification\";\nimport XPNotification from \"./XPNotification\";\nimport CombatTracker from \"./CombatTracker\";\nimport StartCombatModal from \"./StartCombatModal\";\nimport MusicSystem from \"./MusicSystem\";\nimport { detectLootInNarration, addItemToInventory } from \"../utils/inventorySystem\";\nimport InventoryPanel from \"./InventoryPanel\";\n\nexport default function GameScreen() {\n  // Local state\n  const [input, setInput] = useState(\"\");\n  const [isGeneratingVoice, setIsGeneratingVoice] = useState(false);\n  const [showSaveModal, setShowSaveModal] = useState(false);\n  const [showLoadModal, setShowLoadModal] = useState(false);\n  const [selectedCharacter, setSelectedCharacter] = useState(null);\n  const [showCharacterSheet, setShowCharacterSheet] = useState(false);\n  const [levelUpData, setLevelUpData] = useState(null);\n  const [xpNotification, setXPNotification] = useState(null);\n  const [combat, setCombat] = useState(null);\n  const [showStartCombat, setShowStartCombat] = useState(false);\n  \n  // Refs\n  const audioRef = useRef(null);\n  const audioQueue = useRef([]);\n  const isPlaying = useRef(false);\n  const recognitionRef = useRef(null);\n  const silenceTimeoutRef = useRef(null);\n  const musicSystemRef = useRef(null);\n\n  // Store state\n  const campaign = useCampaignStore((state) => state.campaign);\n  const party = useCampaignStore((state) => state.party);\n  const updateFromDM = useCampaignStore((state) => state.updateFromDM);\n  const setCampaign = useCampaignStore((state) => state.setCampaign);\n  const updateParty = useCampaignStore((state) => state.updateParty);\n  const voiceMode = useCampaignStore((state) => state.voiceMode);\n  const soundEffectsEnabled = useCampaignStore((state) => state.soundEffectsEnabled || false);\n  const micListening = useCampaignStore((state) => state.micListening);\n  const toggleMic = useCampaignStore((state) => state.toggleMic);\n  const addDiceRoll = useCampaignStore((state) => state.addDiceRoll);\n  const toggleVoice = useCampaignStore((state) => state.toggleVoice);\n  const toggleSoundEffects = useCampaignStore((state) => state.toggleSoundEffects || (() => {}));\n  const [showInventory, setShowInventory] = useState(false);\n  const [activeCharacterInventory, setActiveCharacterInventory] = useState(null);\n\n  /* ============================\n     Speech Recognition (Disabled)\n     ============================ */\n  useEffect(() => {\n    // Speech recognition disabled\n  }, [micListening]);\n\n  /* ============================\n     Audio Queue System\n     ============================ */\n  const playAudioQueue = () => {\n    if (isPlaying.current || audioQueue.current.length === 0) return;\n\n    isPlaying.current = true;\n    const audioItem = audioQueue.current.shift();\n\n    if (!audioRef.current) {\n      audioRef.current = new Audio();\n    }\n\n    audioRef.current.src = audioItem.audio;\n    audioRef.current.volume = audioItem.volume || 1.0;\n    \n    audioRef.current.onended = () => {\n      console.log(`âœ… Finished playing ${audioItem.type}`);\n      isPlaying.current = false;\n      playAudioQueue();\n    };\n\n    audioRef.current.onerror = (err) => {\n      console.error(\"âŒ Audio playback error:\", err);\n      isPlaying.current = false;\n      playAudioQueue();\n    };\n\n    console.log(`ðŸ”Š Playing ${audioItem.type}...`);\n    audioRef.current.play().catch(err => {\n      console.error(\"âŒ Failed to play audio:\", err);\n      isPlaying.current = false;\n      playAudioQueue();\n    });\n  };\n\n  /* ============================\n     Play Background Sound Effects\n     ============================ */\n  const playBackgroundSound = (audioData, category) => {\n    try {\n      const audio = new Audio(audioData);\n      audio.volume = 0.3;\n      audio.loop = false;\n      \n      console.log(`ðŸŽµ Playing background sound: ${category}`);\n      \n      audio.play().catch(err => {\n        console.error(\"âŒ Failed to play background sound:\", err);\n      });\n      \n      audio.onended = () => {\n        console.log(`âœ… Background sound finished: ${category}`);\n      };\n    } catch (err) {\n      console.error(\"âŒ Background sound error:\", err);\n    }\n  };\n\n  /* ============================\n     Generate and Play Sound Effects\n     ============================ */\n  const playSoundEffects = async (text) => {\n    if (!soundEffectsEnabled) {\n      console.log(\"ðŸ”‡ Sound effects disabled by user\");\n      return;\n    }\n\n    try {\n      console.log(\"ðŸ”Š Requesting sound effects for text...\");\n      const soundEffects = await generateSoundEffects(text);\n      \n      console.log(`ðŸ“¦ Received ${soundEffects.length} sound effects from backend`);\n      \n      if (soundEffects.length === 0) {\n        console.log(\"ðŸ”‡ No sound effects generated for this text\");\n        return;\n      }\n\n      soundEffects.forEach(sfx => {\n        console.log(`ðŸŽµ Playing background sound: ${sfx.category}`);\n        playBackgroundSound(sfx.audio, sfx.category);\n      });\n\n    } catch (err) {\n      console.error(\"âŒ Failed to play sound effects:\", err);\n    }\n  };\n\n  /* ============================\n     ElevenLabs Voice Generation\n     ============================ */\n  const speakWithElevenLabs = async (text, voice = \"narrator\") => {\n    if (!voiceMode) {\n      console.log(\"ðŸ”‡ Voice mode is OFF - skipping narration\");\n      return;\n    }\n\n    try {\n      setIsGeneratingVoice(true);\n      console.log(`ðŸŽ™ï¸ Generating ${voice} voice with ElevenLabs...`);\n      \n      const cleanText = text\n        .replace(/\\*\\*(.*?)\\*\\*/g, \"$1\")\n        .replace(/\\*(.*?)\\*/g, \"$1\")\n        .replace(/#{1,6}\\s/g, \"\");\n\n      const audioData = await generateVoice({ text: cleanText, voice });\n      \n      audioQueue.current.push({\n        audio: audioData,\n        type: `narration_${voice}`,\n        volume: 1.0\n      });\n\n      if (!isPlaying.current) {\n        playAudioQueue();\n      }\n      \n      setIsGeneratingVoice(false);\n    } catch (err) {\n      console.error(\"âŒ Failed to generate voice:\", err);\n      setIsGeneratingVoice(false);\n      console.log(\"âš ï¸ Falling back to browser TTS\");\n      const utterance = new SpeechSynthesisUtterance(text);\n      speechSynthesis.speak(utterance);\n    }\n  };\n\n  const speakAIResponse = async (aiResponse) => {\n    console.log(\"ðŸŽ™ï¸ Voice mode:\", voiceMode);\n    console.log(\"ðŸ“ AI Response:\", aiResponse);\n\n    if (!voiceMode) {\n      console.log(\"ðŸ”‡ Voice mode is OFF - skipping narration\");\n      return;\n    }\n\n    const fullText = typeof aiResponse === 'string' ? aiResponse : \n                     Array.isArray(aiResponse) ? aiResponse.map(e => e.text).join(' ') : '';\n    \n    if (soundEffectsEnabled && fullText) {\n      playSoundEffects(fullText);\n    }\n\n    if (Array.isArray(aiResponse)) {\n      console.log(\"ðŸ“š Speaking array of\", aiResponse.length, \"entries\");\n      for (const entry of aiResponse) {\n        const voice = entry.description?.toLowerCase().includes(\"dark\") ? \"dark\" :\n                     entry.description?.toLowerCase().includes(\"old\") ? \"old_wise\" :\n                     entry.description?.toLowerCase().includes(\"gruff\") ? \"gruff\" :\n                     \"narrator\";\n        await speakWithElevenLabs(entry.text, voice);\n      }\n      return;\n    }\n\n    if (typeof aiResponse === 'string' && aiResponse.trim()) {\n      console.log(\"ðŸ“– Parsing narrative for dialogue...\");\n      const segments = parseNarrative(aiResponse);\n      console.log(`ðŸŽ­ Found ${segments.length} segments`);\n      \n      for (const segment of segments) {\n        console.log(`  ðŸ—£ï¸ ${segment.type} (${segment.voice}): \"${segment.text.substring(0, 40)}...\"`);\n        await speakWithElevenLabs(segment.text, segment.voice);\n      }\n      return;\n    }\n\n    console.warn(\"âš ï¸ Unknown AI response format\");\n  };\n\n  /* ============================\n     Dice handler\n     ============================ */\n  const handleDiceRoll = ({ sides, result }) => {\n    console.log(\"ðŸŽ² Rolled d\" + sides + \":\", result);\n    addDiceRoll({ sides, result });\n  };\n\n  /* ============================\n     Submit player turn\n     ============================ */\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n    if (!input.trim()) return;\n\n    console.log(\"ðŸŽ® Submitting player action:\", input);\n\n    try {\n      const dmResponse = await playTurn({ message: input, campaign, party });\n      console.log(\"ðŸ“¨ DM Response received:\", dmResponse);\n      \n      updateFromDM(dmResponse);\n\n      if (dmResponse?.aiResponse && party.length > 0) {\n        const xpResult = processXPFromNarration(dmResponse.aiResponse, party);\n        \n        if (xpResult) {\n          console.log(\"ðŸŽ‰ XP Awarded:\", xpResult);\n          \n          updateParty(xpResult.partyUpdates);\n          \n          setXPNotification({\n            xpGained: xpResult.totalXP,\n            reason: xpResult.message\n          });\n          \n          if (xpResult.levelUps.length > 0) {\n            setTimeout(() => {\n              setLevelUpData(xpResult.levelUps);\n            }, 3500);\n          }\n        }\n      }\n      // After the XP detection block, add:\n// ðŸŽ’ AUTO LOOT DETECTION\nif (dmResponse?.aiResponse) {\n  const foundLoot = detectLootInNarration(dmResponse.aiResponse);\n  if (foundLoot.length > 0) {\n    console.log(\"ðŸŽ’ Loot detected:\", foundLoot);\n    \n    // Add items to first party member's inventory\n    if (party.length > 0) {\n      const updatedParty = party.map((char, index) => {\n        if (index === 0) { // Give to first character\n          let newInventory = char.inventory || [];\n          foundLoot.forEach(item => {\n            newInventory = addItemToInventory(newInventory, item);\n          });\n          return { ...char, inventory: newInventory };\n        }\n        return char;\n      });\n      updateParty(updatedParty);\n      \n      alert(`Found: ${foundLoot.map(i => i.name).join(', ')}!`);\n    }\n  }\n}\n\n      autoSave(dmResponse.campaignState, party);\n\n      if (dmResponse?.aiResponse) {\n        console.log(\"ðŸŽ¤ Attempting to speak response...\");\n        await speakAIResponse(dmResponse.aiResponse);\n        \n        // ðŸŽµ AUTO SCENE DETECTION\n        if (musicSystemRef.current) {\n          const scene = detectScene(dmResponse.aiResponse, combat?.isActive || false);\n          if (scene) {\n            console.log(`ðŸŽµ Scene detected: ${scene.reason}`);\n            musicSystemRef.current.playTrack(scene.track);\n          }\n        }\n      } else {\n        console.warn(\"âš ï¸ No aiResponse in DM response\");\n      }\n\n      setInput(\"\");\n    } catch (err) {\n      console.error(\"âŒ Turn error:\", err);\n    }\n  };\n\n  const handleLoadCampaign = (loadedCampaign, loadedParty) => {\n    setCampaign({\n      ...loadedCampaign,\n      party: loadedParty\n    });\n    alert(\"Campaign loaded successfully!\");\n  };\n\n  const handleCharacterUpdate = (updatedCharacter) => {\n    const updatedParty = party.map(char =>\n      char.name === updatedCharacter.name ? updatedCharacter : char\n    );\n    updateParty(updatedParty);\n    setSelectedCharacter(updatedCharacter);\n  };\n\n  const handleViewCharacter = (character) => {\n    setSelectedCharacter(character);\n    setShowCharacterSheet(true);\n  };\n\n  const handleStartCombat = (newCombat) => {\n    setCombat(newCombat);\n    setShowStartCombat(false);\n    console.log(\"âš”ï¸ Combat started!\", newCombat);\n    \n    // ðŸŽµ Switch to combat music\n    if (musicSystemRef.current) {\n      musicSystemRef.current.playTrack('combat_easy');\n    }\n  };\n\n  const handleUpdateCombat = (updatedCombat) => {\n    setCombat(updatedCombat);\n  };\n\n  const handleEndCombat = (result) => {\n    console.log(\"Combat ended:\", result);\n    \n    // ðŸŽµ Victory/defeat music\n    if (musicSystemRef.current) {\n      if (result.result === 'victory') {\n        musicSystemRef.current.playTrack('victory');\n        // Return to exploration after 8 seconds\n        setTimeout(() => {\n          if (musicSystemRef.current) {\n            musicSystemRef.current.playTrack('peaceful_village');\n          }\n        }, 8000);\n      } else if (result.result === 'defeat') {\n        musicSystemRef.current.playTrack('defeat');\n      }\n    }\n    \n    if (result.result === 'victory' && result.xpReward) {\n      const xpResult = awardXPToParty(party, result.xpReward, 'Combat Victory');\n      updateParty(xpResult.partyUpdates);\n      \n      setXPNotification({\n        xpGained: result.xpReward,\n        reason: 'Combat Victory!'\n      });\n      \n      if (xpResult.levelUps.length > 0) {\n        setTimeout(() => {\n          setLevelUpData(xpResult.levelUps);\n        }, 3500);\n      }\n    }\n    \n    setCombat(null);\n    alert(result.message);\n  };\n\n  if (!campaign) return (\n    <div className=\"container\" style={{ textAlign: 'center', paddingTop: '100px' }}>\n      <h1>No Campaign Started</h1>\n      <p style={{ color: '#888', fontSize: '18px' }}>Please start a campaign from the setup screen.</p>\n    </div>\n  );\n\n  return (\n    <div style={{ minHeight: '100vh', background: 'linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%)' }}>\n      <div className=\"container\">\n        {/* Header */}\n        <div className=\"card mb-lg\" style={{ marginBottom: '20px' }}>\n          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>\n            <div>\n              <h2 style={{ margin: 0 }}>{campaign.theme} Adventure</h2>\n              <p style={{ margin: '5px 0 0 0', color: '#aaa', fontSize: '16px' }}>\n                Difficulty: {campaign.difficulty}\n              </p>\n            </div>\n            \n            <div style={{ display: 'flex', gap: '10px' }}>\n              <button onClick={() => setShowStartCombat(true)} className=\"btn btn-danger\">\n                âš”ï¸ Combat\n              </button>\n              <button onClick={() => setShowSaveModal(true)} className=\"btn btn-success\">\n                ðŸ’¾ Save\n              </button>\n              <button onClick={() => setShowLoadModal(true)} className=\"btn btn-info\">\n                ðŸ“‚ Load\n              </button>\n            </div>\n          </div>\n        </div>\n\n        {/* Audio Settings */}\n        <div className=\"card mb-lg\">\n          <h4 style={{ margin: '0 0 15px 0' }}>ðŸŽµ Audio Settings</h4>\n          <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>\n            <label style={{ display: 'flex', alignItems: 'center', gap: '10px', cursor: 'pointer' }}>\n              <input \n                type=\"checkbox\" \n                checked={voiceMode} \n                onChange={toggleVoice}\n              />\n              <span>ðŸŽ™ï¸ Voice Narration {voiceMode ? \"ON\" : \"OFF\"}</span>\n            </label>\n            <label style={{ display: 'flex', alignItems: 'center', gap: '10px', cursor: 'pointer' }}>\n              <input \n                type=\"checkbox\" \n                checked={soundEffectsEnabled} \n                onChange={toggleSoundEffects}\n              />\n              <span>ðŸ”Š Sound Effects {soundEffectsEnabled ? \"ON\" : \"OFF\"}</span>\n            </label>\n            {isGeneratingVoice && (\n              <div style={{ marginTop: '5px', color: '#888', fontSize: '14px' }}>\n                â³ Generating audio...\n              </div>\n            )}\n          </div>\n        </div>\n\n        {/* Party */}\n        <div className=\"mb-lg\">\n          <h3 style={{ marginBottom: '15px' }}>ðŸ‘¥ Your Party</h3>\n          <div className=\"grid grid-auto\">\n            {party.map((c, i) => {\n              const hpPercent = (c.hp / c.maxHp) * 100;\n              const hpColor = hpPercent > 50 ? '#4CAF50' : hpPercent > 25 ? '#ff9800' : '#f44336';\n              \n              return (\n                <div\n                  key={i}\n                  className=\"card card-hover\"\n                  onClick={() => handleViewCharacter(c)}\n                  style={{ cursor: 'pointer' }}\n                >\n                  <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: '12px' }}>\n                    <div>\n                      <h4 style={{ margin: '0 0 5px 0' }}>{c.name}</h4>\n                      <p style={{ margin: 0, fontSize: '13px', color: '#aaa' }}>\n                        Lvl {c.level} {c.race} {c.class}\n                      </p>\n                    </div>\n                    <button\n                      onClick={(e) => {\n                        e.stopPropagation();\n                        handleViewCharacter(c);\n                      }}\n                      className=\"btn btn-success btn-sm\"\n                    >\n                      ðŸ“‹ Sheet\n                    </button>\n                  </div>\n                  \n                  <div style={{ marginTop: '12px' }}>\n                    <div style={{ fontSize: '12px', color: '#aaa', marginBottom: '5px' }}>\n                      HP: {c.hp} / {c.maxHp}\n                    </div>\n                    <div className=\"progress-bar\">\n                      <div \n                        className=\"progress-fill\" \n                        style={{ width: `${hpPercent}%`, backgroundColor: hpColor }}\n                      />\n                    </div>\n                  </div>\n\n                  {c.xp !== undefined && (\n                    <div style={{ marginTop: '8px', fontSize: '12px', color: '#888' }}>\n                      XP: {c.xp}\n                    </div>\n                  )}\n                </div>\n              );\n            })}\n          </div>\n        </div>\n\n        <div style={{ marginBottom: '20px' }}>\n          <DiceRoller onRoll={handleDiceRoll} />\n        </div>\n\n        {/* Adventure Log */}\n        <div className=\"card mb-lg\">\n          <h3 style={{ margin: '0 0 15px 0' }}>ðŸ“œ Adventure Log</h3>\n          <ChatLog history={campaign.history} />\n        </div>\n\n        {/* Input */}\n        <div className=\"card\">\n          <form onSubmit={handleSubmit} style={{ display: 'flex', gap: '10px' }}>\n            <input\n              value={input}\n              onChange={(e) => setInput(e.target.value)}\n              placeholder=\"What do you do?\"\n              className=\"input\"\n              disabled={isGeneratingVoice}\n              style={{ flex: 1 }}\n            />\n            <button \n              type=\"submit\" \n              disabled={isGeneratingVoice} \n              className=\"btn btn-primary\"\n            >\n              Submit\n            </button>\n            <button \n              type=\"button\"\n              className=\"btn btn-ghost\"\n              disabled={true}\n              title=\"Speech input is currently disabled\"\n              style={{ opacity: 0.5, cursor: 'not-allowed' }}\n            >\n              ðŸŽ¤ Voice\n            </button>\n          </form>\n        </div>\n      </div>\n\n      {/* Combat Tracker */}\n      {combat && combat.isActive && (\n        <CombatTracker\n          combat={combat}\n          onUpdate={handleUpdateCombat}\n          onEnd={handleEndCombat}\n        />\n      )}\n\n      {/* Start Combat Modal */}\n      {showStartCombat && (\n        <StartCombatModal\n          party={party}\n          onStart={handleStartCombat}\n          onClose={() => setShowStartCombat(false)}\n        />\n      )}\n\n      {/* Level-Up Notification */}\n      {levelUpData && (\n        <LevelUpNotification\n          levelUps={levelUpData}\n          onClose={() => setLevelUpData(null)}\n        />\n      )}\n\n      {/* XP Notification */}\n      {xpNotification && (\n        <XPNotification\n          xpGained={xpNotification.xpGained}\n          reason={xpNotification.reason}\n          onComplete={() => setXPNotification(null)}\n        />\n      )}\n\n      {/* Character Sheet Modal */}\n      {showCharacterSheet && selectedCharacter && (\n        <CharacterSheet\n          character={selectedCharacter}\n          onUpdate={handleCharacterUpdate}\n          onClose={() => {\n            setShowCharacterSheet(false);\n            setSelectedCharacter(null);\n          }}\n        />\n      )}\n\n      {/* Save/Load Modals */}\n      <SaveLoadModal\n        isOpen={showSaveModal}\n        onClose={() => setShowSaveModal(false)}\n        mode=\"save\"\n        campaign={campaign}\n        party={party}\n        onLoad={handleLoadCampaign}\n      />\n\n      <SaveLoadModal\n        isOpen={showLoadModal}\n        onClose={() => setShowLoadModal(false)}\n        mode=\"load\"\n        campaign={campaign}\n        party={party}\n        onLoad={handleLoadCampaign}\n      />\n\n      {/* Background Music System */}\n      <MusicSystem ref={musicSystemRef} />\n    </div>\n  );\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}