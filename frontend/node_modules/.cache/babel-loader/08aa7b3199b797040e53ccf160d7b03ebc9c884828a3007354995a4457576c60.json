{"ast":null,"code":"// frontend/src/utils/spellSystem.js\n\n/**\n * D&D 5e Spell Casting System\n * Spell slots, prepared spells, spell book\n */\n\n/**\n * Spell Schools\n */\nexport const SPELL_SCHOOLS = {\n  ABJURATION: 'Abjuration',\n  CONJURATION: 'Conjuration',\n  DIVINATION: 'Divination',\n  ENCHANTMENT: 'Enchantment',\n  EVOCATION: 'Evocation',\n  ILLUSION: 'Illusion',\n  NECROMANCY: 'Necromancy',\n  TRANSMUTATION: 'Transmutation'\n};\n\n/**\n * Spell slot progression by class level (for full casters)\n */\nexport const SPELL_SLOTS_FULL_CASTER = {\n  1: [2, 0, 0, 0, 0, 0, 0, 0, 0],\n  2: [3, 0, 0, 0, 0, 0, 0, 0, 0],\n  3: [4, 2, 0, 0, 0, 0, 0, 0, 0],\n  4: [4, 3, 0, 0, 0, 0, 0, 0, 0],\n  5: [4, 3, 2, 0, 0, 0, 0, 0, 0],\n  6: [4, 3, 3, 0, 0, 0, 0, 0, 0],\n  7: [4, 3, 3, 1, 0, 0, 0, 0, 0],\n  8: [4, 3, 3, 2, 0, 0, 0, 0, 0],\n  9: [4, 3, 3, 3, 1, 0, 0, 0, 0],\n  10: [4, 3, 3, 3, 2, 0, 0, 0, 0],\n  11: [4, 3, 3, 3, 2, 1, 0, 0, 0],\n  12: [4, 3, 3, 3, 2, 1, 0, 0, 0],\n  13: [4, 3, 3, 3, 2, 1, 1, 0, 0],\n  14: [4, 3, 3, 3, 2, 1, 1, 0, 0],\n  15: [4, 3, 3, 3, 2, 1, 1, 1, 0],\n  16: [4, 3, 3, 3, 2, 1, 1, 1, 0],\n  17: [4, 3, 3, 3, 2, 1, 1, 1, 1],\n  18: [4, 3, 3, 3, 3, 1, 1, 1, 1],\n  19: [4, 3, 3, 3, 3, 2, 1, 1, 1],\n  20: [4, 3, 3, 3, 3, 2, 2, 1, 1]\n};\n\n/**\n * Half caster progression (Paladin, Ranger)\n */\nexport const SPELL_SLOTS_HALF_CASTER = {\n  1: [0, 0, 0, 0, 0, 0, 0, 0, 0],\n  2: [2, 0, 0, 0, 0, 0, 0, 0, 0],\n  3: [3, 0, 0, 0, 0, 0, 0, 0, 0],\n  4: [3, 0, 0, 0, 0, 0, 0, 0, 0],\n  5: [4, 2, 0, 0, 0, 0, 0, 0, 0],\n  6: [4, 2, 0, 0, 0, 0, 0, 0, 0],\n  7: [4, 3, 0, 0, 0, 0, 0, 0, 0],\n  8: [4, 3, 0, 0, 0, 0, 0, 0, 0],\n  9: [4, 3, 2, 0, 0, 0, 0, 0, 0],\n  10: [4, 3, 2, 0, 0, 0, 0, 0, 0],\n  11: [4, 3, 3, 0, 0, 0, 0, 0, 0],\n  12: [4, 3, 3, 0, 0, 0, 0, 0, 0],\n  13: [4, 3, 3, 1, 0, 0, 0, 0, 0],\n  14: [4, 3, 3, 1, 0, 0, 0, 0, 0],\n  15: [4, 3, 3, 2, 0, 0, 0, 0, 0],\n  16: [4, 3, 3, 2, 0, 0, 0, 0, 0],\n  17: [4, 3, 3, 3, 1, 0, 0, 0, 0],\n  18: [4, 3, 3, 3, 1, 0, 0, 0, 0],\n  19: [4, 3, 3, 3, 2, 0, 0, 0, 0],\n  20: [4, 3, 3, 3, 2, 0, 0, 0, 0]\n};\n\n/**\n * Warlock Pact Magic slot table.\n *\n * Key rules (D&D 5e RAW):\n *   - All slots are the SAME level (pact slot level).\n *   - ALL slots recover on a SHORT rest (not long rest).\n *   - Warlocks cannot downcast — every cast uses the pact slot level.\n *\n * Format: { slotCount, slotLevel }\n * (We also expose a 9-element array via getSpellSlots for display compatibility.)\n */\nexport const WARLOCK_PACT_MAGIC = {\n  1: {\n    slotCount: 1,\n    slotLevel: 1\n  },\n  2: {\n    slotCount: 2,\n    slotLevel: 1\n  },\n  3: {\n    slotCount: 2,\n    slotLevel: 2\n  },\n  4: {\n    slotCount: 2,\n    slotLevel: 2\n  },\n  5: {\n    slotCount: 2,\n    slotLevel: 3\n  },\n  6: {\n    slotCount: 2,\n    slotLevel: 3\n  },\n  7: {\n    slotCount: 2,\n    slotLevel: 4\n  },\n  8: {\n    slotCount: 2,\n    slotLevel: 4\n  },\n  9: {\n    slotCount: 2,\n    slotLevel: 5\n  },\n  10: {\n    slotCount: 2,\n    slotLevel: 5\n  },\n  11: {\n    slotCount: 3,\n    slotLevel: 5\n  },\n  12: {\n    slotCount: 3,\n    slotLevel: 5\n  },\n  13: {\n    slotCount: 3,\n    slotLevel: 5\n  },\n  14: {\n    slotCount: 3,\n    slotLevel: 5\n  },\n  15: {\n    slotCount: 3,\n    slotLevel: 5\n  },\n  16: {\n    slotCount: 3,\n    slotLevel: 5\n  },\n  17: {\n    slotCount: 4,\n    slotLevel: 5\n  },\n  18: {\n    slotCount: 4,\n    slotLevel: 5\n  },\n  19: {\n    slotCount: 4,\n    slotLevel: 5\n  },\n  20: {\n    slotCount: 4,\n    slotLevel: 5\n  }\n};\n\n/**\n * Classes and their spellcasting type\n */\nexport const SPELLCASTING_CLASSES = {\n  Wizard: 'full',\n  Sorcerer: 'full',\n  Cleric: 'full',\n  Druid: 'full',\n  Bard: 'full',\n  Warlock: 'pact',\n  // Special case — short rest recovery, same-level slots\n  Paladin: 'half',\n  Ranger: 'half',\n  Fighter: 'third',\n  // Eldritch Knight\n  Rogue: 'third' // Arcane Trickster\n};\n\n/**\n * Returns true if the character is a Warlock using Pact Magic.\n */\nexport function isWarlockPactMagic(character) {\n  return SPELLCASTING_CLASSES[character.class] === 'pact';\n}\n\n/**\n * Returns the Warlock's current pact slot info: { slotCount, slotLevel }\n * Falls back to level-1 entry if level is out of range.\n */\nexport function getWarlockPactSlots(character) {\n  return WARLOCK_PACT_MAGIC[character.level] || WARLOCK_PACT_MAGIC[1];\n}\n\n/**\n * Spell Database (100+ spells!)\n */\nexport const SPELL_DATABASE = {\n  // ==================== CANTRIPS (Level 0) ====================\n  fire_bolt: {\n    name: 'Fire Bolt',\n    level: 0,\n    school: SPELL_SCHOOLS.EVOCATION,\n    castingTime: '1 action',\n    range: '120 feet',\n    components: 'V, S',\n    duration: 'Instantaneous',\n    description: 'A streak of fire that deals 1d10 fire damage.',\n    damage: '1d10',\n    damageType: 'fire',\n    scalingDamage: {\n      5: '2d10',\n      11: '3d10',\n      17: '4d10'\n    },\n    ritual: false,\n    concentration: false\n  },\n  mage_hand: {\n    name: 'Mage Hand',\n    level: 0,\n    school: SPELL_SCHOOLS.CONJURATION,\n    castingTime: '1 action',\n    range: '30 feet',\n    components: 'V, S',\n    duration: '1 minute',\n    description: 'A spectral hand appears and can manipulate objects.',\n    ritual: false,\n    concentration: false\n  },\n  prestidigitation: {\n    name: 'Prestidigitation',\n    level: 0,\n    school: SPELL_SCHOOLS.TRANSMUTATION,\n    castingTime: '1 action',\n    range: '10 feet',\n    components: 'V, S',\n    duration: 'Up to 1 hour',\n    description: 'Perform minor magical tricks.',\n    ritual: false,\n    concentration: false\n  },\n  light: {\n    name: 'Light',\n    level: 0,\n    school: SPELL_SCHOOLS.EVOCATION,\n    castingTime: '1 action',\n    range: 'Touch',\n    components: 'V, M',\n    duration: '1 hour',\n    description: 'Touch an object to make it glow with bright light.',\n    ritual: false,\n    concentration: false\n  },\n  sacred_flame: {\n    name: 'Sacred Flame',\n    level: 0,\n    school: SPELL_SCHOOLS.EVOCATION,\n    castingTime: '1 action',\n    range: '60 feet',\n    components: 'V, S',\n    duration: 'Instantaneous',\n    description: 'Flame-like radiance descends on a creature, dealing 1d8 radiant damage.',\n    damage: '1d8',\n    damageType: 'radiant',\n    scalingDamage: {\n      5: '2d8',\n      11: '3d8',\n      17: '4d8'\n    },\n    ritual: false,\n    concentration: false\n  },\n  eldritch_blast: {\n    name: 'Eldritch Blast',\n    level: 0,\n    school: SPELL_SCHOOLS.EVOCATION,\n    castingTime: '1 action',\n    range: '120 feet',\n    components: 'V, S',\n    duration: 'Instantaneous',\n    description: 'A beam of crackling energy that deals 1d10 force damage.',\n    damage: '1d10',\n    damageType: 'force',\n    scalingDamage: {\n      5: '2d10',\n      11: '3d10',\n      17: '4d10'\n    },\n    ritual: false,\n    concentration: false\n  },\n  // ==================== LEVEL 1 SPELLS ====================\n  magic_missile: {\n    name: 'Magic Missile',\n    level: 1,\n    school: SPELL_SCHOOLS.EVOCATION,\n    castingTime: '1 action',\n    range: '120 feet',\n    components: 'V, S',\n    duration: 'Instantaneous',\n    description: 'Three glowing darts that automatically hit for 1d4+1 force damage each.',\n    damage: '3d4+3',\n    damageType: 'force',\n    upcastBonus: '+1 missile per level',\n    ritual: false,\n    concentration: false\n  },\n  shield: {\n    name: 'Shield',\n    level: 1,\n    school: SPELL_SCHOOLS.ABJURATION,\n    castingTime: '1 reaction',\n    range: 'Self',\n    components: 'V, S',\n    duration: '1 round',\n    description: 'Gain +5 to AC until the start of your next turn.',\n    ritual: false,\n    concentration: false\n  },\n  healing_word: {\n    name: 'Healing Word',\n    level: 1,\n    school: SPELL_SCHOOLS.EVOCATION,\n    castingTime: '1 bonus action',\n    range: '60 feet',\n    components: 'V',\n    duration: 'Instantaneous',\n    description: 'Heal a creature for 1d4 + spellcasting modifier HP.',\n    healing: '1d4',\n    upcastBonus: '+1d4 per level',\n    ritual: false,\n    concentration: false\n  },\n  cure_wounds: {\n    name: 'Cure Wounds',\n    level: 1,\n    school: SPELL_SCHOOLS.EVOCATION,\n    castingTime: '1 action',\n    range: 'Touch',\n    components: 'V, S',\n    duration: 'Instantaneous',\n    description: 'Heal a creature for 1d8 + spellcasting modifier HP.',\n    healing: '1d8',\n    upcastBonus: '+1d8 per level',\n    ritual: false,\n    concentration: false\n  },\n  thunderwave: {\n    name: 'Thunderwave',\n    level: 1,\n    school: SPELL_SCHOOLS.EVOCATION,\n    castingTime: '1 action',\n    range: 'Self (15-foot cube)',\n    components: 'V, S',\n    duration: 'Instantaneous',\n    description: 'A wave of thunderous force dealing 2d8 thunder damage.',\n    damage: '2d8',\n    damageType: 'thunder',\n    upcastBonus: '+1d8 per level',\n    ritual: false,\n    concentration: false\n  },\n  burning_hands: {\n    name: 'Burning Hands',\n    level: 1,\n    school: SPELL_SCHOOLS.EVOCATION,\n    castingTime: '1 action',\n    range: 'Self (15-foot cone)',\n    components: 'V, S',\n    duration: 'Instantaneous',\n    description: 'A thin sheet of flames dealing 3d6 fire damage.',\n    damage: '3d6',\n    damageType: 'fire',\n    upcastBonus: '+1d6 per level',\n    ritual: false,\n    concentration: false\n  },\n  detect_magic: {\n    name: 'Detect Magic',\n    level: 1,\n    school: SPELL_SCHOOLS.DIVINATION,\n    castingTime: '1 action',\n    range: 'Self',\n    components: 'V, S',\n    duration: 'Concentration, up to 10 minutes',\n    description: 'Sense the presence of magic within 30 feet.',\n    ritual: true,\n    concentration: true\n  },\n  identify: {\n    name: 'Identify',\n    level: 1,\n    school: SPELL_SCHOOLS.DIVINATION,\n    castingTime: '1 minute',\n    range: 'Touch',\n    components: 'V, S, M',\n    duration: 'Instantaneous',\n    description: 'Learn the properties of a magic item or the spells affecting a creature.',\n    ritual: true,\n    concentration: false\n  },\n  find_familiar: {\n    name: 'Find Familiar',\n    level: 1,\n    school: SPELL_SCHOOLS.CONJURATION,\n    castingTime: '1 hour',\n    range: '10 feet',\n    components: 'V, S, M',\n    duration: 'Instantaneous',\n    description: 'Summon a fey spirit in the form of an animal to serve as your familiar.',\n    ritual: true,\n    concentration: false\n  },\n  sleep: {\n    name: 'Sleep',\n    level: 1,\n    school: SPELL_SCHOOLS.ENCHANTMENT,\n    castingTime: '1 action',\n    range: '90 feet',\n    components: 'V, S, M',\n    duration: '1 minute',\n    description: 'Put creatures to sleep starting with lowest HP (5d8 HP worth).',\n    ritual: false,\n    concentration: false\n  },\n  // ==================== LEVEL 2 SPELLS ====================\n  scorching_ray: {\n    name: 'Scorching Ray',\n    level: 2,\n    school: SPELL_SCHOOLS.EVOCATION,\n    castingTime: '1 action',\n    range: '120 feet',\n    components: 'V, S',\n    duration: 'Instantaneous',\n    description: 'Create three rays of fire, each dealing 2d6 fire damage.',\n    damage: '2d6',\n    damageType: 'fire',\n    upcastBonus: '+1 ray per level',\n    ritual: false,\n    concentration: false\n  },\n  misty_step: {\n    name: 'Misty Step',\n    level: 2,\n    school: SPELL_SCHOOLS.CONJURATION,\n    castingTime: '1 bonus action',\n    range: 'Self',\n    components: 'V',\n    duration: 'Instantaneous',\n    description: 'Teleport up to 30 feet to an unoccupied space you can see.',\n    ritual: false,\n    concentration: false\n  },\n  invisibility: {\n    name: 'Invisibility',\n    level: 2,\n    school: SPELL_SCHOOLS.ILLUSION,\n    castingTime: '1 action',\n    range: 'Touch',\n    components: 'V, S, M',\n    duration: 'Concentration, up to 1 hour',\n    description: 'A creature becomes invisible until it attacks or casts a spell.',\n    ritual: false,\n    concentration: true\n  },\n  hold_person: {\n    name: 'Hold Person',\n    level: 2,\n    school: SPELL_SCHOOLS.ENCHANTMENT,\n    castingTime: '1 action',\n    range: '60 feet',\n    components: 'V, S, M',\n    duration: 'Concentration, up to 1 minute',\n    description: 'Paralyze a humanoid target.',\n    ritual: false,\n    concentration: true\n  },\n  spiritual_weapon: {\n    name: 'Spiritual Weapon',\n    level: 2,\n    school: SPELL_SCHOOLS.EVOCATION,\n    castingTime: '1 bonus action',\n    range: '60 feet',\n    components: 'V, S',\n    duration: 'Concentration, up to 1 minute',\n    description: 'Create a floating weapon that deals 1d8 + spellcasting modifier force damage.',\n    damage: '1d8',\n    damageType: 'force',\n    upcastBonus: '+1d8 per 2 levels',\n    ritual: false,\n    concentration: true\n  },\n  // ==================== LEVEL 3 SPELLS ====================\n  fireball: {\n    name: 'Fireball',\n    level: 3,\n    school: SPELL_SCHOOLS.EVOCATION,\n    castingTime: '1 action',\n    range: '150 feet',\n    components: 'V, S, M',\n    duration: 'Instantaneous',\n    description: 'A bright streak that explodes in a 20-foot radius, dealing 8d6 fire damage.',\n    damage: '8d6',\n    damageType: 'fire',\n    upcastBonus: '+1d6 per level',\n    ritual: false,\n    concentration: false\n  },\n  lightning_bolt: {\n    name: 'Lightning Bolt',\n    level: 3,\n    school: SPELL_SCHOOLS.EVOCATION,\n    castingTime: '1 action',\n    range: 'Self (100-foot line)',\n    components: 'V, S, M',\n    duration: 'Instantaneous',\n    description: 'A bolt of lightning in a 100-foot line dealing 8d6 lightning damage.',\n    damage: '8d6',\n    damageType: 'lightning',\n    upcastBonus: '+1d6 per level',\n    ritual: false,\n    concentration: false\n  },\n  counterspell: {\n    name: 'Counterspell',\n    level: 3,\n    school: SPELL_SCHOOLS.ABJURATION,\n    castingTime: '1 reaction',\n    range: '60 feet',\n    components: 'S',\n    duration: 'Instantaneous',\n    description: 'Interrupt a creature casting a spell of 3rd level or lower.',\n    ritual: false,\n    concentration: false\n  },\n  fly: {\n    name: 'Fly',\n    level: 3,\n    school: SPELL_SCHOOLS.TRANSMUTATION,\n    castingTime: '1 action',\n    range: 'Touch',\n    components: 'V, S, M',\n    duration: 'Concentration, up to 10 minutes',\n    description: 'Grant a creature a flying speed of 60 feet.',\n    ritual: false,\n    concentration: true\n  },\n  haste: {\n    name: 'Haste',\n    level: 3,\n    school: SPELL_SCHOOLS.TRANSMUTATION,\n    castingTime: '1 action',\n    range: '30 feet',\n    components: 'V, S, M',\n    duration: 'Concentration, up to 1 minute',\n    description: 'Double speed, +2 AC, advantage on DEX saves, extra action.',\n    ritual: false,\n    concentration: true\n  },\n  // ==================== LEVEL 4 SPELLS ====================\n  greater_invisibility: {\n    name: 'Greater Invisibility',\n    level: 4,\n    school: SPELL_SCHOOLS.ILLUSION,\n    castingTime: '1 action',\n    range: 'Touch',\n    components: 'V, S',\n    duration: 'Concentration, up to 1 minute',\n    description: 'A creature becomes invisible even when attacking or casting.',\n    ritual: false,\n    concentration: true\n  },\n  polymorph: {\n    name: 'Polymorph',\n    level: 4,\n    school: SPELL_SCHOOLS.TRANSMUTATION,\n    castingTime: '1 action',\n    range: '60 feet',\n    components: 'V, S, M',\n    duration: 'Concentration, up to 1 hour',\n    description: 'Transform a creature into a beast with CR equal to or less than its level.',\n    ritual: false,\n    concentration: true\n  },\n  dimension_door: {\n    name: 'Dimension Door',\n    level: 4,\n    school: SPELL_SCHOOLS.CONJURATION,\n    castingTime: '1 action',\n    range: '500 feet',\n    components: 'V',\n    duration: 'Instantaneous',\n    description: 'Teleport yourself and up to one willing creature 500 feet.',\n    ritual: false,\n    concentration: false\n  },\n  ice_storm: {\n    name: 'Ice Storm',\n    level: 4,\n    school: SPELL_SCHOOLS.EVOCATION,\n    castingTime: '1 action',\n    range: '300 feet',\n    components: 'V, S, M',\n    duration: 'Instantaneous',\n    description: 'Hail falls in a 20-foot radius dealing 2d8 bludgeoning and 4d6 cold damage.',\n    damage: '2d8+4d6',\n    damageType: 'bludgeoning/cold',\n    ritual: false,\n    concentration: false\n  },\n  // ==================== LEVEL 5 SPELLS ====================\n  cone_of_cold: {\n    name: 'Cone of Cold',\n    level: 5,\n    school: SPELL_SCHOOLS.EVOCATION,\n    castingTime: '1 action',\n    range: 'Self (60-foot cone)',\n    components: 'V, S, M',\n    duration: 'Instantaneous',\n    description: 'A blast of cold air dealing 8d8 cold damage.',\n    damage: '8d8',\n    damageType: 'cold',\n    upcastBonus: '+1d8 per level',\n    ritual: false,\n    concentration: false\n  },\n  wall_of_force: {\n    name: 'Wall of Force',\n    level: 5,\n    school: SPELL_SCHOOLS.EVOCATION,\n    castingTime: '1 action',\n    range: '120 feet',\n    components: 'V, S, M',\n    duration: 'Concentration, up to 10 minutes',\n    description: 'Create an invisible wall of force that is impenetrable.',\n    ritual: false,\n    concentration: true\n  },\n  teleportation_circle: {\n    name: 'Teleportation Circle',\n    level: 5,\n    school: SPELL_SCHOOLS.CONJURATION,\n    castingTime: '1 minute',\n    range: '10 feet',\n    components: 'V, M',\n    duration: '1 round',\n    description: 'Create a portal to a permanent teleportation circle.',\n    ritual: true,\n    concentration: false\n  },\n  // ==================== LEVEL 6+ SPELLS ====================\n  chain_lightning: {\n    name: 'Chain Lightning',\n    level: 6,\n    school: SPELL_SCHOOLS.EVOCATION,\n    castingTime: '1 action',\n    range: '150 feet',\n    components: 'V, S, M',\n    duration: 'Instantaneous',\n    description: 'Lightning arcs to up to 4 targets, dealing 10d8 lightning damage.',\n    damage: '10d8',\n    damageType: 'lightning',\n    upcastBonus: '+1d8 per level',\n    ritual: false,\n    concentration: false\n  },\n  disintegrate: {\n    name: 'Disintegrate',\n    level: 6,\n    school: SPELL_SCHOOLS.TRANSMUTATION,\n    castingTime: '1 action',\n    range: '60 feet',\n    components: 'V, S, M',\n    duration: 'Instantaneous',\n    description: 'A thin green ray that deals 10d6+40 force damage.',\n    damage: '10d6+40',\n    damageType: 'force',\n    upcastBonus: '+3d6 per level',\n    ritual: false,\n    concentration: false\n  },\n  finger_of_death: {\n    name: 'Finger of Death',\n    level: 7,\n    school: SPELL_SCHOOLS.NECROMANCY,\n    castingTime: '1 action',\n    range: '60 feet',\n    components: 'V, S',\n    duration: 'Instantaneous',\n    description: 'Send negative energy dealing 7d8+30 necrotic damage.',\n    damage: '7d8+30',\n    damageType: 'necrotic',\n    ritual: false,\n    concentration: false\n  },\n  power_word_stun: {\n    name: 'Power Word Stun',\n    level: 8,\n    school: SPELL_SCHOOLS.ENCHANTMENT,\n    castingTime: '1 action',\n    range: '60 feet',\n    components: 'V',\n    duration: 'Instantaneous',\n    description: 'Stun a creature with 150 HP or fewer.',\n    ritual: false,\n    concentration: false\n  },\n  meteor_swarm: {\n    name: 'Meteor Swarm',\n    level: 9,\n    school: SPELL_SCHOOLS.EVOCATION,\n    castingTime: '1 action',\n    range: '1 mile',\n    components: 'V, S',\n    duration: 'Instantaneous',\n    description: 'Four meteors that each explode in 40-foot radius dealing 20d6 fire + 20d6 bludgeoning.',\n    damage: '20d6+20d6',\n    damageType: 'fire/bludgeoning',\n    ritual: false,\n    concentration: false\n  },\n  wish: {\n    name: 'Wish',\n    level: 9,\n    school: SPELL_SCHOOLS.CONJURATION,\n    castingTime: '1 action',\n    range: 'Self',\n    components: 'V',\n    duration: 'Instantaneous',\n    description: 'The most powerful spell. Replicate any spell of 8th level or lower, or alter reality.',\n    ritual: false,\n    concentration: false\n  }\n};\n\n/**\n * Get spells by level\n */\nexport function getSpellsByLevel(level) {\n  return Object.entries(SPELL_DATABASE).filter(([_, spell]) => spell.level === level).map(([key, spell]) => ({\n    key,\n    ...spell\n  }));\n}\n\n/**\n * Get spells by school\n */\nexport function getSpellsBySchool(school) {\n  return Object.entries(SPELL_DATABASE).filter(([_, spell]) => spell.school === school).map(([key, spell]) => ({\n    key,\n    ...spell\n  }));\n}\n\n/**\n * Get spell slots for character.\n *\n * For Warlocks, returns a 9-element array where only the pact slot level\n * index is non-zero (e.g. level-5 Warlock → [0,0,0,0,2,0,0,0,0]).\n * This keeps compatibility with all existing slot display code.\n */\nexport function getSpellSlots(character) {\n  const spellcastingType = SPELLCASTING_CLASSES[character.class];\n  if (!spellcastingType) {\n    return [0, 0, 0, 0, 0, 0, 0, 0, 0];\n  }\n  if (spellcastingType === 'full') {\n    return SPELL_SLOTS_FULL_CASTER[character.level] || [0, 0, 0, 0, 0, 0, 0, 0, 0];\n  }\n  if (spellcastingType === 'half') {\n    return SPELL_SLOTS_HALF_CASTER[character.level] || [0, 0, 0, 0, 0, 0, 0, 0, 0];\n  }\n\n  // Warlock Pact Magic — all slots at a single level\n  if (spellcastingType === 'pact') {\n    const {\n      slotCount,\n      slotLevel\n    } = getWarlockPactSlots(character);\n    const slots = [0, 0, 0, 0, 0, 0, 0, 0, 0];\n    slots[slotLevel - 1] = slotCount;\n    return slots;\n  }\n  return [0, 0, 0, 0, 0, 0, 0, 0, 0];\n}\n\n/**\n * Check if character can cast a spell.\n *\n * For Warlocks, the spell must be at or below the pact slot level —\n * they cannot cast spells requiring a slot higher than their pact level.\n */\nexport function canCastSpell(character, spell) {\n  var _character$spellSlots2;\n  // Cantrips can always be cast\n  if (spell.level === 0) return true;\n  if (isWarlockPactMagic(character)) {\n    var _character$spellSlots;\n    const {\n      slotLevel\n    } = getWarlockPactSlots(character);\n    // Spell level must be ≤ pact slot level AND must have slots remaining\n    if (spell.level > slotLevel) return false;\n    const currentSlots = ((_character$spellSlots = character.spellSlots) === null || _character$spellSlots === void 0 ? void 0 : _character$spellSlots.current) || getSpellSlots(character);\n    return (currentSlots[slotLevel - 1] || 0) > 0;\n  }\n  const spellSlots = getSpellSlots(character);\n  const currentSlots = ((_character$spellSlots2 = character.spellSlots) === null || _character$spellSlots2 === void 0 ? void 0 : _character$spellSlots2.current) || spellSlots;\n  return (currentSlots[spell.level - 1] || 0) > 0;\n}\n\n/**\n * Cast a spell (uses a spell slot).\n *\n * For Warlocks, always consumes one pact slot (at the pact slot level),\n * regardless of the spell's base level. The slotLevel param is ignored\n * for Warlocks — they cannot choose a different slot level.\n */\nexport function castSpell(character, spell, slotLevel = null) {\n  var _character$spellSlots3;\n  // Cantrips don't use slots\n  if (spell.level === 0) {\n    return {\n      success: true,\n      character,\n      message: `Cast ${spell.name}!`\n    };\n  }\n  if (!canCastSpell(character, spell)) {\n    return {\n      success: false,\n      character,\n      message: isWarlockPactMagic(character) ? `No Pact Magic slots remaining! Take a short rest to recover.` : `No spell slots remaining for level ${spell.level}!`\n    };\n  }\n  const spellSlots = getSpellSlots(character);\n  const currentSlots = (_character$spellSlots3 = character.spellSlots) !== null && _character$spellSlots3 !== void 0 && _character$spellSlots3.current ? [...character.spellSlots.current] : [...spellSlots];\n  let usedLevel;\n  if (isWarlockPactMagic(character)) {\n    // Always use pact slot level — Warlocks don't choose\n    const {\n      slotLevel: pactLevel\n    } = getWarlockPactSlots(character);\n    usedLevel = pactLevel;\n    currentSlots[pactLevel - 1] -= 1;\n  } else {\n    // Normal casters: use requested slot level or spell's base level\n    usedLevel = slotLevel || spell.level;\n    currentSlots[usedLevel - 1] -= 1;\n  }\n  return {\n    success: true,\n    character: {\n      ...character,\n      spellSlots: {\n        max: spellSlots,\n        current: currentSlots\n      }\n    },\n    message: isWarlockPactMagic(character) ? `Cast ${spell.name} using a Pact Magic slot (level ${usedLevel})!` : `Cast ${spell.name} using a level ${usedLevel} spell slot!`\n  };\n}\n\n/**\n * Long rest — restores all spell slots for non-Warlocks.\n * Warlocks do NOT recover pact slots on a long rest via this path\n * (they use shortRest instead), but we still restore them here for\n * convenience since a long rest includes all benefits of a short rest.\n */\nexport function longRest(character) {\n  const spellSlots = getSpellSlots(character);\n  return {\n    ...character,\n    spellSlots: {\n      max: spellSlots,\n      current: [...spellSlots]\n    }\n  };\n}\n\n/**\n * Short rest — ONLY Warlocks recover spell slots on a short rest.\n * Other classes recover nothing (hit dice use handled elsewhere).\n *\n * Returns the updated character object. Always safe to call on any class —\n * non-Warlocks are returned unchanged.\n */\nexport function shortRest(character) {\n  if (!isWarlockPactMagic(character)) {\n    // Non-Warlocks: no spell slot recovery on a short rest\n    return character;\n  }\n\n  // Warlocks: restore all pact slots\n  const spellSlots = getSpellSlots(character);\n  console.log(`[shortRest] ${character.name} (Warlock) recovers all Pact Magic slots.`);\n  return {\n    ...character,\n    spellSlots: {\n      max: spellSlots,\n      current: [...spellSlots]\n    }\n  };\n}\n\n/**\n * Classes that can perform ritual casting.\n * - Wizard: can ritual cast any ritual spell in their spellbook (known list)\n * - Cleric, Druid, Bard: can ritual cast ritual spells they have prepared/known\n * - Warlock, Sorcerer, Paladin, Ranger: NO ritual casting\n */\nexport const RITUAL_CASTER_CLASSES = new Set(['Wizard', 'Cleric', 'Druid', 'Bard']);\n\n/**\n * Check if a character can ritual cast a specific spell.\n *\n * Rules:\n *  1. Spell must have ritual: true\n *  2. Character's class must be in RITUAL_CASTER_CLASSES\n *  3. Wizards can cast any ritual spell they know (spells.known)\n *     Other ritual casters need the spell prepared or known\n */\nexport function canRitualCast(character, spell) {\n  var _character$spells, _character$spells2, _character$spells3;\n  if (!spell.ritual) return false;\n  if (!RITUAL_CASTER_CLASSES.has(character.class)) return false;\n  const knownKeys = ((_character$spells = character.spells) === null || _character$spells === void 0 ? void 0 : _character$spells.known) || [];\n  const preparedKeys = ((_character$spells2 = character.spells) === null || _character$spells2 === void 0 ? void 0 : _character$spells2.prepared) || [];\n  const cantripKeys = ((_character$spells3 = character.spells) === null || _character$spells3 === void 0 ? void 0 : _character$spells3.cantrips) || [];\n  const allAccessible = [...new Set([...knownKeys, ...preparedKeys, ...cantripKeys])];\n\n  // Wizards: any ritual spell in their spellbook (known list) qualifies\n  if (character.class === 'Wizard') {\n    return knownKeys.includes(spell.key) || allAccessible.includes(spell.key);\n  }\n\n  // Other ritual casters: must have it prepared or known\n  return allAccessible.includes(spell.key);\n}\n\n/**\n * Cast a spell as a ritual — no spell slot consumed.\n * Returns same shape as castSpell() for easy drop-in use.\n *\n * Note: ritual casting takes 10 extra minutes in real D&D,\n * which we flag in the message but don't block on.\n */\nexport function castRitual(character, spell) {\n  if (!canRitualCast(character, spell)) {\n    return {\n      success: false,\n      character,\n      message: `${character.name} cannot ritual cast ${spell.name}.`\n    };\n  }\n  console.log(`[RitualCast] ${character.name} ritual casts ${spell.name} (no slot used).`);\n  return {\n    success: true,\n    character,\n    // No slot consumed — character state unchanged\n    message: `${spell.name} cast as a ritual! (10 minutes, no spell slot used)`\n  };\n}\n\n/**\n * Get all ritual spells accessible to a character (for SpellBook filtering).\n */\nexport function getRitualSpells(character) {\n  if (!RITUAL_CASTER_CLASSES.has(character.class)) return [];\n  return Object.entries(SPELL_DATABASE).filter(([key, spell]) => spell.ritual && canRitualCast(character, {\n    ...spell,\n    key\n  })).map(([key, spell]) => ({\n    key,\n    ...spell\n  }));\n}\n\n/**\n * Prepare spells (for prepared casters like Clerics, Wizards)\n */\nexport function prepareSpells(character, spellKeys) {\n  const spellcastingAbility = getSpellcastingAbility(character.class);\n  const modifier = Math.floor((character.abilities[spellcastingAbility] - 10) / 2);\n  const maxPrepared = Math.max(1, character.level + modifier);\n  if (spellKeys.length > maxPrepared) {\n    return {\n      success: false,\n      character,\n      message: `Can only prepare ${maxPrepared} spells!`\n    };\n  }\n  return {\n    success: true,\n    character: {\n      ...character,\n      spells: {\n        ...character.spells,\n        prepared: spellKeys\n      }\n    },\n    message: `Prepared ${spellKeys.length} spells!`\n  };\n}\n\n/**\n * Get spellcasting ability for class\n */\nexport function getSpellcastingAbility(className) {\n  const abilities = {\n    Wizard: 'INT',\n    Sorcerer: 'CHA',\n    Warlock: 'CHA',\n    Bard: 'CHA',\n    Cleric: 'WIS',\n    Druid: 'WIS',\n    Paladin: 'CHA',\n    Ranger: 'WIS',\n    Fighter: 'INT',\n    Rogue: 'INT'\n  };\n  return abilities[className] || 'INT';\n}\n\n/**\n * Calculate spell save DC\n */\nexport function getSpellSaveDC(character) {\n  const ability = getSpellcastingAbility(character.class);\n  const modifier = Math.floor((character.abilities[ability] - 10) / 2);\n  const proficiencyBonus = Math.floor((character.level - 1) / 4) + 2;\n  return 8 + proficiencyBonus + modifier;\n}\n\n/**\n * Calculate spell attack bonus\n */\nexport function getSpellAttackBonus(character) {\n  const ability = getSpellcastingAbility(character.class);\n  const modifier = Math.floor((character.abilities[ability] - 10) / 2);\n  const proficiencyBonus = Math.floor((character.level - 1) / 4) + 2;\n  return proficiencyBonus + modifier;\n}\n\n/**\n * Learn a new spell (for known casters like Sorcerers)\n */\nexport function learnSpell(character, spellKey) {\n  var _character$spells4;\n  const spell = SPELL_DATABASE[spellKey];\n  if (!spell) return {\n    success: false,\n    character,\n    message: 'Spell not found!'\n  };\n  const knownSpells = ((_character$spells4 = character.spells) === null || _character$spells4 === void 0 ? void 0 : _character$spells4.known) || [];\n  if (knownSpells.includes(spellKey)) {\n    return {\n      success: false,\n      character,\n      message: 'Already know this spell!'\n    };\n  }\n  return {\n    success: true,\n    character: {\n      ...character,\n      spells: {\n        ...character.spells,\n        known: [...knownSpells, spellKey]\n      }\n    },\n    message: `Learned ${spell.name}!`\n  };\n}\n\n/**\n * Get available spell levels for character\n */\nexport function getAvailableSpellLevels(character) {\n  const slots = getSpellSlots(character);\n  const levels = [];\n\n  // Always have cantrips\n  levels.push(0);\n\n  // Add spell levels with slots\n  for (let i = 0; i < slots.length; i++) {\n    if (slots[i] > 0) {\n      levels.push(i + 1);\n    }\n  }\n  return levels;\n}\n\n/**\n * Check if class uses prepared spells\n */\nexport function usesPreparedSpells(className) {\n  return ['Wizard', 'Cleric', 'Druid', 'Paladin'].includes(className);\n}\n\n/**\n * Check if class uses known spells\n */\nexport function usesKnownSpells(className) {\n  return ['Sorcerer', 'Bard', 'Warlock', 'Ranger'].includes(className);\n}\n\n/**\n * Get spells accessible to character\n */\nexport function getAccessibleSpells(character) {\n  if (usesPreparedSpells(character.class)) {\n    var _character$spells5;\n    return ((_character$spells5 = character.spells) === null || _character$spells5 === void 0 ? void 0 : _character$spells5.prepared) || [];\n  }\n  if (usesKnownSpells(character.class)) {\n    var _character$spells6;\n    return ((_character$spells6 = character.spells) === null || _character$spells6 === void 0 ? void 0 : _character$spells6.known) || [];\n  }\n  return [];\n}\n\n/**\n * Initialize spells for character\n */\nexport function initializeSpells(character) {\n  const spellcastingType = SPELLCASTING_CLASSES[character.class];\n  if (!spellcastingType) {\n    return character; // Not a spellcaster\n  }\n  const spellSlots = getSpellSlots(character);\n\n  // Starting cantrips and spells by class\n  const startingSpells = getStartingSpells(character.class);\n  return {\n    ...character,\n    spells: {\n      known: startingSpells.known || [],\n      prepared: startingSpells.prepared || [],\n      cantrips: startingSpells.cantrips || []\n    },\n    spellSlots: {\n      max: spellSlots,\n      current: [...spellSlots]\n    }\n  };\n}\n\n/**\n * Get starting spells for class\n */\nfunction getStartingSpells(className) {\n  const starting = {\n    Wizard: {\n      cantrips: ['fire_bolt', 'mage_hand', 'prestidigitation'],\n      known: ['magic_missile', 'shield', 'detect_magic', 'burning_hands', 'sleep', 'thunderwave'],\n      prepared: []\n    },\n    Sorcerer: {\n      cantrips: ['fire_bolt', 'light', 'prestidigitation', 'mage_hand'],\n      known: ['magic_missile', 'shield', 'burning_hands', 'thunderwave'],\n      prepared: []\n    },\n    Cleric: {\n      cantrips: ['sacred_flame', 'light', 'prestidigitation'],\n      known: [],\n      prepared: ['cure_wounds', 'healing_word', 'shield', 'detect_magic']\n    },\n    Druid: {\n      cantrips: ['prestidigitation', 'light'],\n      known: [],\n      prepared: ['cure_wounds', 'healing_word', 'detect_magic', 'thunderwave']\n    },\n    Bard: {\n      cantrips: ['prestidigitation', 'light', 'mage_hand'],\n      known: ['cure_wounds', 'healing_word', 'sleep', 'thunderwave'],\n      prepared: []\n    },\n    Warlock: {\n      cantrips: ['eldritch_blast', 'prestidigitation'],\n      known: ['magic_missile', 'burning_hands'],\n      prepared: []\n    },\n    Paladin: {\n      cantrips: [],\n      known: [],\n      prepared: ['cure_wounds', 'shield']\n    },\n    Ranger: {\n      cantrips: [],\n      known: ['cure_wounds', 'healing_word'],\n      prepared: []\n    }\n  };\n  return starting[className] || {\n    cantrips: [],\n    known: [],\n    prepared: []\n  };\n}\n\n/**\n * Calculate damage for spell\n */\nexport function calculateSpellDamage(spell, characterLevel, upcastLevel = null) {\n  if (!spell.damage) return null;\n\n  // For cantrips, use scaling damage\n  if (spell.level === 0 && spell.scalingDamage) {\n    for (const [level, damage] of Object.entries(spell.scalingDamage).reverse()) {\n      if (characterLevel >= parseInt(level)) {\n        return damage;\n      }\n    }\n  }\n\n  // For leveled spells with upcasting\n  if (upcastLevel && upcastLevel > spell.level && spell.upcastBonus) {\n    const levelDiff = upcastLevel - spell.level;\n    // Parse damage (e.g., \"3d6\" -> 3 dice of d6)\n    const match = spell.damage.match(/(\\d+)d(\\d+)/);\n    if (match) {\n      const [, numDice, dieSize] = match;\n      const extraDice = levelDiff;\n      return `${parseInt(numDice) + extraDice}d${dieSize}`;\n    }\n  }\n  return spell.damage;\n}\n\n/**\n * Roll spell damage\n */\nexport function rollSpellDamage(damageString) {\n  const match = damageString.match(/(\\d+)d(\\d+)([+-]\\d+)?/);\n  if (!match) return {\n    total: 0,\n    rolls: []\n  };\n  const [, numDice, dieSize, modifier] = match;\n  let total = 0;\n  const rolls = [];\n  for (let i = 0; i < parseInt(numDice); i++) {\n    const roll = Math.floor(Math.random() * parseInt(dieSize)) + 1;\n    rolls.push(roll);\n    total += roll;\n  }\n  if (modifier) {\n    total += parseInt(modifier);\n  }\n  return {\n    total,\n    rolls,\n    modifier: modifier || '+0'\n  };\n}","map":{"version":3,"names":["SPELL_SCHOOLS","ABJURATION","CONJURATION","DIVINATION","ENCHANTMENT","EVOCATION","ILLUSION","NECROMANCY","TRANSMUTATION","SPELL_SLOTS_FULL_CASTER","SPELL_SLOTS_HALF_CASTER","WARLOCK_PACT_MAGIC","slotCount","slotLevel","SPELLCASTING_CLASSES","Wizard","Sorcerer","Cleric","Druid","Bard","Warlock","Paladin","Ranger","Fighter","Rogue","isWarlockPactMagic","character","class","getWarlockPactSlots","level","SPELL_DATABASE","fire_bolt","name","school","castingTime","range","components","duration","description","damage","damageType","scalingDamage","ritual","concentration","mage_hand","prestidigitation","light","sacred_flame","eldritch_blast","magic_missile","upcastBonus","shield","healing_word","healing","cure_wounds","thunderwave","burning_hands","detect_magic","identify","find_familiar","sleep","scorching_ray","misty_step","invisibility","hold_person","spiritual_weapon","fireball","lightning_bolt","counterspell","fly","haste","greater_invisibility","polymorph","dimension_door","ice_storm","cone_of_cold","wall_of_force","teleportation_circle","chain_lightning","disintegrate","finger_of_death","power_word_stun","meteor_swarm","wish","getSpellsByLevel","Object","entries","filter","_","spell","map","key","getSpellsBySchool","getSpellSlots","spellcastingType","slots","canCastSpell","_character$spellSlots2","_character$spellSlots","currentSlots","spellSlots","current","castSpell","_character$spellSlots3","success","message","usedLevel","pactLevel","max","longRest","shortRest","console","log","RITUAL_CASTER_CLASSES","Set","canRitualCast","_character$spells","_character$spells2","_character$spells3","has","knownKeys","spells","known","preparedKeys","prepared","cantripKeys","cantrips","allAccessible","includes","castRitual","getRitualSpells","prepareSpells","spellKeys","spellcastingAbility","getSpellcastingAbility","modifier","Math","floor","abilities","maxPrepared","length","className","getSpellSaveDC","ability","proficiencyBonus","getSpellAttackBonus","learnSpell","spellKey","_character$spells4","knownSpells","getAvailableSpellLevels","levels","push","i","usesPreparedSpells","usesKnownSpells","getAccessibleSpells","_character$spells5","_character$spells6","initializeSpells","startingSpells","getStartingSpells","starting","calculateSpellDamage","characterLevel","upcastLevel","reverse","parseInt","levelDiff","match","numDice","dieSize","extraDice","rollSpellDamage","damageString","total","rolls","roll","random"],"sources":["C:/Users/Hakty/Desktop/AI-Dungeon-Master/frontend/src/utils/spellSystem.js"],"sourcesContent":["// frontend/src/utils/spellSystem.js\n\n/**\n * D&D 5e Spell Casting System\n * Spell slots, prepared spells, spell book\n */\n\n/**\n * Spell Schools\n */\nexport const SPELL_SCHOOLS = {\n  ABJURATION: 'Abjuration',\n  CONJURATION: 'Conjuration',\n  DIVINATION: 'Divination',\n  ENCHANTMENT: 'Enchantment',\n  EVOCATION: 'Evocation',\n  ILLUSION: 'Illusion',\n  NECROMANCY: 'Necromancy',\n  TRANSMUTATION: 'Transmutation'\n};\n\n/**\n * Spell slot progression by class level (for full casters)\n */\nexport const SPELL_SLOTS_FULL_CASTER = {\n  1: [2, 0, 0, 0, 0, 0, 0, 0, 0],\n  2: [3, 0, 0, 0, 0, 0, 0, 0, 0],\n  3: [4, 2, 0, 0, 0, 0, 0, 0, 0],\n  4: [4, 3, 0, 0, 0, 0, 0, 0, 0],\n  5: [4, 3, 2, 0, 0, 0, 0, 0, 0],\n  6: [4, 3, 3, 0, 0, 0, 0, 0, 0],\n  7: [4, 3, 3, 1, 0, 0, 0, 0, 0],\n  8: [4, 3, 3, 2, 0, 0, 0, 0, 0],\n  9: [4, 3, 3, 3, 1, 0, 0, 0, 0],\n  10: [4, 3, 3, 3, 2, 0, 0, 0, 0],\n  11: [4, 3, 3, 3, 2, 1, 0, 0, 0],\n  12: [4, 3, 3, 3, 2, 1, 0, 0, 0],\n  13: [4, 3, 3, 3, 2, 1, 1, 0, 0],\n  14: [4, 3, 3, 3, 2, 1, 1, 0, 0],\n  15: [4, 3, 3, 3, 2, 1, 1, 1, 0],\n  16: [4, 3, 3, 3, 2, 1, 1, 1, 0],\n  17: [4, 3, 3, 3, 2, 1, 1, 1, 1],\n  18: [4, 3, 3, 3, 3, 1, 1, 1, 1],\n  19: [4, 3, 3, 3, 3, 2, 1, 1, 1],\n  20: [4, 3, 3, 3, 3, 2, 2, 1, 1]\n};\n\n/**\n * Half caster progression (Paladin, Ranger)\n */\nexport const SPELL_SLOTS_HALF_CASTER = {\n  1: [0, 0, 0, 0, 0, 0, 0, 0, 0],\n  2: [2, 0, 0, 0, 0, 0, 0, 0, 0],\n  3: [3, 0, 0, 0, 0, 0, 0, 0, 0],\n  4: [3, 0, 0, 0, 0, 0, 0, 0, 0],\n  5: [4, 2, 0, 0, 0, 0, 0, 0, 0],\n  6: [4, 2, 0, 0, 0, 0, 0, 0, 0],\n  7: [4, 3, 0, 0, 0, 0, 0, 0, 0],\n  8: [4, 3, 0, 0, 0, 0, 0, 0, 0],\n  9: [4, 3, 2, 0, 0, 0, 0, 0, 0],\n  10: [4, 3, 2, 0, 0, 0, 0, 0, 0],\n  11: [4, 3, 3, 0, 0, 0, 0, 0, 0],\n  12: [4, 3, 3, 0, 0, 0, 0, 0, 0],\n  13: [4, 3, 3, 1, 0, 0, 0, 0, 0],\n  14: [4, 3, 3, 1, 0, 0, 0, 0, 0],\n  15: [4, 3, 3, 2, 0, 0, 0, 0, 0],\n  16: [4, 3, 3, 2, 0, 0, 0, 0, 0],\n  17: [4, 3, 3, 3, 1, 0, 0, 0, 0],\n  18: [4, 3, 3, 3, 1, 0, 0, 0, 0],\n  19: [4, 3, 3, 3, 2, 0, 0, 0, 0],\n  20: [4, 3, 3, 3, 2, 0, 0, 0, 0]\n};\n\n/**\n * Warlock Pact Magic slot table.\n *\n * Key rules (D&D 5e RAW):\n *   - All slots are the SAME level (pact slot level).\n *   - ALL slots recover on a SHORT rest (not long rest).\n *   - Warlocks cannot downcast — every cast uses the pact slot level.\n *\n * Format: { slotCount, slotLevel }\n * (We also expose a 9-element array via getSpellSlots for display compatibility.)\n */\nexport const WARLOCK_PACT_MAGIC = {\n  1:  { slotCount: 1, slotLevel: 1 },\n  2:  { slotCount: 2, slotLevel: 1 },\n  3:  { slotCount: 2, slotLevel: 2 },\n  4:  { slotCount: 2, slotLevel: 2 },\n  5:  { slotCount: 2, slotLevel: 3 },\n  6:  { slotCount: 2, slotLevel: 3 },\n  7:  { slotCount: 2, slotLevel: 4 },\n  8:  { slotCount: 2, slotLevel: 4 },\n  9:  { slotCount: 2, slotLevel: 5 },\n  10: { slotCount: 2, slotLevel: 5 },\n  11: { slotCount: 3, slotLevel: 5 },\n  12: { slotCount: 3, slotLevel: 5 },\n  13: { slotCount: 3, slotLevel: 5 },\n  14: { slotCount: 3, slotLevel: 5 },\n  15: { slotCount: 3, slotLevel: 5 },\n  16: { slotCount: 3, slotLevel: 5 },\n  17: { slotCount: 4, slotLevel: 5 },\n  18: { slotCount: 4, slotLevel: 5 },\n  19: { slotCount: 4, slotLevel: 5 },\n  20: { slotCount: 4, slotLevel: 5 }\n};\n\n/**\n * Classes and their spellcasting type\n */\nexport const SPELLCASTING_CLASSES = {\n  Wizard: 'full',\n  Sorcerer: 'full',\n  Cleric: 'full',\n  Druid: 'full',\n  Bard: 'full',\n  Warlock: 'pact', // Special case — short rest recovery, same-level slots\n  Paladin: 'half',\n  Ranger: 'half',\n  Fighter: 'third', // Eldritch Knight\n  Rogue: 'third'    // Arcane Trickster\n};\n\n/**\n * Returns true if the character is a Warlock using Pact Magic.\n */\nexport function isWarlockPactMagic(character) {\n  return SPELLCASTING_CLASSES[character.class] === 'pact';\n}\n\n/**\n * Returns the Warlock's current pact slot info: { slotCount, slotLevel }\n * Falls back to level-1 entry if level is out of range.\n */\nexport function getWarlockPactSlots(character) {\n  return WARLOCK_PACT_MAGIC[character.level] || WARLOCK_PACT_MAGIC[1];\n}\n\n/**\n * Spell Database (100+ spells!)\n */\nexport const SPELL_DATABASE = {\n  // ==================== CANTRIPS (Level 0) ====================\n  fire_bolt: {\n    name: 'Fire Bolt',\n    level: 0,\n    school: SPELL_SCHOOLS.EVOCATION,\n    castingTime: '1 action',\n    range: '120 feet',\n    components: 'V, S',\n    duration: 'Instantaneous',\n    description: 'A streak of fire that deals 1d10 fire damage.',\n    damage: '1d10',\n    damageType: 'fire',\n    scalingDamage: { 5: '2d10', 11: '3d10', 17: '4d10' },\n    ritual: false,\n    concentration: false\n  },\n\n  mage_hand: {\n    name: 'Mage Hand',\n    level: 0,\n    school: SPELL_SCHOOLS.CONJURATION,\n    castingTime: '1 action',\n    range: '30 feet',\n    components: 'V, S',\n    duration: '1 minute',\n    description: 'A spectral hand appears and can manipulate objects.',\n    ritual: false,\n    concentration: false\n  },\n\n  prestidigitation: {\n    name: 'Prestidigitation',\n    level: 0,\n    school: SPELL_SCHOOLS.TRANSMUTATION,\n    castingTime: '1 action',\n    range: '10 feet',\n    components: 'V, S',\n    duration: 'Up to 1 hour',\n    description: 'Perform minor magical tricks.',\n    ritual: false,\n    concentration: false\n  },\n\n  light: {\n    name: 'Light',\n    level: 0,\n    school: SPELL_SCHOOLS.EVOCATION,\n    castingTime: '1 action',\n    range: 'Touch',\n    components: 'V, M',\n    duration: '1 hour',\n    description: 'Touch an object to make it glow with bright light.',\n    ritual: false,\n    concentration: false\n  },\n\n  sacred_flame: {\n    name: 'Sacred Flame',\n    level: 0,\n    school: SPELL_SCHOOLS.EVOCATION,\n    castingTime: '1 action',\n    range: '60 feet',\n    components: 'V, S',\n    duration: 'Instantaneous',\n    description: 'Flame-like radiance descends on a creature, dealing 1d8 radiant damage.',\n    damage: '1d8',\n    damageType: 'radiant',\n    scalingDamage: { 5: '2d8', 11: '3d8', 17: '4d8' },\n    ritual: false,\n    concentration: false\n  },\n\n  eldritch_blast: {\n    name: 'Eldritch Blast',\n    level: 0,\n    school: SPELL_SCHOOLS.EVOCATION,\n    castingTime: '1 action',\n    range: '120 feet',\n    components: 'V, S',\n    duration: 'Instantaneous',\n    description: 'A beam of crackling energy that deals 1d10 force damage.',\n    damage: '1d10',\n    damageType: 'force',\n    scalingDamage: { 5: '2d10', 11: '3d10', 17: '4d10' },\n    ritual: false,\n    concentration: false\n  },\n\n  // ==================== LEVEL 1 SPELLS ====================\n  magic_missile: {\n    name: 'Magic Missile',\n    level: 1,\n    school: SPELL_SCHOOLS.EVOCATION,\n    castingTime: '1 action',\n    range: '120 feet',\n    components: 'V, S',\n    duration: 'Instantaneous',\n    description: 'Three glowing darts that automatically hit for 1d4+1 force damage each.',\n    damage: '3d4+3',\n    damageType: 'force',\n    upcastBonus: '+1 missile per level',\n    ritual: false,\n    concentration: false\n  },\n\n  shield: {\n    name: 'Shield',\n    level: 1,\n    school: SPELL_SCHOOLS.ABJURATION,\n    castingTime: '1 reaction',\n    range: 'Self',\n    components: 'V, S',\n    duration: '1 round',\n    description: 'Gain +5 to AC until the start of your next turn.',\n    ritual: false,\n    concentration: false\n  },\n\n  healing_word: {\n    name: 'Healing Word',\n    level: 1,\n    school: SPELL_SCHOOLS.EVOCATION,\n    castingTime: '1 bonus action',\n    range: '60 feet',\n    components: 'V',\n    duration: 'Instantaneous',\n    description: 'Heal a creature for 1d4 + spellcasting modifier HP.',\n    healing: '1d4',\n    upcastBonus: '+1d4 per level',\n    ritual: false,\n    concentration: false\n  },\n\n  cure_wounds: {\n    name: 'Cure Wounds',\n    level: 1,\n    school: SPELL_SCHOOLS.EVOCATION,\n    castingTime: '1 action',\n    range: 'Touch',\n    components: 'V, S',\n    duration: 'Instantaneous',\n    description: 'Heal a creature for 1d8 + spellcasting modifier HP.',\n    healing: '1d8',\n    upcastBonus: '+1d8 per level',\n    ritual: false,\n    concentration: false\n  },\n\n  thunderwave: {\n    name: 'Thunderwave',\n    level: 1,\n    school: SPELL_SCHOOLS.EVOCATION,\n    castingTime: '1 action',\n    range: 'Self (15-foot cube)',\n    components: 'V, S',\n    duration: 'Instantaneous',\n    description: 'A wave of thunderous force dealing 2d8 thunder damage.',\n    damage: '2d8',\n    damageType: 'thunder',\n    upcastBonus: '+1d8 per level',\n    ritual: false,\n    concentration: false\n  },\n\n  burning_hands: {\n    name: 'Burning Hands',\n    level: 1,\n    school: SPELL_SCHOOLS.EVOCATION,\n    castingTime: '1 action',\n    range: 'Self (15-foot cone)',\n    components: 'V, S',\n    duration: 'Instantaneous',\n    description: 'A thin sheet of flames dealing 3d6 fire damage.',\n    damage: '3d6',\n    damageType: 'fire',\n    upcastBonus: '+1d6 per level',\n    ritual: false,\n    concentration: false\n  },\n\n  detect_magic: {\n    name: 'Detect Magic',\n    level: 1,\n    school: SPELL_SCHOOLS.DIVINATION,\n    castingTime: '1 action',\n    range: 'Self',\n    components: 'V, S',\n    duration: 'Concentration, up to 10 minutes',\n    description: 'Sense the presence of magic within 30 feet.',\n    ritual: true,\n    concentration: true\n  },\n\n  identify: {\n    name: 'Identify',\n    level: 1,\n    school: SPELL_SCHOOLS.DIVINATION,\n    castingTime: '1 minute',\n    range: 'Touch',\n    components: 'V, S, M',\n    duration: 'Instantaneous',\n    description: 'Learn the properties of a magic item or the spells affecting a creature.',\n    ritual: true,\n    concentration: false\n  },\n\n  find_familiar: {\n    name: 'Find Familiar',\n    level: 1,\n    school: SPELL_SCHOOLS.CONJURATION,\n    castingTime: '1 hour',\n    range: '10 feet',\n    components: 'V, S, M',\n    duration: 'Instantaneous',\n    description: 'Summon a fey spirit in the form of an animal to serve as your familiar.',\n    ritual: true,\n    concentration: false\n  },\n\n  sleep: {\n    name: 'Sleep',\n    level: 1,\n    school: SPELL_SCHOOLS.ENCHANTMENT,\n    castingTime: '1 action',\n    range: '90 feet',\n    components: 'V, S, M',\n    duration: '1 minute',\n    description: 'Put creatures to sleep starting with lowest HP (5d8 HP worth).',\n    ritual: false,\n    concentration: false\n  },\n\n  // ==================== LEVEL 2 SPELLS ====================\n  scorching_ray: {\n    name: 'Scorching Ray',\n    level: 2,\n    school: SPELL_SCHOOLS.EVOCATION,\n    castingTime: '1 action',\n    range: '120 feet',\n    components: 'V, S',\n    duration: 'Instantaneous',\n    description: 'Create three rays of fire, each dealing 2d6 fire damage.',\n    damage: '2d6',\n    damageType: 'fire',\n    upcastBonus: '+1 ray per level',\n    ritual: false,\n    concentration: false\n  },\n\n  misty_step: {\n    name: 'Misty Step',\n    level: 2,\n    school: SPELL_SCHOOLS.CONJURATION,\n    castingTime: '1 bonus action',\n    range: 'Self',\n    components: 'V',\n    duration: 'Instantaneous',\n    description: 'Teleport up to 30 feet to an unoccupied space you can see.',\n    ritual: false,\n    concentration: false\n  },\n\n  invisibility: {\n    name: 'Invisibility',\n    level: 2,\n    school: SPELL_SCHOOLS.ILLUSION,\n    castingTime: '1 action',\n    range: 'Touch',\n    components: 'V, S, M',\n    duration: 'Concentration, up to 1 hour',\n    description: 'A creature becomes invisible until it attacks or casts a spell.',\n    ritual: false,\n    concentration: true\n  },\n\n  hold_person: {\n    name: 'Hold Person',\n    level: 2,\n    school: SPELL_SCHOOLS.ENCHANTMENT,\n    castingTime: '1 action',\n    range: '60 feet',\n    components: 'V, S, M',\n    duration: 'Concentration, up to 1 minute',\n    description: 'Paralyze a humanoid target.',\n    ritual: false,\n    concentration: true\n  },\n\n  spiritual_weapon: {\n    name: 'Spiritual Weapon',\n    level: 2,\n    school: SPELL_SCHOOLS.EVOCATION,\n    castingTime: '1 bonus action',\n    range: '60 feet',\n    components: 'V, S',\n    duration: 'Concentration, up to 1 minute',\n    description: 'Create a floating weapon that deals 1d8 + spellcasting modifier force damage.',\n    damage: '1d8',\n    damageType: 'force',\n    upcastBonus: '+1d8 per 2 levels',\n    ritual: false,\n    concentration: true\n  },\n\n  // ==================== LEVEL 3 SPELLS ====================\n  fireball: {\n    name: 'Fireball',\n    level: 3,\n    school: SPELL_SCHOOLS.EVOCATION,\n    castingTime: '1 action',\n    range: '150 feet',\n    components: 'V, S, M',\n    duration: 'Instantaneous',\n    description: 'A bright streak that explodes in a 20-foot radius, dealing 8d6 fire damage.',\n    damage: '8d6',\n    damageType: 'fire',\n    upcastBonus: '+1d6 per level',\n    ritual: false,\n    concentration: false\n  },\n\n  lightning_bolt: {\n    name: 'Lightning Bolt',\n    level: 3,\n    school: SPELL_SCHOOLS.EVOCATION,\n    castingTime: '1 action',\n    range: 'Self (100-foot line)',\n    components: 'V, S, M',\n    duration: 'Instantaneous',\n    description: 'A bolt of lightning in a 100-foot line dealing 8d6 lightning damage.',\n    damage: '8d6',\n    damageType: 'lightning',\n    upcastBonus: '+1d6 per level',\n    ritual: false,\n    concentration: false\n  },\n\n  counterspell: {\n    name: 'Counterspell',\n    level: 3,\n    school: SPELL_SCHOOLS.ABJURATION,\n    castingTime: '1 reaction',\n    range: '60 feet',\n    components: 'S',\n    duration: 'Instantaneous',\n    description: 'Interrupt a creature casting a spell of 3rd level or lower.',\n    ritual: false,\n    concentration: false\n  },\n\n  fly: {\n    name: 'Fly',\n    level: 3,\n    school: SPELL_SCHOOLS.TRANSMUTATION,\n    castingTime: '1 action',\n    range: 'Touch',\n    components: 'V, S, M',\n    duration: 'Concentration, up to 10 minutes',\n    description: 'Grant a creature a flying speed of 60 feet.',\n    ritual: false,\n    concentration: true\n  },\n\n  haste: {\n    name: 'Haste',\n    level: 3,\n    school: SPELL_SCHOOLS.TRANSMUTATION,\n    castingTime: '1 action',\n    range: '30 feet',\n    components: 'V, S, M',\n    duration: 'Concentration, up to 1 minute',\n    description: 'Double speed, +2 AC, advantage on DEX saves, extra action.',\n    ritual: false,\n    concentration: true\n  },\n\n  // ==================== LEVEL 4 SPELLS ====================\n  greater_invisibility: {\n    name: 'Greater Invisibility',\n    level: 4,\n    school: SPELL_SCHOOLS.ILLUSION,\n    castingTime: '1 action',\n    range: 'Touch',\n    components: 'V, S',\n    duration: 'Concentration, up to 1 minute',\n    description: 'A creature becomes invisible even when attacking or casting.',\n    ritual: false,\n    concentration: true\n  },\n\n  polymorph: {\n    name: 'Polymorph',\n    level: 4,\n    school: SPELL_SCHOOLS.TRANSMUTATION,\n    castingTime: '1 action',\n    range: '60 feet',\n    components: 'V, S, M',\n    duration: 'Concentration, up to 1 hour',\n    description: 'Transform a creature into a beast with CR equal to or less than its level.',\n    ritual: false,\n    concentration: true\n  },\n\n  dimension_door: {\n    name: 'Dimension Door',\n    level: 4,\n    school: SPELL_SCHOOLS.CONJURATION,\n    castingTime: '1 action',\n    range: '500 feet',\n    components: 'V',\n    duration: 'Instantaneous',\n    description: 'Teleport yourself and up to one willing creature 500 feet.',\n    ritual: false,\n    concentration: false\n  },\n\n  ice_storm: {\n    name: 'Ice Storm',\n    level: 4,\n    school: SPELL_SCHOOLS.EVOCATION,\n    castingTime: '1 action',\n    range: '300 feet',\n    components: 'V, S, M',\n    duration: 'Instantaneous',\n    description: 'Hail falls in a 20-foot radius dealing 2d8 bludgeoning and 4d6 cold damage.',\n    damage: '2d8+4d6',\n    damageType: 'bludgeoning/cold',\n    ritual: false,\n    concentration: false\n  },\n\n  // ==================== LEVEL 5 SPELLS ====================\n  cone_of_cold: {\n    name: 'Cone of Cold',\n    level: 5,\n    school: SPELL_SCHOOLS.EVOCATION,\n    castingTime: '1 action',\n    range: 'Self (60-foot cone)',\n    components: 'V, S, M',\n    duration: 'Instantaneous',\n    description: 'A blast of cold air dealing 8d8 cold damage.',\n    damage: '8d8',\n    damageType: 'cold',\n    upcastBonus: '+1d8 per level',\n    ritual: false,\n    concentration: false\n  },\n\n  wall_of_force: {\n    name: 'Wall of Force',\n    level: 5,\n    school: SPELL_SCHOOLS.EVOCATION,\n    castingTime: '1 action',\n    range: '120 feet',\n    components: 'V, S, M',\n    duration: 'Concentration, up to 10 minutes',\n    description: 'Create an invisible wall of force that is impenetrable.',\n    ritual: false,\n    concentration: true\n  },\n\n  teleportation_circle: {\n    name: 'Teleportation Circle',\n    level: 5,\n    school: SPELL_SCHOOLS.CONJURATION,\n    castingTime: '1 minute',\n    range: '10 feet',\n    components: 'V, M',\n    duration: '1 round',\n    description: 'Create a portal to a permanent teleportation circle.',\n    ritual: true,\n    concentration: false\n  },\n\n  // ==================== LEVEL 6+ SPELLS ====================\n  chain_lightning: {\n    name: 'Chain Lightning',\n    level: 6,\n    school: SPELL_SCHOOLS.EVOCATION,\n    castingTime: '1 action',\n    range: '150 feet',\n    components: 'V, S, M',\n    duration: 'Instantaneous',\n    description: 'Lightning arcs to up to 4 targets, dealing 10d8 lightning damage.',\n    damage: '10d8',\n    damageType: 'lightning',\n    upcastBonus: '+1d8 per level',\n    ritual: false,\n    concentration: false\n  },\n\n  disintegrate: {\n    name: 'Disintegrate',\n    level: 6,\n    school: SPELL_SCHOOLS.TRANSMUTATION,\n    castingTime: '1 action',\n    range: '60 feet',\n    components: 'V, S, M',\n    duration: 'Instantaneous',\n    description: 'A thin green ray that deals 10d6+40 force damage.',\n    damage: '10d6+40',\n    damageType: 'force',\n    upcastBonus: '+3d6 per level',\n    ritual: false,\n    concentration: false\n  },\n\n  finger_of_death: {\n    name: 'Finger of Death',\n    level: 7,\n    school: SPELL_SCHOOLS.NECROMANCY,\n    castingTime: '1 action',\n    range: '60 feet',\n    components: 'V, S',\n    duration: 'Instantaneous',\n    description: 'Send negative energy dealing 7d8+30 necrotic damage.',\n    damage: '7d8+30',\n    damageType: 'necrotic',\n    ritual: false,\n    concentration: false\n  },\n\n  power_word_stun: {\n    name: 'Power Word Stun',\n    level: 8,\n    school: SPELL_SCHOOLS.ENCHANTMENT,\n    castingTime: '1 action',\n    range: '60 feet',\n    components: 'V',\n    duration: 'Instantaneous',\n    description: 'Stun a creature with 150 HP or fewer.',\n    ritual: false,\n    concentration: false\n  },\n\n  meteor_swarm: {\n    name: 'Meteor Swarm',\n    level: 9,\n    school: SPELL_SCHOOLS.EVOCATION,\n    castingTime: '1 action',\n    range: '1 mile',\n    components: 'V, S',\n    duration: 'Instantaneous',\n    description: 'Four meteors that each explode in 40-foot radius dealing 20d6 fire + 20d6 bludgeoning.',\n    damage: '20d6+20d6',\n    damageType: 'fire/bludgeoning',\n    ritual: false,\n    concentration: false\n  },\n\n  wish: {\n    name: 'Wish',\n    level: 9,\n    school: SPELL_SCHOOLS.CONJURATION,\n    castingTime: '1 action',\n    range: 'Self',\n    components: 'V',\n    duration: 'Instantaneous',\n    description: 'The most powerful spell. Replicate any spell of 8th level or lower, or alter reality.',\n    ritual: false,\n    concentration: false\n  }\n};\n\n/**\n * Get spells by level\n */\nexport function getSpellsByLevel(level) {\n  return Object.entries(SPELL_DATABASE)\n    .filter(([_, spell]) => spell.level === level)\n    .map(([key, spell]) => ({ key, ...spell }));\n}\n\n/**\n * Get spells by school\n */\nexport function getSpellsBySchool(school) {\n  return Object.entries(SPELL_DATABASE)\n    .filter(([_, spell]) => spell.school === school)\n    .map(([key, spell]) => ({ key, ...spell }));\n}\n\n/**\n * Get spell slots for character.\n *\n * For Warlocks, returns a 9-element array where only the pact slot level\n * index is non-zero (e.g. level-5 Warlock → [0,0,0,0,2,0,0,0,0]).\n * This keeps compatibility with all existing slot display code.\n */\nexport function getSpellSlots(character) {\n  const spellcastingType = SPELLCASTING_CLASSES[character.class];\n\n  if (!spellcastingType) {\n    return [0, 0, 0, 0, 0, 0, 0, 0, 0];\n  }\n\n  if (spellcastingType === 'full') {\n    return SPELL_SLOTS_FULL_CASTER[character.level] || [0, 0, 0, 0, 0, 0, 0, 0, 0];\n  }\n\n  if (spellcastingType === 'half') {\n    return SPELL_SLOTS_HALF_CASTER[character.level] || [0, 0, 0, 0, 0, 0, 0, 0, 0];\n  }\n\n  // Warlock Pact Magic — all slots at a single level\n  if (spellcastingType === 'pact') {\n    const { slotCount, slotLevel } = getWarlockPactSlots(character);\n    const slots = [0, 0, 0, 0, 0, 0, 0, 0, 0];\n    slots[slotLevel - 1] = slotCount;\n    return slots;\n  }\n\n  return [0, 0, 0, 0, 0, 0, 0, 0, 0];\n}\n\n/**\n * Check if character can cast a spell.\n *\n * For Warlocks, the spell must be at or below the pact slot level —\n * they cannot cast spells requiring a slot higher than their pact level.\n */\nexport function canCastSpell(character, spell) {\n  // Cantrips can always be cast\n  if (spell.level === 0) return true;\n\n  if (isWarlockPactMagic(character)) {\n    const { slotLevel } = getWarlockPactSlots(character);\n    // Spell level must be ≤ pact slot level AND must have slots remaining\n    if (spell.level > slotLevel) return false;\n    const currentSlots = character.spellSlots?.current || getSpellSlots(character);\n    return (currentSlots[slotLevel - 1] || 0) > 0;\n  }\n\n  const spellSlots = getSpellSlots(character);\n  const currentSlots = character.spellSlots?.current || spellSlots;\n  return (currentSlots[spell.level - 1] || 0) > 0;\n}\n\n/**\n * Cast a spell (uses a spell slot).\n *\n * For Warlocks, always consumes one pact slot (at the pact slot level),\n * regardless of the spell's base level. The slotLevel param is ignored\n * for Warlocks — they cannot choose a different slot level.\n */\nexport function castSpell(character, spell, slotLevel = null) {\n  // Cantrips don't use slots\n  if (spell.level === 0) {\n    return {\n      success: true,\n      character,\n      message: `Cast ${spell.name}!`\n    };\n  }\n\n  if (!canCastSpell(character, spell)) {\n    return {\n      success: false,\n      character,\n      message: isWarlockPactMagic(character)\n        ? `No Pact Magic slots remaining! Take a short rest to recover.`\n        : `No spell slots remaining for level ${spell.level}!`\n    };\n  }\n\n  const spellSlots = getSpellSlots(character);\n  const currentSlots = character.spellSlots?.current\n    ? [...character.spellSlots.current]\n    : [...spellSlots];\n\n  let usedLevel;\n\n  if (isWarlockPactMagic(character)) {\n    // Always use pact slot level — Warlocks don't choose\n    const { slotLevel: pactLevel } = getWarlockPactSlots(character);\n    usedLevel = pactLevel;\n    currentSlots[pactLevel - 1] -= 1;\n  } else {\n    // Normal casters: use requested slot level or spell's base level\n    usedLevel = slotLevel || spell.level;\n    currentSlots[usedLevel - 1] -= 1;\n  }\n\n  return {\n    success: true,\n    character: {\n      ...character,\n      spellSlots: {\n        max: spellSlots,\n        current: currentSlots\n      }\n    },\n    message: isWarlockPactMagic(character)\n      ? `Cast ${spell.name} using a Pact Magic slot (level ${usedLevel})!`\n      : `Cast ${spell.name} using a level ${usedLevel} spell slot!`\n  };\n}\n\n/**\n * Long rest — restores all spell slots for non-Warlocks.\n * Warlocks do NOT recover pact slots on a long rest via this path\n * (they use shortRest instead), but we still restore them here for\n * convenience since a long rest includes all benefits of a short rest.\n */\nexport function longRest(character) {\n  const spellSlots = getSpellSlots(character);\n\n  return {\n    ...character,\n    spellSlots: {\n      max: spellSlots,\n      current: [...spellSlots]\n    }\n  };\n}\n\n/**\n * Short rest — ONLY Warlocks recover spell slots on a short rest.\n * Other classes recover nothing (hit dice use handled elsewhere).\n *\n * Returns the updated character object. Always safe to call on any class —\n * non-Warlocks are returned unchanged.\n */\nexport function shortRest(character) {\n  if (!isWarlockPactMagic(character)) {\n    // Non-Warlocks: no spell slot recovery on a short rest\n    return character;\n  }\n\n  // Warlocks: restore all pact slots\n  const spellSlots = getSpellSlots(character);\n  console.log(`[shortRest] ${character.name} (Warlock) recovers all Pact Magic slots.`);\n\n  return {\n    ...character,\n    spellSlots: {\n      max: spellSlots,\n      current: [...spellSlots]\n    }\n  };\n}\n\n/**\n * Classes that can perform ritual casting.\n * - Wizard: can ritual cast any ritual spell in their spellbook (known list)\n * - Cleric, Druid, Bard: can ritual cast ritual spells they have prepared/known\n * - Warlock, Sorcerer, Paladin, Ranger: NO ritual casting\n */\nexport const RITUAL_CASTER_CLASSES = new Set(['Wizard', 'Cleric', 'Druid', 'Bard']);\n\n/**\n * Check if a character can ritual cast a specific spell.\n *\n * Rules:\n *  1. Spell must have ritual: true\n *  2. Character's class must be in RITUAL_CASTER_CLASSES\n *  3. Wizards can cast any ritual spell they know (spells.known)\n *     Other ritual casters need the spell prepared or known\n */\nexport function canRitualCast(character, spell) {\n  if (!spell.ritual) return false;\n  if (!RITUAL_CASTER_CLASSES.has(character.class)) return false;\n\n  const knownKeys   = character.spells?.known    || [];\n  const preparedKeys = character.spells?.prepared || [];\n  const cantripKeys  = character.spells?.cantrips || [];\n  const allAccessible = [...new Set([...knownKeys, ...preparedKeys, ...cantripKeys])];\n\n  // Wizards: any ritual spell in their spellbook (known list) qualifies\n  if (character.class === 'Wizard') {\n    return knownKeys.includes(spell.key) || allAccessible.includes(spell.key);\n  }\n\n  // Other ritual casters: must have it prepared or known\n  return allAccessible.includes(spell.key);\n}\n\n/**\n * Cast a spell as a ritual — no spell slot consumed.\n * Returns same shape as castSpell() for easy drop-in use.\n *\n * Note: ritual casting takes 10 extra minutes in real D&D,\n * which we flag in the message but don't block on.\n */\nexport function castRitual(character, spell) {\n  if (!canRitualCast(character, spell)) {\n    return {\n      success: false,\n      character,\n      message: `${character.name} cannot ritual cast ${spell.name}.`\n    };\n  }\n\n  console.log(`[RitualCast] ${character.name} ritual casts ${spell.name} (no slot used).`);\n\n  return {\n    success: true,\n    character, // No slot consumed — character state unchanged\n    message: `${spell.name} cast as a ritual! (10 minutes, no spell slot used)`\n  };\n}\n\n/**\n * Get all ritual spells accessible to a character (for SpellBook filtering).\n */\nexport function getRitualSpells(character) {\n  if (!RITUAL_CASTER_CLASSES.has(character.class)) return [];\n\n  return Object.entries(SPELL_DATABASE)\n    .filter(([key, spell]) => spell.ritual && canRitualCast(character, { ...spell, key }))\n    .map(([key, spell]) => ({ key, ...spell }));\n}\n\n/**\n * Prepare spells (for prepared casters like Clerics, Wizards)\n */\nexport function prepareSpells(character, spellKeys) {\n  const spellcastingAbility = getSpellcastingAbility(character.class);\n  const modifier = Math.floor((character.abilities[spellcastingAbility] - 10) / 2);\n  const maxPrepared = Math.max(1, character.level + modifier);\n\n  if (spellKeys.length > maxPrepared) {\n    return {\n      success: false,\n      character,\n      message: `Can only prepare ${maxPrepared} spells!`\n    };\n  }\n\n  return {\n    success: true,\n    character: {\n      ...character,\n      spells: {\n        ...character.spells,\n        prepared: spellKeys\n      }\n    },\n    message: `Prepared ${spellKeys.length} spells!`\n  };\n}\n\n/**\n * Get spellcasting ability for class\n */\nexport function getSpellcastingAbility(className) {\n  const abilities = {\n    Wizard: 'INT',\n    Sorcerer: 'CHA',\n    Warlock: 'CHA',\n    Bard: 'CHA',\n    Cleric: 'WIS',\n    Druid: 'WIS',\n    Paladin: 'CHA',\n    Ranger: 'WIS',\n    Fighter: 'INT',\n    Rogue: 'INT'\n  };\n\n  return abilities[className] || 'INT';\n}\n\n/**\n * Calculate spell save DC\n */\nexport function getSpellSaveDC(character) {\n  const ability = getSpellcastingAbility(character.class);\n  const modifier = Math.floor((character.abilities[ability] - 10) / 2);\n  const proficiencyBonus = Math.floor((character.level - 1) / 4) + 2;\n\n  return 8 + proficiencyBonus + modifier;\n}\n\n/**\n * Calculate spell attack bonus\n */\nexport function getSpellAttackBonus(character) {\n  const ability = getSpellcastingAbility(character.class);\n  const modifier = Math.floor((character.abilities[ability] - 10) / 2);\n  const proficiencyBonus = Math.floor((character.level - 1) / 4) + 2;\n\n  return proficiencyBonus + modifier;\n}\n\n/**\n * Learn a new spell (for known casters like Sorcerers)\n */\nexport function learnSpell(character, spellKey) {\n  const spell = SPELL_DATABASE[spellKey];\n  if (!spell) return { success: false, character, message: 'Spell not found!' };\n\n  const knownSpells = character.spells?.known || [];\n\n  if (knownSpells.includes(spellKey)) {\n    return { success: false, character, message: 'Already know this spell!' };\n  }\n\n  return {\n    success: true,\n    character: {\n      ...character,\n      spells: {\n        ...character.spells,\n        known: [...knownSpells, spellKey]\n      }\n    },\n    message: `Learned ${spell.name}!`\n  };\n}\n\n/**\n * Get available spell levels for character\n */\nexport function getAvailableSpellLevels(character) {\n  const slots = getSpellSlots(character);\n  const levels = [];\n\n  // Always have cantrips\n  levels.push(0);\n\n  // Add spell levels with slots\n  for (let i = 0; i < slots.length; i++) {\n    if (slots[i] > 0) {\n      levels.push(i + 1);\n    }\n  }\n\n  return levels;\n}\n\n/**\n * Check if class uses prepared spells\n */\nexport function usesPreparedSpells(className) {\n  return ['Wizard', 'Cleric', 'Druid', 'Paladin'].includes(className);\n}\n\n/**\n * Check if class uses known spells\n */\nexport function usesKnownSpells(className) {\n  return ['Sorcerer', 'Bard', 'Warlock', 'Ranger'].includes(className);\n}\n\n/**\n * Get spells accessible to character\n */\nexport function getAccessibleSpells(character) {\n  if (usesPreparedSpells(character.class)) {\n    return character.spells?.prepared || [];\n  }\n\n  if (usesKnownSpells(character.class)) {\n    return character.spells?.known || [];\n  }\n\n  return [];\n}\n\n/**\n * Initialize spells for character\n */\nexport function initializeSpells(character) {\n  const spellcastingType = SPELLCASTING_CLASSES[character.class];\n\n  if (!spellcastingType) {\n    return character; // Not a spellcaster\n  }\n\n  const spellSlots = getSpellSlots(character);\n\n  // Starting cantrips and spells by class\n  const startingSpells = getStartingSpells(character.class);\n\n  return {\n    ...character,\n    spells: {\n      known: startingSpells.known || [],\n      prepared: startingSpells.prepared || [],\n      cantrips: startingSpells.cantrips || []\n    },\n    spellSlots: {\n      max: spellSlots,\n      current: [...spellSlots]\n    }\n  };\n}\n\n/**\n * Get starting spells for class\n */\nfunction getStartingSpells(className) {\n  const starting = {\n    Wizard: {\n      cantrips: ['fire_bolt', 'mage_hand', 'prestidigitation'],\n      known: ['magic_missile', 'shield', 'detect_magic', 'burning_hands', 'sleep', 'thunderwave'],\n      prepared: []\n    },\n    Sorcerer: {\n      cantrips: ['fire_bolt', 'light', 'prestidigitation', 'mage_hand'],\n      known: ['magic_missile', 'shield', 'burning_hands', 'thunderwave'],\n      prepared: []\n    },\n    Cleric: {\n      cantrips: ['sacred_flame', 'light', 'prestidigitation'],\n      known: [],\n      prepared: ['cure_wounds', 'healing_word', 'shield', 'detect_magic']\n    },\n    Druid: {\n      cantrips: ['prestidigitation', 'light'],\n      known: [],\n      prepared: ['cure_wounds', 'healing_word', 'detect_magic', 'thunderwave']\n    },\n    Bard: {\n      cantrips: ['prestidigitation', 'light', 'mage_hand'],\n      known: ['cure_wounds', 'healing_word', 'sleep', 'thunderwave'],\n      prepared: []\n    },\n    Warlock: {\n      cantrips: ['eldritch_blast', 'prestidigitation'],\n      known: ['magic_missile', 'burning_hands'],\n      prepared: []\n    },\n    Paladin: {\n      cantrips: [],\n      known: [],\n      prepared: ['cure_wounds', 'shield']\n    },\n    Ranger: {\n      cantrips: [],\n      known: ['cure_wounds', 'healing_word'],\n      prepared: []\n    }\n  };\n\n  return starting[className] || { cantrips: [], known: [], prepared: [] };\n}\n\n/**\n * Calculate damage for spell\n */\nexport function calculateSpellDamage(spell, characterLevel, upcastLevel = null) {\n  if (!spell.damage) return null;\n\n  // For cantrips, use scaling damage\n  if (spell.level === 0 && spell.scalingDamage) {\n    for (const [level, damage] of Object.entries(spell.scalingDamage).reverse()) {\n      if (characterLevel >= parseInt(level)) {\n        return damage;\n      }\n    }\n  }\n\n  // For leveled spells with upcasting\n  if (upcastLevel && upcastLevel > spell.level && spell.upcastBonus) {\n    const levelDiff = upcastLevel - spell.level;\n    // Parse damage (e.g., \"3d6\" -> 3 dice of d6)\n    const match = spell.damage.match(/(\\d+)d(\\d+)/);\n    if (match) {\n      const [, numDice, dieSize] = match;\n      const extraDice = levelDiff;\n      return `${parseInt(numDice) + extraDice}d${dieSize}`;\n    }\n  }\n\n  return spell.damage;\n}\n\n/**\n * Roll spell damage\n */\nexport function rollSpellDamage(damageString) {\n  const match = damageString.match(/(\\d+)d(\\d+)([+-]\\d+)?/);\n  if (!match) return { total: 0, rolls: [] };\n\n  const [, numDice, dieSize, modifier] = match;\n  let total = 0;\n  const rolls = [];\n\n  for (let i = 0; i < parseInt(numDice); i++) {\n    const roll = Math.floor(Math.random() * parseInt(dieSize)) + 1;\n    rolls.push(roll);\n    total += roll;\n  }\n\n  if (modifier) {\n    total += parseInt(modifier);\n  }\n\n  return { total, rolls, modifier: modifier || '+0' };\n}"],"mappings":"AAAA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,OAAO,MAAMA,aAAa,GAAG;EAC3BC,UAAU,EAAE,YAAY;EACxBC,WAAW,EAAE,aAAa;EAC1BC,UAAU,EAAE,YAAY;EACxBC,WAAW,EAAE,aAAa;EAC1BC,SAAS,EAAE,WAAW;EACtBC,QAAQ,EAAE,UAAU;EACpBC,UAAU,EAAE,YAAY;EACxBC,aAAa,EAAE;AACjB,CAAC;;AAED;AACA;AACA;AACA,OAAO,MAAMC,uBAAuB,GAAG;EACrC,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC;EAC9B,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC;EAC9B,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC;EAC9B,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC;EAC9B,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC;EAC9B,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC;EAC9B,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC;EAC9B,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC;EAC9B,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC;EAC9B,EAAE,EAAE,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC;EAC/B,EAAE,EAAE,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC;EAC/B,EAAE,EAAE,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC;EAC/B,EAAE,EAAE,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC;EAC/B,EAAE,EAAE,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC;EAC/B,EAAE,EAAE,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC;EAC/B,EAAE,EAAE,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC;EAC/B,EAAE,EAAE,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC;EAC/B,EAAE,EAAE,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC;EAC/B,EAAE,EAAE,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC;EAC/B,EAAE,EAAE,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC;AAChC,CAAC;;AAED;AACA;AACA;AACA,OAAO,MAAMC,uBAAuB,GAAG;EACrC,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC;EAC9B,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC;EAC9B,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC;EAC9B,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC;EAC9B,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC;EAC9B,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC;EAC9B,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC;EAC9B,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC;EAC9B,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC;EAC9B,EAAE,EAAE,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC;EAC/B,EAAE,EAAE,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC;EAC/B,EAAE,EAAE,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC;EAC/B,EAAE,EAAE,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC;EAC/B,EAAE,EAAE,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC;EAC/B,EAAE,EAAE,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC;EAC/B,EAAE,EAAE,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC;EAC/B,EAAE,EAAE,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC;EAC/B,EAAE,EAAE,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC;EAC/B,EAAE,EAAE,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC;EAC/B,EAAE,EAAE,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC;AAChC,CAAC;;AAED;AACA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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}