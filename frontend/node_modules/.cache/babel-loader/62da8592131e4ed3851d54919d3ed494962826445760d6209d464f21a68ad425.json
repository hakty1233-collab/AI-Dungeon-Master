{"ast":null,"code":"// frontend/src/state/campaignStore.js\nimport { create } from \"zustand\";\nexport const useCampaignStore = create(set => ({\n  campaign: null,\n  party: [],\n  lastResponse: \"\",\n  voiceMode: true,\n  micListening: false,\n  /* ============================\n     ðŸŽ² CAMPAIGN SETUP\n     ============================ */\n  setCampaign: campaign => {\n    var _campaign$history, _campaign$history2, _campaign$history2$sl;\n    return set({\n      campaign: {\n        ...campaign,\n        history: (_campaign$history = campaign.history) !== null && _campaign$history !== void 0 && _campaign$history.length ? campaign.history : [{\n          role: \"assistant\",\n          content: \"The air grows still as your adventure begins...\"\n        }],\n        combat: null\n      },\n      party: campaign.party || [],\n      lastResponse: ((_campaign$history2 = campaign.history) === null || _campaign$history2 === void 0 ? void 0 : (_campaign$history2$sl = _campaign$history2.slice(-1)[0]) === null || _campaign$history2$sl === void 0 ? void 0 : _campaign$history2$sl.content) || \"\"\n    });\n  },\n  updateFromDM: ({\n    aiResponse,\n    campaignState\n  }) => set(state => {\n    var _state$campaign;\n    return {\n      campaign: {\n        ...state.campaign,\n        ...campaignState,\n        history: [...(((_state$campaign = state.campaign) === null || _state$campaign === void 0 ? void 0 : _state$campaign.history) || []), {\n          role: \"assistant\",\n          content: aiResponse\n        }]\n      },\n      lastResponse: aiResponse,\n      party: campaignState.party || state.party\n    };\n  }),\n  /* ============================\n     ðŸŽ² DICE\n     ============================ */\n  addDiceRoll: roll => set(state => ({\n    campaign: {\n      ...state.campaign,\n      history: [...(state.campaign.history || []), {\n        role: \"system\",\n        content: `ðŸŽ² Rolled d${roll.sides}: ${roll.result}`\n      }]\n    }\n  })),\n  /* ============================\n     âš”ï¸ COMBAT\n     ============================ */\n  startCombat: ({\n    enemies\n  }) => set(state => {\n    const initiativeOrder = [...state.party.map(p => ({\n      id: p.id,\n      name: p.name,\n      type: \"player\",\n      hp: p.hp,\n      initiative: Math.floor(Math.random() * 20) + 1\n    })), ...enemies.map(e => ({\n      ...e,\n      type: \"enemy\",\n      initiative: Math.floor(Math.random() * 20) + 1\n    }))].sort((a, b) => b.initiative - a.initiative);\n    return {\n      campaign: {\n        ...state.campaign,\n        combat: {\n          active: true,\n          round: 1,\n          turnIndex: 0,\n          order: initiativeOrder,\n          enemies\n        },\n        history: [...state.campaign.history, {\n          role: \"system\",\n          content: \"âš”ï¸ Combat begins! Initiative is rolled.\"\n        }]\n      }\n    };\n  }),\n  nextTurn: () => set(state => {\n    const combat = state.campaign.combat;\n    if (!combat) return {};\n    let nextIndex = combat.turnIndex + 1;\n    let nextRound = combat.round;\n    if (nextIndex >= combat.order.length) {\n      nextIndex = 0;\n      nextRound++;\n    }\n    return {\n      campaign: {\n        ...state.campaign,\n        combat: {\n          ...combat,\n          turnIndex: nextIndex,\n          round: nextRound\n        }\n      }\n    };\n  }),\n  damageEnemy: (enemyId, dmg) => set(state => {\n    const combat = state.campaign.combat;\n    if (!combat) return {};\n    const enemies = combat.enemies.map(e => e.id === enemyId ? {\n      ...e,\n      hp: Math.max(0, e.hp - dmg),\n      alive: e.hp - dmg > 0\n    } : e);\n    return {\n      campaign: {\n        ...state.campaign,\n        combat: {\n          ...combat,\n          enemies\n        },\n        history: [...state.campaign.history, {\n          role: \"system\",\n          content: `ðŸ’¥ ${dmg} damage dealt!`\n        }]\n      }\n    };\n  }),\n  endCombat: () => set(state => ({\n    campaign: {\n      ...state.campaign,\n      combat: null,\n      history: [...state.campaign.history, {\n        role: \"system\",\n        content: \"ðŸ Combat ends.\"\n      }]\n    }\n  })),\n  toggleMic: () => set(s => ({\n    micListening: !s.micListening\n  })),\n  toggleVoice: () => set(s => ({\n    voiceMode: !s.voiceMode\n  }))\n}));","map":{"version":3,"names":["create","useCampaignStore","set","campaign","party","lastResponse","voiceMode","micListening","setCampaign","_campaign$history","_campaign$history2","_campaign$history2$sl","history","length","role","content","combat","slice","updateFromDM","aiResponse","campaignState","state","_state$campaign","addDiceRoll","roll","sides","result","startCombat","enemies","initiativeOrder","map","p","id","name","type","hp","initiative","Math","floor","random","e","sort","a","b","active","round","turnIndex","order","nextTurn","nextIndex","nextRound","damageEnemy","enemyId","dmg","max","alive","endCombat","toggleMic","s","toggleVoice"],"sources":["C:/Users/Hakty/Desktop/AI-Dungeon-Master/frontend/src/state/campaignStore.js"],"sourcesContent":["// frontend/src/state/campaignStore.js\nimport { create } from \"zustand\";\n\nexport const useCampaignStore = create((set) => ({\n  campaign: null,\n  party: [],\n  lastResponse: \"\",\n  voiceMode: true,\n  micListening: false,\n\n  /* ============================\n     ðŸŽ² CAMPAIGN SETUP\n     ============================ */\n  setCampaign: (campaign) =>\n    set({\n      campaign: {\n        ...campaign,\n        history: campaign.history?.length\n          ? campaign.history\n          : [\n              {\n                role: \"assistant\",\n                content: \"The air grows still as your adventure begins...\",\n              },\n            ],\n        combat: null,\n      },\n      party: campaign.party || [],\n      lastResponse: campaign.history?.slice(-1)[0]?.content || \"\",\n    }),\n\n  updateFromDM: ({ aiResponse, campaignState }) =>\n    set((state) => ({\n      campaign: {\n        ...state.campaign,\n        ...campaignState,\n        history: [\n          ...(state.campaign?.history || []),\n          { role: \"assistant\", content: aiResponse },\n        ],\n      },\n      lastResponse: aiResponse,\n      party: campaignState.party || state.party,\n    })),\n\n  /* ============================\n     ðŸŽ² DICE\n     ============================ */\n  addDiceRoll: (roll) =>\n    set((state) => ({\n      campaign: {\n        ...state.campaign,\n        history: [\n          ...(state.campaign.history || []),\n          {\n            role: \"system\",\n            content: `ðŸŽ² Rolled d${roll.sides}: ${roll.result}`,\n          },\n        ],\n      },\n    })),\n\n  /* ============================\n     âš”ï¸ COMBAT\n     ============================ */\n  startCombat: ({ enemies }) =>\n    set((state) => {\n      const initiativeOrder = [\n        ...state.party.map((p) => ({\n          id: p.id,\n          name: p.name,\n          type: \"player\",\n          hp: p.hp,\n          initiative: Math.floor(Math.random() * 20) + 1,\n        })),\n        ...enemies.map((e) => ({\n          ...e,\n          type: \"enemy\",\n          initiative: Math.floor(Math.random() * 20) + 1,\n        })),\n      ].sort((a, b) => b.initiative - a.initiative);\n\n      return {\n        campaign: {\n          ...state.campaign,\n          combat: {\n            active: true,\n            round: 1,\n            turnIndex: 0,\n            order: initiativeOrder,\n            enemies,\n          },\n          history: [\n            ...state.campaign.history,\n            {\n              role: \"system\",\n              content: \"âš”ï¸ Combat begins! Initiative is rolled.\",\n            },\n          ],\n        },\n      };\n    }),\n\n  nextTurn: () =>\n    set((state) => {\n      const combat = state.campaign.combat;\n      if (!combat) return {};\n\n      let nextIndex = combat.turnIndex + 1;\n      let nextRound = combat.round;\n\n      if (nextIndex >= combat.order.length) {\n        nextIndex = 0;\n        nextRound++;\n      }\n\n      return {\n        campaign: {\n          ...state.campaign,\n          combat: {\n            ...combat,\n            turnIndex: nextIndex,\n            round: nextRound,\n          },\n        },\n      };\n    }),\n\n  damageEnemy: (enemyId, dmg) =>\n    set((state) => {\n      const combat = state.campaign.combat;\n      if (!combat) return {};\n\n      const enemies = combat.enemies.map((e) =>\n        e.id === enemyId\n          ? {\n              ...e,\n              hp: Math.max(0, e.hp - dmg),\n              alive: e.hp - dmg > 0,\n            }\n          : e\n      );\n\n      return {\n        campaign: {\n          ...state.campaign,\n          combat: {\n            ...combat,\n            enemies,\n          },\n          history: [\n            ...state.campaign.history,\n            {\n              role: \"system\",\n              content: `ðŸ’¥ ${dmg} damage dealt!`,\n            },\n          ],\n        },\n      };\n    }),\n\n  endCombat: () =>\n    set((state) => ({\n      campaign: {\n        ...state.campaign,\n        combat: null,\n        history: [\n          ...state.campaign.history,\n          {\n            role: \"system\",\n            content: \"ðŸ Combat ends.\",\n          },\n        ],\n      },\n    })),\n\n  toggleMic: () => set((s) => ({ micListening: !s.micListening })),\n  toggleVoice: () => set((s) => ({ voiceMode: !s.voiceMode })),\n}));\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}