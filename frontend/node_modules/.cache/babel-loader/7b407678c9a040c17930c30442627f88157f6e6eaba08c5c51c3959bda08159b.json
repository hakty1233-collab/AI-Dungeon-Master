{"ast":null,"code":"// frontend/src/services/saveLoadService.js\n\n/**\n * Save/Load Campaign System\n * Stores campaigns in localStorage with multiple save slots\n */\n\nconst SAVE_KEY_PREFIX = 'ai-dm-save-';\nconst MAX_SAVES = 10;\n\n/**\n * Get all saved campaigns\n */\nexport function getAllSaves() {\n  const saves = [];\n  for (let i = 0; i < localStorage.length; i++) {\n    const key = localStorage.key(i);\n    if (key && key.startsWith(SAVE_KEY_PREFIX)) {\n      try {\n        const data = JSON.parse(localStorage.getItem(key));\n        saves.push({\n          id: key.replace(SAVE_KEY_PREFIX, ''),\n          ...data\n        });\n      } catch (err) {\n        console.error('Failed to parse save:', key, err);\n      }\n    }\n  }\n\n  // Sort by last saved date\n  saves.sort((a, b) => new Date(b.lastSaved) - new Date(a.lastSaved));\n  return saves;\n}\n\n/**\n * Save campaign to a slot\n */\nexport function saveCampaign(slotId, campaign, party, saveName = null) {\n  try {\n    const saveData = {\n      saveName: saveName || `${campaign.theme} - ${campaign.difficulty}`,\n      campaign,\n      party,\n      lastSaved: new Date().toISOString(),\n      playTime: calculatePlayTime(campaign),\n      thumbnail: generateThumbnail(campaign)\n    };\n    const key = SAVE_KEY_PREFIX + slotId;\n    localStorage.setItem(key, JSON.stringify(saveData));\n    console.log('✅ Campaign saved to slot:', slotId);\n    return true;\n  } catch (err) {\n    console.error('❌ Failed to save campaign:', err);\n    if (err.name === 'QuotaExceededError') {\n      alert('Storage full! Please delete old saves.');\n    }\n    return false;\n  }\n}\n\n/**\n * Load campaign from a slot\n */\nexport function loadCampaign(slotId) {\n  try {\n    const key = SAVE_KEY_PREFIX + slotId;\n    const data = localStorage.getItem(key);\n    if (!data) {\n      console.error('No save found in slot:', slotId);\n      return null;\n    }\n    const saveData = JSON.parse(data);\n    console.log('✅ Campaign loaded from slot:', slotId);\n    return {\n      campaign: saveData.campaign,\n      party: saveData.party\n    };\n  } catch (err) {\n    console.error('❌ Failed to load campaign:', err);\n    return null;\n  }\n}\n\n/**\n * Delete a save\n */\nexport function deleteSave(slotId) {\n  try {\n    const key = SAVE_KEY_PREFIX + slotId;\n    localStorage.removeItem(key);\n    console.log('✅ Save deleted:', slotId);\n    return true;\n  } catch (err) {\n    console.error('❌ Failed to delete save:', err);\n    return false;\n  }\n}\n\n/**\n * Auto-save (saves to slot 'auto')\n */\nexport function autoSave(campaign, party) {\n  return saveCampaign('auto', campaign, party, 'Auto-Save');\n}\n\n/**\n * Calculate total play time from history\n */\nfunction calculatePlayTime(campaign) {\n  var _campaign$history;\n  // Estimate ~2 minutes per action\n  const turnCount = ((_campaign$history = campaign.history) === null || _campaign$history === void 0 ? void 0 : _campaign$history.length) || 0;\n  const minutes = Math.floor(turnCount * 2);\n  if (minutes < 60) {\n    return `${minutes}m`;\n  }\n  const hours = Math.floor(minutes / 60);\n  const remainingMinutes = minutes % 60;\n  return `${hours}h ${remainingMinutes}m`;\n}\n\n/**\n * Generate thumbnail description from recent events\n */\nfunction generateThumbnail(campaign) {\n  var _campaign$history2;\n  const recentEvents = ((_campaign$history2 = campaign.history) === null || _campaign$history2 === void 0 ? void 0 : _campaign$history2.slice(-3)) || [];\n  const lastEvent = recentEvents[recentEvents.length - 1];\n  if (lastEvent && lastEvent.role === 'assistant') {\n    // Extract first sentence\n    const text = lastEvent.content;\n    const firstSentence = text.split(/[.!?]/)[0];\n    return firstSentence.substring(0, 100) + '...';\n  }\n  return 'Adventure in progress...';\n}\n\n/**\n * Export save to JSON file\n */\nexport function exportSave(slotId) {\n  const saveData = loadCampaign(slotId);\n  if (!saveData) return;\n  const json = JSON.stringify(saveData, null, 2);\n  const blob = new Blob([json], {\n    type: 'application/json'\n  });\n  const url = URL.createObjectURL(blob);\n  const a = document.createElement('a');\n  a.href = url;\n  a.download = `ai-dm-save-${slotId}-${Date.now()}.json`;\n  a.click();\n  URL.revokeObjectURL(url);\n}\n\n/**\n * Import save from JSON file\n */\nexport function importSave(file, slotId) {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    reader.onload = e => {\n      try {\n        const saveData = JSON.parse(e.target.result);\n        if (!saveData.campaign || !saveData.party) {\n          throw new Error('Invalid save file format');\n        }\n        const success = saveCampaign(slotId, saveData.campaign, saveData.party, saveData.saveName || 'Imported Save');\n        if (success) {\n          resolve(saveData);\n        } else {\n          reject(new Error('Failed to save imported data'));\n        }\n      } catch (err) {\n        reject(err);\n      }\n    };\n    reader.onerror = () => reject(new Error('Failed to read file'));\n    reader.readAsText(file);\n  });\n}","map":{"version":3,"names":["SAVE_KEY_PREFIX","MAX_SAVES","getAllSaves","saves","i","localStorage","length","key","startsWith","data","JSON","parse","getItem","push","id","replace","err","console","error","sort","a","b","Date","lastSaved","saveCampaign","slotId","campaign","party","saveName","saveData","theme","difficulty","toISOString","playTime","calculatePlayTime","thumbnail","generateThumbnail","setItem","stringify","log","name","alert","loadCampaign","deleteSave","removeItem","autoSave","_campaign$history","turnCount","history","minutes","Math","floor","hours","remainingMinutes","_campaign$history2","recentEvents","slice","lastEvent","role","text","content","firstSentence","split","substring","exportSave","json","blob","Blob","type","url","URL","createObjectURL","document","createElement","href","download","now","click","revokeObjectURL","importSave","file","Promise","resolve","reject","reader","FileReader","onload","e","target","result","Error","success","onerror","readAsText"],"sources":["C:/Users/Hakty/Desktop/AI-Dungeon-Master/frontend/src/services/saveLoadService.js"],"sourcesContent":["// frontend/src/services/saveLoadService.js\n\n/**\n * Save/Load Campaign System\n * Stores campaigns in localStorage with multiple save slots\n */\n\nconst SAVE_KEY_PREFIX = 'ai-dm-save-';\nconst MAX_SAVES = 10;\n\n/**\n * Get all saved campaigns\n */\nexport function getAllSaves() {\n  const saves = [];\n  \n  for (let i = 0; i < localStorage.length; i++) {\n    const key = localStorage.key(i);\n    if (key && key.startsWith(SAVE_KEY_PREFIX)) {\n      try {\n        const data = JSON.parse(localStorage.getItem(key));\n        saves.push({\n          id: key.replace(SAVE_KEY_PREFIX, ''),\n          ...data\n        });\n      } catch (err) {\n        console.error('Failed to parse save:', key, err);\n      }\n    }\n  }\n  \n  // Sort by last saved date\n  saves.sort((a, b) => new Date(b.lastSaved) - new Date(a.lastSaved));\n  \n  return saves;\n}\n\n/**\n * Save campaign to a slot\n */\nexport function saveCampaign(slotId, campaign, party, saveName = null) {\n  try {\n    const saveData = {\n      saveName: saveName || `${campaign.theme} - ${campaign.difficulty}`,\n      campaign,\n      party,\n      lastSaved: new Date().toISOString(),\n      playTime: calculatePlayTime(campaign),\n      thumbnail: generateThumbnail(campaign),\n    };\n    \n    const key = SAVE_KEY_PREFIX + slotId;\n    localStorage.setItem(key, JSON.stringify(saveData));\n    \n    console.log('✅ Campaign saved to slot:', slotId);\n    return true;\n  } catch (err) {\n    console.error('❌ Failed to save campaign:', err);\n    if (err.name === 'QuotaExceededError') {\n      alert('Storage full! Please delete old saves.');\n    }\n    return false;\n  }\n}\n\n/**\n * Load campaign from a slot\n */\nexport function loadCampaign(slotId) {\n  try {\n    const key = SAVE_KEY_PREFIX + slotId;\n    const data = localStorage.getItem(key);\n    \n    if (!data) {\n      console.error('No save found in slot:', slotId);\n      return null;\n    }\n    \n    const saveData = JSON.parse(data);\n    console.log('✅ Campaign loaded from slot:', slotId);\n    \n    return {\n      campaign: saveData.campaign,\n      party: saveData.party,\n    };\n  } catch (err) {\n    console.error('❌ Failed to load campaign:', err);\n    return null;\n  }\n}\n\n/**\n * Delete a save\n */\nexport function deleteSave(slotId) {\n  try {\n    const key = SAVE_KEY_PREFIX + slotId;\n    localStorage.removeItem(key);\n    console.log('✅ Save deleted:', slotId);\n    return true;\n  } catch (err) {\n    console.error('❌ Failed to delete save:', err);\n    return false;\n  }\n}\n\n/**\n * Auto-save (saves to slot 'auto')\n */\nexport function autoSave(campaign, party) {\n  return saveCampaign('auto', campaign, party, 'Auto-Save');\n}\n\n/**\n * Calculate total play time from history\n */\nfunction calculatePlayTime(campaign) {\n  // Estimate ~2 minutes per action\n  const turnCount = campaign.history?.length || 0;\n  const minutes = Math.floor(turnCount * 2);\n  \n  if (minutes < 60) {\n    return `${minutes}m`;\n  }\n  \n  const hours = Math.floor(minutes / 60);\n  const remainingMinutes = minutes % 60;\n  return `${hours}h ${remainingMinutes}m`;\n}\n\n/**\n * Generate thumbnail description from recent events\n */\nfunction generateThumbnail(campaign) {\n  const recentEvents = campaign.history?.slice(-3) || [];\n  const lastEvent = recentEvents[recentEvents.length - 1];\n  \n  if (lastEvent && lastEvent.role === 'assistant') {\n    // Extract first sentence\n    const text = lastEvent.content;\n    const firstSentence = text.split(/[.!?]/)[0];\n    return firstSentence.substring(0, 100) + '...';\n  }\n  \n  return 'Adventure in progress...';\n}\n\n/**\n * Export save to JSON file\n */\nexport function exportSave(slotId) {\n  const saveData = loadCampaign(slotId);\n  if (!saveData) return;\n  \n  const json = JSON.stringify(saveData, null, 2);\n  const blob = new Blob([json], { type: 'application/json' });\n  const url = URL.createObjectURL(blob);\n  \n  const a = document.createElement('a');\n  a.href = url;\n  a.download = `ai-dm-save-${slotId}-${Date.now()}.json`;\n  a.click();\n  \n  URL.revokeObjectURL(url);\n}\n\n/**\n * Import save from JSON file\n */\nexport function importSave(file, slotId) {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    \n    reader.onload = (e) => {\n      try {\n        const saveData = JSON.parse(e.target.result);\n        \n        if (!saveData.campaign || !saveData.party) {\n          throw new Error('Invalid save file format');\n        }\n        \n        const success = saveCampaign(\n          slotId,\n          saveData.campaign,\n          saveData.party,\n          saveData.saveName || 'Imported Save'\n        );\n        \n        if (success) {\n          resolve(saveData);\n        } else {\n          reject(new Error('Failed to save imported data'));\n        }\n      } catch (err) {\n        reject(err);\n      }\n    };\n    \n    reader.onerror = () => reject(new Error('Failed to read file'));\n    reader.readAsText(file);\n  });\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}